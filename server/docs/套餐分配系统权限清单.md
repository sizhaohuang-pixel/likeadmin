# ä»£ç†å•†å¥—é¤åˆ†é…ç³»ç»Ÿæƒé™æ¸…å•

## ğŸ“‹ æƒé™æ ‡è¯†ç¬¦åˆ—è¡¨

### ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½æƒé™

| æƒé™æ ‡è¯†ç¬¦ | åŠŸèƒ½æè¿° | è¯·æ±‚æ–¹å¼ | æ¥å£è·¯å¾„ | é€‚ç”¨è§’è‰² |
|-----------|---------|---------|---------|---------|
| `package/assign` | åˆ†é…å¥—é¤ | POST | `/adminapi/package/assign` | ä»£ç†å•† |
| `package/tenant-packages` | æŸ¥çœ‹ç§Ÿæˆ·å¥—é¤ | GET | `/adminapi/package/tenant-packages` | ä»£ç†å•†ã€ç§Ÿæˆ· |
| `package/assign-alt-account` | åˆ†é…å°å· | POST | `/adminapi/package/assign-alt-account` | ç§Ÿæˆ· |
| `package/check-port-availability` | æ£€æŸ¥ç«¯å£å¯ç”¨æ€§ | GET | `/adminapi/package/check-port-availability` | ç§Ÿæˆ· |
| `package/assign-history` | æŸ¥çœ‹åˆ†é…å†å² | GET | `/adminapi/package/assign-history` | ä»£ç†å•†ã€ç®¡ç†å‘˜ |

### ğŸ“Š ç®¡ç†åŠŸèƒ½æƒé™

| æƒé™æ ‡è¯†ç¬¦ | åŠŸèƒ½æè¿° | è¯·æ±‚æ–¹å¼ | æ¥å£è·¯å¾„ | é€‚ç”¨è§’è‰² |
|-----------|---------|---------|---------|---------|
| `package/lists` | å¥—é¤åˆ—è¡¨æŸ¥è¯¢ | GET | `/adminapi/package/lists` | ä»£ç†å•†ã€ç®¡ç†å‘˜ |
| `package/statistics` | ç»Ÿè®¡ä¿¡æ¯ | GET | `/adminapi/package/statistics` | ä»£ç†å•†ã€ç®¡ç†å‘˜ |
| `package/detail` | å¥—é¤è¯¦æƒ… | GET | `/adminapi/package/detail` | ä»£ç†å•†ã€ç®¡ç†å‘˜ |
| `package/port-pool-status` | ç«¯å£æ± çŠ¶æ€ | GET | `/adminapi/package/port-pool-status` | ç§Ÿæˆ·ã€ä»£ç†å•† |

### âš™ï¸ ç³»ç»Ÿç»´æŠ¤æƒé™

| æƒé™æ ‡è¯†ç¬¦ | åŠŸèƒ½æè¿° | è¯·æ±‚æ–¹å¼ | æ¥å£è·¯å¾„ | é€‚ç”¨è§’è‰² |
|-----------|---------|---------|---------|---------|
| `package/handle-expired` | å¤„ç†è¿‡æœŸå¥—é¤ | POST | `/adminapi/package/handle-expired` | ç®¡ç†å‘˜ |
| `package/update-expired-status` | æ›´æ–°è¿‡æœŸçŠ¶æ€ | POST | `/adminapi/package/update-expired-status` | ç®¡ç†å‘˜ |

### ğŸ”§ è¾…åŠ©åŠŸèƒ½æƒé™

| æƒé™æ ‡è¯†ç¬¦ | åŠŸèƒ½æè¿° | è¯·æ±‚æ–¹å¼ | æ¥å£è·¯å¾„ | é€‚ç”¨è§’è‰² |
|-----------|---------|---------|---------|---------|
| `package/tenant-options` | ç§Ÿæˆ·é€‰é¡¹åˆ—è¡¨ | GET | `/adminapi/package/tenant-options` | ä»£ç†å•† |
| `package/operator-options` | å®¢æœé€‰é¡¹åˆ—è¡¨ | GET | `/adminapi/package/operator-options` | ç§Ÿæˆ· |
| `package/alt-account-options` | å°å·é€‰é¡¹åˆ—è¡¨ | GET | `/adminapi/package/alt-account-options` | ç§Ÿæˆ· |

## ğŸ¯ è§’è‰²æƒé™åˆ†é…æ–¹æ¡ˆ

### 1. **ä»£ç†å•†è§’è‰²** (å»ºè®®role_id = 3)

**æ ¸å¿ƒæƒé™**ï¼š
- âœ… `package/assign` - ä¸ºä¸‹çº§ç§Ÿæˆ·åˆ†é…å¥—é¤
- âœ… `package/tenant-packages` - æŸ¥çœ‹ä¸‹çº§ç§Ÿæˆ·å¥—é¤çŠ¶æ€
- âœ… `package/assign-history` - æŸ¥çœ‹è‡ªå·±çš„åˆ†é…å†å²
- âœ… `package/lists` - æŸ¥çœ‹å¥—é¤åˆ†é…åˆ—è¡¨
- âœ… `package/statistics` - æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
- âœ… `package/detail` - æŸ¥çœ‹å¥—é¤è¯¦æƒ…
- âœ… `package/tenant-options` - è·å–ä¸‹çº§ç§Ÿæˆ·åˆ—è¡¨

**ä¸šåŠ¡åœºæ™¯**ï¼š
- ä»£ç†å•†ç™»å½•åå¯ä»¥ä¸ºè‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·åˆ†é…ç«¯å£å¥—é¤
- å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†é…è®°å½•å’Œç»Ÿè®¡ä¿¡æ¯
- å¯ä»¥ç›‘æ§ç§Ÿæˆ·çš„ç«¯å£ä½¿ç”¨æƒ…å†µ

### 2. **ç§Ÿæˆ·è§’è‰²** (å»ºè®®role_id = 2)

**æ ¸å¿ƒæƒé™**ï¼š
- âœ… `package/tenant-packages` - æŸ¥çœ‹è‡ªå·±çš„å¥—é¤ä¿¡æ¯
- âœ… `package/assign-alt-account` - åˆ†é…å°å·ç»™å®¢æœ
- âœ… `package/check-port-availability` - æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
- âœ… `package/port-pool-status` - æŸ¥çœ‹ç«¯å£æ± çŠ¶æ€
- âœ… `package/operator-options` - è·å–å®¢æœåˆ—è¡¨
- âœ… `package/alt-account-options` - è·å–å¯åˆ†é…å°å·åˆ—è¡¨

**ä¸šåŠ¡åœºæ™¯**ï¼š
- ç§Ÿæˆ·ç™»å½•åå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ç«¯å£å¥—é¤çŠ¶æ€
- å¯ä»¥å°†ç«¯å£åˆ†é…ç»™å…·ä½“çš„å®¢æœä½¿ç”¨
- å¯ä»¥å®æ—¶ç›‘æ§ç«¯å£ä½¿ç”¨æƒ…å†µ

### 3. **å¹³å°ç®¡ç†å‘˜è§’è‰²** (å»ºè®®role_id = 1)

**å…¨éƒ¨æƒé™**ï¼š
- âœ… æ‰€æœ‰å¥—é¤ç®¡ç†æƒé™
- âœ… `package/handle-expired` - å¤„ç†è¿‡æœŸå¥—é¤
- âœ… `package/update-expired-status` - æ›´æ–°è¿‡æœŸçŠ¶æ€
- âœ… ç³»ç»Ÿç»´æŠ¤å’Œç›‘æ§æƒé™

**ä¸šåŠ¡åœºæ™¯**ï¼š
- å¹³å°ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®
- è´Ÿè´£ç³»ç»Ÿç»´æŠ¤å’Œè¿‡æœŸå¤„ç†
- å¯ä»¥è¿›è¡Œå…¨å±€ç»Ÿè®¡å’Œç›‘æ§

## ğŸ›¡ï¸ æƒé™éªŒè¯æœºåˆ¶

### 1. **ä¸­é—´ä»¶éªŒè¯**
- åŸºäº `AuthMiddleware` è¿›è¡Œæƒé™éªŒè¯
- è‡ªåŠ¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰å¯¹åº”çš„æƒé™æ ‡è¯†ç¬¦
- rootç”¨æˆ·ï¼ˆroot=1ï¼‰è‡ªåŠ¨è·³è¿‡æƒé™éªŒè¯

### 2. **ä¸šåŠ¡å±‚éªŒè¯**
- åœ¨Logicå±‚è¿›è¡ŒäºŒæ¬¡æƒé™éªŒè¯
- æ£€æŸ¥å±‚çº§å…³ç³»ï¼ˆä»£ç†å•†åªèƒ½æ“ä½œä¸‹çº§ç§Ÿæˆ·ï¼‰
- éªŒè¯æ•°æ®å½’å±æƒï¼ˆç§Ÿæˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®ï¼‰

### 3. **æ•°æ®è¿‡æ»¤**
- æ ¹æ®ç”¨æˆ·èº«ä»½è‡ªåŠ¨è¿‡æ»¤å¯è§æ•°æ®
- ä»£ç†å•†åªèƒ½çœ‹åˆ°ä¸‹çº§ç§Ÿæˆ·çš„æ•°æ®
- ç§Ÿæˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®

## ğŸ“ æƒé™é…ç½®æ­¥éª¤

### 1. **æ‰§è¡ŒSQLè„šæœ¬**
```sql
-- æ‰§è¡Œæƒé™é…ç½®è„šæœ¬
source database/package_permissions.sql;
```

### 2. **åˆ†é…è§’è‰²æƒé™**
```sql
-- ä¸ºä»£ç†å•†è§’è‰²åˆ†é…æƒé™ï¼ˆå‡è®¾ä»£ç†å•†è§’è‰²IDä¸º3ï¼‰
INSERT INTO la_system_role_menu (role_id, menu_id) 
SELECT 3, id FROM la_system_menu WHERE perms IN (
    'package/assign',
    'package/tenant-packages', 
    'package/assign-history',
    'package/lists',
    'package/statistics',
    'package/detail',
    'package/tenant-options'
);

-- ä¸ºç§Ÿæˆ·è§’è‰²åˆ†é…æƒé™ï¼ˆå‡è®¾ç§Ÿæˆ·è§’è‰²IDä¸º2ï¼‰
INSERT INTO la_system_role_menu (role_id, menu_id) 
SELECT 2, id FROM la_system_menu WHERE perms IN (
    'package/tenant-packages',
    'package/assign-alt-account',
    'package/check-port-availability',
    'package/port-pool-status',
    'package/operator-options',
    'package/alt-account-options'
);
```

### 3. **éªŒè¯æƒé™é…ç½®**
```sql
-- æŸ¥çœ‹è§’è‰²æƒé™åˆ†é…æƒ…å†µ
SELECT r.name as role_name, m.name as menu_name, m.perms 
FROM la_system_role r
JOIN la_system_role_menu rm ON r.id = rm.role_id
JOIN la_system_menu m ON rm.menu_id = m.id
WHERE m.perms LIKE 'package%'
ORDER BY r.id, m.sort DESC;
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. **è§’è‰²IDç¡®è®¤**
- æ‰§è¡Œå‰è¯·ç¡®è®¤å®é™…ç³»ç»Ÿä¸­çš„è§’è‰²ID
- æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´SQLè„šæœ¬ä¸­çš„è§’è‰²ID

### 2. **èœå•å±‚çº§**
- ç¡®ä¿èœå•çš„çˆ¶çº§å…³ç³»æ­£ç¡®
- æ³¨æ„èœå•çš„æ˜¾ç¤ºé¡ºåºå’Œå±‚çº§ç»“æ„

### 3. **æƒé™æµ‹è¯•**
- é…ç½®å®Œæˆåéœ€è¦æµ‹è¯•å„è§’è‰²çš„æƒé™
- ç¡®ä¿æƒé™éªŒè¯æœºåˆ¶æ­£å¸¸å·¥ä½œ

### 4. **æ•°æ®å®‰å…¨**
- ä¸¥æ ¼æ§åˆ¶æ•°æ®è®¿é—®æƒé™
- ç¡®ä¿ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±æƒé™èŒƒå›´å†…çš„æ•°æ®

## ğŸ”„ æƒé™æ›´æ–°ç»´æŠ¤

### 1. **æ–°å¢æƒé™**
- åœ¨ `la_system_menu` è¡¨ä¸­æ·»åŠ æ–°çš„æƒé™è®°å½•
- æ›´æ–°ç›¸åº”è§’è‰²çš„æƒé™åˆ†é…

### 2. **æƒé™è°ƒæ•´**
- é€šè¿‡ç®¡ç†åå°çš„è§’è‰²ç®¡ç†åŠŸèƒ½è°ƒæ•´æƒé™
- æˆ–ç›´æ¥ä¿®æ”¹ `la_system_role_menu` è¡¨

### 3. **æƒé™æ¸…ç†**
- å®šæœŸæ¸…ç†æ— æ•ˆçš„æƒé™è®°å½•
- ç¡®ä¿æƒé™é…ç½®çš„ä¸€è‡´æ€§
