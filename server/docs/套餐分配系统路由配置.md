# ä»£ç†å•†å¥—é¤åˆ†é…ç³»ç»Ÿè·¯ç”±é…ç½®

## ğŸ“‹ è·¯ç”±é…ç½®è¯´æ˜

### ğŸ”§ **ThinkPHPè‡ªåŠ¨è·¯ç”±æœºåˆ¶**

likeadminé¡¹ç›®åŸºäºThinkPHP 8.0çš„å¤šåº”ç”¨æ¶æ„ï¼Œä½¿ç”¨**è‡ªåŠ¨è·¯ç”±**æœºåˆ¶ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®è·¯ç”±æ–‡ä»¶ã€‚è·¯ç”±è§„åˆ™éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š

```
/åº”ç”¨å/æ§åˆ¶å™¨å/æ–¹æ³•å
```

### ğŸ¯ **å¥—é¤åˆ†é…ç³»ç»Ÿè·¯ç”±åˆ—è¡¨**

#### **åŸºç¡€è·¯å¾„**: `/adminapi/package/`

| åŠŸèƒ½æ¨¡å— | HTTPæ–¹æ³• | è·¯ç”±è·¯å¾„ | æ§åˆ¶å™¨æ–¹æ³• | æƒé™æ ‡è¯†ç¬¦ |
|---------|---------|---------|-----------|-----------|
| **æ ¸å¿ƒåŠŸèƒ½** |
| åˆ†é…å¥—é¤ | POST | `/adminapi/package/assign` | `assign()` | `package/assign` |
| ç§Ÿæˆ·å¥—é¤æŸ¥è¯¢ | GET | `/adminapi/package/tenant-packages` | `tenantPackages()` | `package/tenant-packages` |
| åˆ†é…å°å· | POST | `/adminapi/package/assign-alt-account` | `assignAltAccount()` | `package/assign-alt-account` |
| ç«¯å£å¯ç”¨æ€§æ£€æŸ¥ | GET | `/adminapi/package/check-port-availability` | `checkPortAvailability()` | `package/check-port-availability` |
| åˆ†é…å†å²æŸ¥è¯¢ | GET | `/adminapi/package/assign-history` | `assignHistory()` | `package/assign-history` |
| **ç®¡ç†åŠŸèƒ½** |
| å¥—é¤åˆ—è¡¨ | GET | `/adminapi/package/lists` | `lists()` | `package/lists` |
| ç»Ÿè®¡ä¿¡æ¯ | GET | `/adminapi/package/statistics` | `statistics()` | `package/statistics` |
| å¥—é¤è¯¦æƒ… | GET | `/adminapi/package/detail` | `detail()` | `package/detail` |
| ç«¯å£æ± çŠ¶æ€ | GET | `/adminapi/package/port-pool-status` | `portPoolStatus()` | `package/port-pool-status` |
| **ç³»ç»Ÿç»´æŠ¤** |
| å¤„ç†è¿‡æœŸå¥—é¤ | POST | `/adminapi/package/handle-expired` | `handleExpired()` | `package/handle-expired` |
| æ›´æ–°è¿‡æœŸçŠ¶æ€ | POST | `/adminapi/package/update-expired-status` | `updateExpiredStatus()` | `package/update-expired-status` |
| **è¾…åŠ©åŠŸèƒ½** |
| ç§Ÿæˆ·é€‰é¡¹ | GET | `/adminapi/package/tenant-options` | `tenantOptions()` | `package/tenant-options` |
| å®¢æœé€‰é¡¹ | GET | `/adminapi/package/operator-options` | `operatorOptions()` | `package/operator-options` |
| å°å·é€‰é¡¹ | GET | `/adminapi/package/alt-account-options` | `altAccountOptions()` | `package/alt-account-options` |

## ğŸ›¡ï¸ **ä¸­é—´ä»¶é…ç½®**

### **adminapiåº”ç”¨ä¸­é—´ä»¶æ ˆ**

è·¯ç”±è‡ªåŠ¨åº”ç”¨ä»¥ä¸‹ä¸­é—´ä»¶ï¼ˆé…ç½®åœ¨ `app/adminapi/config/route.php`ï¼‰ï¼š

```php
'middleware' => [
    // åˆå§‹åŒ–ä¸­é—´ä»¶
    app\adminapi\http\middleware\InitMiddleware::class,
    // ç™»å½•éªŒè¯ä¸­é—´ä»¶
    app\adminapi\http\middleware\LoginMiddleware::class,
    // æƒé™è®¤è¯ä¸­é—´ä»¶
    app\adminapi\http\middleware\AuthMiddleware::class,
    // æ¼”ç¤ºæ¨¡å¼ä¸­é—´ä»¶
    app\adminapi\http\middleware\CheckDemoMiddleware::class,
    app\adminapi\http\middleware\EncryDemoDataMiddleware::class,
],
```

### **æƒé™éªŒè¯æµç¨‹**

1. **InitMiddleware**: åˆå§‹åŒ–è¯·æ±‚ä¿¡æ¯
2. **LoginMiddleware**: éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
3. **AuthMiddleware**: éªŒè¯ç”¨æˆ·æƒé™ï¼ˆåŸºäºæƒé™æ ‡è¯†ç¬¦ï¼‰
4. **CheckDemoMiddleware**: æ¼”ç¤ºæ¨¡å¼é™åˆ¶
5. **EncryDemoDataMiddleware**: æ¼”ç¤ºæ•°æ®åŠ å¯†

## ğŸ“ **è·¯ç”±å‘½åè§„èŒƒ**

### **æ§åˆ¶å™¨å‘½å**
- æ–‡ä»¶å: `PackageController.php`
- ç±»å: `PackageController`
- å‘½åç©ºé—´: `app\adminapi\controller`

### **æ–¹æ³•å‘½å**
- é©¼å³°å‘½åæ³•: `assignAltAccount`
- URLè½¬æ¢: `assign-alt-account`
- æƒé™æ ‡è¯†: `package/assign-alt-account`

### **è·¯å¾„è½¬æ¢è§„åˆ™**
```php
// æ§åˆ¶å™¨æ–¹æ³• â†’ URLè·¯å¾„
assignAltAccount() â†’ assign-alt-account
tenantPackages() â†’ tenant-packages
checkPortAvailability() â†’ check-port-availability
```

## ğŸ”§ **è·¯ç”±æµ‹è¯•æ–¹æ³•**

### **1. ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹è·¯ç”±**
```bash
# æŸ¥çœ‹æ‰€æœ‰è·¯ç”±
php think route:list

# æŸ¥çœ‹adminapiåº”ç”¨è·¯ç”±
php think route:list adminapi
```

### **2. APIæµ‹è¯•ç¤ºä¾‹**

#### **åˆ†é…å¥—é¤**
```bash
curl -X POST "http://your-domain/adminapi/package/assign" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-token" \
  -d '{
    "tenant_id": 123,
    "port_count": 100,
    "expire_days": 30,
    "remark": "æµ‹è¯•åˆ†é…"
  }'
```

#### **æŸ¥è¯¢ç§Ÿæˆ·å¥—é¤**
```bash
curl -X GET "http://your-domain/adminapi/package/tenant-packages?tenant_id=123" \
  -H "Authorization: Bearer your-token"
```

#### **æ£€æŸ¥ç«¯å£å¯ç”¨æ€§**
```bash
curl -X GET "http://your-domain/adminapi/package/check-port-availability?tenant_id=123&need_count=50" \
  -H "Authorization: Bearer your-token"
```

## ğŸ¯ **å‰ç«¯è·¯ç”±é…ç½®**

### **Vue Routeré…ç½®ç¤ºä¾‹**

```javascript
// å¥—é¤ç®¡ç†è·¯ç”±é…ç½®
{
  path: '/package',
  name: 'Package',
  component: Layout,
  meta: { title: 'å¥—é¤ç®¡ç†', icon: 'el-icon-Box' },
  children: [
    {
      path: 'assign',
      name: 'PackageAssign',
      component: () => import('@/views/package/assign/index.vue'),
      meta: { title: 'å¥—é¤åˆ†é…', perms: ['package/lists'] }
    },
    {
      path: 'port',
      name: 'PackagePort',
      component: () => import('@/views/package/port/index.vue'),
      meta: { title: 'ç«¯å£ç®¡ç†', perms: ['package/tenant-packages'] }
    },
    {
      path: 'history',
      name: 'PackageHistory',
      component: () => import('@/views/package/history/index.vue'),
      meta: { title: 'åˆ†é…å†å²', perms: ['package/assign-history'] }
    }
  ]
}
```

### **APIè°ƒç”¨ç¤ºä¾‹**

```javascript
// APIæœåŠ¡å°è£…
import request from '@/utils/request'

export const packageApi = {
  // åˆ†é…å¥—é¤
  assign(data) {
    return request.post('/package/assign', data)
  },
  
  // æŸ¥è¯¢ç§Ÿæˆ·å¥—é¤
  getTenantPackages(params) {
    return request.get('/package/tenant-packages', { params })
  },
  
  // åˆ†é…å°å·
  assignAltAccount(data) {
    return request.post('/package/assign-alt-account', data)
  },
  
  // æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
  checkAvailability(params) {
    return request.get('/package/check-port-availability', { params })
  },
  
  // è·å–å¥—é¤åˆ—è¡¨
  getList(params) {
    return request.get('/package/lists', { params })
  }
}
```

## âš ï¸ **æ³¨æ„äº‹é¡¹**

### **1. è·¯ç”±ç¼“å­˜**
- ç”Ÿäº§ç¯å¢ƒå»ºè®®å¼€å¯è·¯ç”±ç¼“å­˜
- ä¿®æ”¹è·¯ç”±åéœ€è¦æ¸…é™¤ç¼“å­˜

### **2. æƒé™éªŒè¯**
- æ‰€æœ‰è·¯ç”±éƒ½ä¼šç»è¿‡æƒé™éªŒè¯ä¸­é—´ä»¶
- ç¡®ä¿æƒé™æ ‡è¯†ç¬¦ä¸èœå•é…ç½®ä¸€è‡´

### **3. å‚æ•°éªŒè¯**
- æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨éªŒè¯å™¨è¿›è¡Œå‚æ•°éªŒè¯
- éµå¾ªåœºæ™¯éªŒè¯æ¨¡å¼

### **4. é”™è¯¯å¤„ç†**
- ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æç¤º

## ğŸ”„ **è·¯ç”±ç»´æŠ¤**

### **æ–°å¢è·¯ç”±æ­¥éª¤**
1. åœ¨æ§åˆ¶å™¨ä¸­æ·»åŠ æ–°æ–¹æ³•
2. åœ¨æƒé™é…ç½®ä¸­æ·»åŠ å¯¹åº”æƒé™æ ‡è¯†ç¬¦
3. æ›´æ–°å‰ç«¯è·¯ç”±é…ç½®
4. æµ‹è¯•è·¯ç”±å¯è®¿é—®æ€§

### **è·¯ç”±è°ƒè¯•**
```bash
# æŸ¥çœ‹å…·ä½“è·¯ç”±ä¿¡æ¯
php think route:list | grep package

# æµ‹è¯•è·¯ç”±è§£æ
php think route:test /adminapi/package/assign POST
```

### **æ€§èƒ½ä¼˜åŒ–**
- åˆç†ä½¿ç”¨è·¯ç”±ç¼“å­˜
- é¿å…è¿‡æ·±çš„è·¯ç”±åµŒå¥—
- ä¼˜åŒ–ä¸­é—´ä»¶æ‰§è¡Œé¡ºåº

## ğŸ“Š **è·¯ç”±ç»Ÿè®¡**

| è·¯ç”±ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|---------|------|------|
| GETè·¯ç”± | 9ä¸ª | æŸ¥è¯¢ç±»æ¥å£ |
| POSTè·¯ç”± | 5ä¸ª | æ“ä½œç±»æ¥å£ |
| æ€»è®¡ | 14ä¸ª | å®Œæ•´åŠŸèƒ½è¦†ç›– |

æ‰€æœ‰è·¯ç”±éƒ½éµå¾ªRESTfulè®¾è®¡åŸåˆ™ï¼Œæä¾›å®Œæ•´çš„CRUDæ“ä½œæ”¯æŒã€‚
