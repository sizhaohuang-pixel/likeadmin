# ç®¡ç†å‘˜å±‚çº§æƒé™ç³»ç»Ÿæ–‡æ¡£

æœ¬ç›®å½•åŒ…å«äº†ç®¡ç†å‘˜å±‚çº§æƒé™ç³»ç»Ÿçš„å®Œæ•´æ–‡æ¡£ã€‚

## æ–‡æ¡£ç»“æ„

### åŠŸèƒ½è¯´æ˜æ–‡æ¡£
- [ä»£ç†å•†ç®¡ç†åŠŸèƒ½è¯´æ˜](ä»£ç†å•†ç®¡ç†åŠŸèƒ½è¯´æ˜.md) - ä»£ç†å•†ç®¡ç†åŠŸèƒ½çš„è¯¦ç»†è¯´æ˜
- [ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½è¯´æ˜](ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½è¯´æ˜.md) - ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½çš„è¯¦ç»†è¯´æ˜
- [å±‚çº§æƒé™æ§åˆ¶è¯´æ˜](å±‚çº§æƒé™æ§åˆ¶è¯´æ˜.md) - æ•´ä½“å±‚çº§æƒé™æ§åˆ¶æœºåˆ¶è¯´æ˜
- [å¥—é¤åˆ†é…ç³»ç»Ÿé›†æˆå®ŒæˆæŠ¥å‘Š](å¥—é¤åˆ†é…ç³»ç»Ÿé›†æˆå®ŒæˆæŠ¥å‘Š.md) - å¥—é¤åˆ†é…ç³»ç»ŸåŠŸèƒ½å®Œæ•´æŠ¥å‘Š

### APIæ¥å£æ–‡æ¡£
- [ä»£ç†å•†ç®¡ç†APIæ–‡æ¡£](ä»£ç†å•†ç®¡ç†APIæ–‡æ¡£.md) - ä»£ç†å•†ç®¡ç†ç›¸å…³APIæ¥å£
- [ç§Ÿæˆ·ç®¡ç†APIæ–‡æ¡£](ç§Ÿæˆ·ç®¡ç†APIæ–‡æ¡£.md) - ç§Ÿæˆ·ç®¡ç†ç›¸å…³APIæ¥å£
- [å¥—é¤åˆ†é…ç³»ç»ŸAPIæ¥å£æ–‡æ¡£](å¥—é¤åˆ†é…ç³»ç»ŸAPIæ¥å£æ–‡æ¡£.md) - å¥—é¤åˆ†é…å’Œç»­è´¹ç›¸å…³APIæ¥å£

### æŠ€æœ¯æ–‡æ¡£
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md) - æ•°æ®åº“è¡¨ç»“æ„å’Œå­—æ®µè¯´æ˜
- [æƒé™æ§åˆ¶æ¶æ„æ–‡æ¡£](æƒé™æ§åˆ¶æ¶æ„æ–‡æ¡£.md) - æƒé™æ§åˆ¶çš„æŠ€æœ¯æ¶æ„
- [ç«¯å£ç»Ÿè®¡ç»Ÿä¸€æœºåˆ¶è¯´æ˜](ç«¯å£ç»Ÿè®¡ç»Ÿä¸€æœºåˆ¶è¯´æ˜.md) - v1.9.4ç»Ÿä¸€æœºåˆ¶è¯¦ç»†è¯´æ˜
- [å¥—é¤ä¼˜å…ˆçº§ä½¿ç”¨ç­–ç•¥](å¥—é¤ä¼˜å…ˆçº§ä½¿ç”¨ç­–ç•¥.md) - å¥—é¤ä¼˜å…ˆçº§åˆ†é…ç®—æ³•è¯´æ˜

## ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„ç®¡ç†å‘˜å±‚çº§æƒé™æ§åˆ¶ï¼ŒåŒ…æ‹¬ï¼š

### è§’è‰²å±‚çº§
```
Rootç”¨æˆ·
    â†“
å¹³å°ç®¡ç†å‘˜ (è§’è‰²ID: 5)
    â†“
ä»£ç†å•† (è§’è‰²ID: 1)
    â†“
ç§Ÿæˆ· (è§’è‰²ID: 2)
```

### æƒé™è§„åˆ™
1. **åˆ›å»ºæƒé™**ï¼š
   - å¹³å°ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºä»£ç†å•†
   - ä»£ç†å•†å¯ä»¥åˆ›å»ºç§Ÿæˆ·
   - Rootç”¨æˆ·å¯ä»¥åˆ›å»ºä»»ä½•è§’è‰²

2. **ç®¡ç†æƒé™**ï¼š
   - ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„ä¸‹çº§
   - æ”¯æŒå¤šçº§å±‚çº§ç®¡ç†
   - çœŸå®åˆ é™¤ï¼Œæ•°æ®ä¸å¯æ¢å¤

3. **æ•°æ®éš”ç¦»**ï¼š
   - ä¸¥æ ¼çš„æ•°æ®æƒé™æ§åˆ¶
   - é˜²æ­¢è¶Šæƒè®¿é—®
   - è‡ªåŠ¨ä¸Šçº§å…³ç³»è®¾ç½®

## å¿«é€Ÿå¼€å§‹

1. æŸ¥çœ‹å¯¹åº”çš„åŠŸèƒ½è¯´æ˜æ–‡æ¡£äº†è§£ä¸šåŠ¡é€»è¾‘
2. å‚è€ƒAPIæ–‡æ¡£è¿›è¡Œæ¥å£è°ƒç”¨
3. æŸ¥çœ‹æŠ€æœ¯æ–‡æ¡£äº†è§£å®ç°ç»†èŠ‚

## ğŸ”„ æ ¸å¿ƒåŠŸèƒ½

### å¥—é¤åˆ†é…ç³»ç»Ÿ (v1.9.4)
- **å¥—é¤åˆ†é…ç®¡ç†**: ä»£ç†å•†ä¸ºç§Ÿæˆ·åˆ†é…ç«¯å£å¥—é¤
- **å¥—é¤ç»­è´¹åŠŸèƒ½**: å•ä¸ªç»­è´¹ã€æ‰¹é‡ç»­è´¹
- **ç«¯å£èµ„æºç®¡æ§**: åŸºäºå¥—é¤çš„ç«¯å£é…é¢æ§åˆ¶
- **å°å·åˆ†é…é›†æˆ**: ä¸å°å·ç®¡ç†ç³»ç»Ÿå®Œç¾é›†æˆ
- **æ™ºèƒ½è¿‡æœŸå¤„ç†**: è‡ªåŠ¨å¤„ç†è¿‡æœŸå¥—é¤å’Œç«¯å£é‡Šæ”¾

### æƒé™ç®¡ç†ç³»ç»Ÿ
- **å±‚çº§æƒé™æ§åˆ¶**: ä¸¥æ ¼çš„ä¸Šä¸‹çº§æƒé™ç®¡ç†
- **è§’è‰²æƒé™éªŒè¯**: åŸºäºè§’è‰²çš„åŠŸèƒ½æƒé™æ§åˆ¶
- **æ•°æ®æƒé™éš”ç¦»**: ç¡®ä¿æ•°æ®å®‰å…¨å’Œéš”ç¦»

### å°å·ç®¡ç†é›†æˆ
- **ç«¯å£é…é¢æ§åˆ¶**: åŸºäºå¥—é¤çš„å°å·åˆ†é…é™åˆ¶
- **çº§è”åˆ é™¤ä¼˜åŒ–**: åˆ é™¤å°å·æ—¶è‡ªåŠ¨é‡Šæ”¾ç«¯å£
- **å®æ—¶çŠ¶æ€åŒæ­¥**: å¥—é¤çŠ¶æ€ä¸å°å·åˆ†é…å®æ—¶åŒæ­¥

## æ›´æ–°æ—¥å¿—

### v1.9.4 (2025-08-27)
- âœ… æ–°å¢å¥—é¤ç»­è´¹åŠŸèƒ½ï¼ˆå•ä¸ªç»­è´¹ã€æ‰¹é‡ç»­è´¹ï¼‰
- âœ… ä¼˜åŒ–å°å·åˆ é™¤é€»è¾‘ï¼ˆçº§è”åˆ é™¤åˆ†é…å…³ç³»ï¼‰
- âœ… ä¿®å¤ç«¯å£å¯ç”¨æ€§æ£€æŸ¥ï¼ˆåªè®¡ç®—æœªè¿‡æœŸå¥—é¤ï¼‰
- âœ… ä¼˜åŒ–å†å²æŸ¥è¯¢åŠŸèƒ½ï¼ˆæ”¯æŒå…¨ç§Ÿæˆ·æŸ¥è¯¢å’ŒçŠ¶æ€ç­›é€‰ï¼‰
- âœ… ä¿®å¤æ—¶é—´å­—æ®µç±»å‹é”™è¯¯å’Œè¿”å›æ•°æ®æ ¼å¼
- âœ… **ç»Ÿä¸€ç«¯å£ç»Ÿè®¡æœºåˆ¶**ï¼ˆåŸºäºpackage_idçš„ç²¾ç¡®ç»Ÿè®¡ï¼‰
- âœ… **å¥—é¤ä¼˜å…ˆçº§åˆ†é…ç­–ç•¥**ï¼ˆæœ€æ—©å¥—é¤ä¼˜å…ˆä½¿ç”¨ï¼‰
- âœ… **æ•°æ®ä¸€è‡´æ€§ä¿éšœ**ï¼ˆç»Ÿä¸€çš„PortStatisticsServiceæœåŠ¡ç±»ï¼‰
- âœ… **å®Œæ•´çš„æ•°æ®éªŒè¯ä½“ç³»**ï¼ˆç¡®ä¿ç»Ÿè®¡å‡†ç¡®æ€§ï¼‰
- âœ… æ›´æ–°å®Œæ•´çš„APIæ–‡æ¡£å’ŒåŠŸèƒ½è¯´æ˜

### v1.9.3 (2024/08/24)
- 2024/08/24: åˆå§‹ç‰ˆæœ¬ï¼Œå®ç°ä»£ç†å•†ç®¡ç†å’Œå±‚çº§æƒé™æ§åˆ¶
- 2024/08/24: æ·»åŠ ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½
- 2024/08/24: å®Œå–„æ–‡æ¡£ç»“æ„å’Œç»„ç»‡
- 2024/08/24: é›†æˆå¥—é¤åˆ†é…ç³»ç»Ÿ
# ä»£ç†å•†ç®¡ç†åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

ä»£ç†å•†ç®¡ç†åŠŸèƒ½æ˜¯åŸºäºç°æœ‰ç®¡ç†å‘˜ç³»ç»Ÿå¼€å‘çš„ä¸“é—¨ç”¨äºç®¡ç†ä»£ç†å•†çš„æ¨¡å—ã€‚è¯¥åŠŸèƒ½å¤ç”¨äº†ç°æœ‰çš„ç®¡ç†å‘˜è¡¨ï¼ˆ`la_admin`ï¼‰ï¼Œé€šè¿‡è§’è‰²ç³»ç»Ÿæ¥åŒºåˆ†ä»£ç†å•†èº«ä»½ï¼Œå¹¶å®ç°äº†å±‚çº§æƒé™æ§åˆ¶ã€‚

## æŠ€æœ¯å®ç°

### æ•°æ®è¡¨è®¾è®¡
- **å¤ç”¨ç°æœ‰è¡¨**ï¼šä½¿ç”¨ `la_admin` è¡¨å­˜å‚¨ä»£ç†å•†åŸºæœ¬ä¿¡æ¯
- **è§’è‰²åŒºåˆ†**ï¼šé€šè¿‡ `la_admin_role` å…³è”è¡¨ï¼Œä½¿ç”¨è§’è‰²ID=1ï¼ˆä»£ç†è§’è‰²ï¼‰æ¥æ ‡è¯†ä»£ç†å•†
- **çœŸå®åˆ é™¤**ï¼šä½¿ç”¨çœŸå®åˆ é™¤ï¼Œåˆ é™¤åæ•°æ®ä¸å¯æ¢å¤
- **å±‚çº§ç®¡ç†**ï¼šæ–°å¢ `parent_id` å­—æ®µï¼Œæ”¯æŒç®¡ç†å‘˜å±‚çº§å…³ç³»

### æ–‡ä»¶ç»“æ„
```
app/adminapi/
â”œâ”€â”€ controller/auth/AgentController.php     # ä»£ç†å•†æ§åˆ¶å™¨
â”œâ”€â”€ logic/auth/AgentLogic.php              # ä»£ç†å•†ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ lists/auth/AgentLists.php              # ä»£ç†å•†åˆ—è¡¨ç±»
â””â”€â”€ validate/auth/AgentValidate.php        # ä»£ç†å•†éªŒè¯å™¨

app/common/service/
â””â”€â”€ AdminHierarchyService.php              # ç®¡ç†å‘˜å±‚çº§æƒé™æ§åˆ¶æœåŠ¡
```

## åŠŸèƒ½ç‰¹æ€§

### 1. ä»£ç†å•†åˆ—è¡¨ (AgentLists)
- **ç­›é€‰åŠŸèƒ½**ï¼šåªæ˜¾ç¤ºå…·æœ‰ä»£ç†è§’è‰²ï¼ˆrole_id=1ï¼‰çš„ç®¡ç†å‘˜
- **æœç´¢æ”¯æŒ**ï¼šæ”¯æŒæŒ‰å§“åã€è´¦å·æ¨¡ç³Šæœç´¢
- **æ’åºåŠŸèƒ½**ï¼šæ”¯æŒæŒ‰åˆ›å»ºæ—¶é—´ã€IDæ’åº
- **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒExcelå¯¼å‡º

### 2. ä»£ç†å•†ç®¡ç† (AgentLogic)
- **æ·»åŠ ä»£ç†å•†**ï¼šè‡ªåŠ¨åˆ†é…ä»£ç†è§’è‰²ï¼Œåªéœ€åŸºæœ¬ä¿¡æ¯
- **ç¼–è¾‘ä»£ç†å•†**ï¼šä¿®æ”¹åŸºæœ¬ä¿¡æ¯ï¼Œç¡®ä¿å§‹ç»ˆä¿æŒä»£ç†è§’è‰²
- **åˆ é™¤ä»£ç†å•†**ï¼šè½¯åˆ é™¤ï¼ŒåŒæ—¶æ¸…ç†ç›¸å…³ç¼“å­˜å’Œtoken
- **è¯¦æƒ…æŸ¥çœ‹**ï¼šè·å–ä»£ç†å•†è¯¦ç»†ä¿¡æ¯

### 3. æ•°æ®éªŒè¯ (AgentValidate)
- **åŸºç¡€éªŒè¯**ï¼šè´¦å·ã€å§“åã€å¯†ç ç­‰åŸºç¡€å­—æ®µéªŒè¯
- **è§’è‰²éªŒè¯**ï¼šç¡®ä¿æ“ä½œçš„å¯¹è±¡æ˜¯ä»£ç†å•†
- **å”¯ä¸€æ€§éªŒè¯**ï¼šè´¦å·å”¯ä¸€æ€§æ£€æŸ¥

### 4. å±‚çº§æƒé™æ§åˆ¶ (AdminHierarchyService)
- **æƒé™éªŒè¯**ï¼šç®¡ç†å‘˜åªèƒ½æ“ä½œè‡ªå·±çš„ä¸‹çº§
- **å±‚çº§æŸ¥è¯¢**ï¼šé€’å½’æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§ç®¡ç†å‘˜
- **å…³ç³»éªŒè¯**ï¼šé˜²æ­¢å¾ªç¯å¼•ç”¨å’Œéæ³•ä¸Šçº§è®¾ç½®
- **ç¼“å­˜ä¼˜åŒ–**ï¼šä½¿ç”¨ç¼“å­˜æé«˜æŸ¥è¯¢æ€§èƒ½

### 5. APIæ¥å£ (AgentController)
- `GET /agent/lists` - è·å–ä»£ç†å•†åˆ—è¡¨
- `POST /agent/add` - æ·»åŠ ä»£ç†å•†
- `POST /agent/edit` - ç¼–è¾‘ä»£ç†å•†
- `POST /agent/delete` - åˆ é™¤ä»£ç†å•†
- `GET /agent/detail` - è·å–ä»£ç†å•†è¯¦æƒ…

## ä½¿ç”¨æ–¹æ³•

### 1. æ·»åŠ ä»£ç†å•†
```php
// è¯·æ±‚å‚æ•°
$params = [
    'name' => 'ä»£ç†å•†å§“å',
    'account' => 'ä»£ç†å•†è´¦å·',
    'password' => 'ç™»å½•å¯†ç ',
    'password_confirm' => 'ç¡®è®¤å¯†ç ',
    'disable' => 0,  // 0-å¯ç”¨ 1-ç¦ç”¨
    'multipoint_login' => 1,  // 0-ä¸æ”¯æŒå¤šç‚¹ç™»å½• 1-æ”¯æŒ
];
```

### 2. ç¼–è¾‘ä»£ç†å•†
```php
// è¯·æ±‚å‚æ•°
$params = [
    'id' => 1,  // ä»£ç†å•†ID
    'name' => 'æ–°å§“å',
    'account' => 'æ–°è´¦å·',
    'password' => 'æ–°å¯†ç ï¼ˆå¯é€‰ï¼‰',
    'disable' => 0,
    'multipoint_login' => 1
];
```

### 3. è·å–ä»£ç†å•†åˆ—è¡¨
```php
// è¯·æ±‚å‚æ•°ï¼ˆå¯é€‰ï¼‰
$params = [
    'name' => 'æœç´¢å…³é”®è¯',  // æŒ‰å§“åæœç´¢
    'account' => 'æœç´¢å…³é”®è¯',  // æŒ‰è´¦å·æœç´¢
    'page' => 1,  // é¡µç 
    'limit' => 25,  // æ¯é¡µæ•°é‡
    'sort_field' => 'create_time',  // æ’åºå­—æ®µ
    'sort_order' => 'desc'  // æ’åºæ–¹å‘
];
```

## å®‰å…¨ç‰¹æ€§

1. **è§’è‰²éš”ç¦»**ï¼šä»£ç†å•†åªèƒ½å…·æœ‰ä»£ç†è§’è‰²ï¼Œä¸èƒ½åˆ†é…å…¶ä»–è§’è‰²
2. **æƒé™æ§åˆ¶**ï¼šæ‰€æœ‰æ“ä½œéƒ½éœ€è¦ç›¸åº”çš„ç®¡ç†æƒé™
3. **æ•°æ®éªŒè¯**ï¼šä¸¥æ ¼çš„è¾“å…¥éªŒè¯ï¼Œé˜²æ­¢éæ³•æ•°æ®
4. **è½¯åˆ é™¤**ï¼šåˆ é™¤æ“ä½œä¸ä¼šç‰©ç†åˆ é™¤æ•°æ®ï¼Œå¯ä»¥æ¢å¤
5. **ç¼“å­˜æ¸…ç†**ï¼šä¿®æ”¹æ“ä½œä¼šè‡ªåŠ¨æ¸…ç†ç›¸å…³ç¼“å­˜

## æ³¨æ„äº‹é¡¹

1. **è§’è‰²ä¾èµ–**ï¼šç³»ç»Ÿä¸­å¿…é¡»å­˜åœ¨ID=1çš„"ä»£ç†"è§’è‰²
2. **ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼šä»£ç†å•†ç®¡ç†ä¸ä¼šå½±å“ç°æœ‰çš„ç®¡ç†å‘˜åŠŸèƒ½
3. **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ“ä½œéƒ½ä½¿ç”¨äº‹åŠ¡å¤„ç†ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
4. **æ€§èƒ½è€ƒè™‘**ï¼šåˆ—è¡¨æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–ï¼Œæ”¯æŒå¤§é‡æ•°æ®

## æ‰©å±•å»ºè®®

1. **æƒé™ç»†åŒ–**ï¼šå¯ä»¥ä¸ºä»£ç†å•†è§’è‰²é…ç½®ä¸“é—¨çš„èœå•æƒé™
2. **ä¸šåŠ¡æ•°æ®**ï¼šå¯ä»¥æ‰©å±•ä»£ç†å•†ç›¸å…³çš„ä¸šåŠ¡æ•°æ®è¡¨
3. **ç»Ÿè®¡æŠ¥è¡¨**ï¼šå¯ä»¥æ·»åŠ ä»£ç†å•†ä¸šåŠ¡ç»Ÿè®¡åŠŸèƒ½
4. **APIæ¥å£**ï¼šå¯ä»¥ä¸ºå‰ç«¯æä¾›æ›´å¤šçš„APIæ¥å£

## æ ¸å¿ƒç‰¹æ€§

1. **è§’è‰²è‡ªåŠ¨åˆ†é…**: æ·»åŠ ä»£ç†å•†æ—¶è‡ªåŠ¨åˆ†é…"ä»£ç†"è§’è‰²
2. **æ•°æ®éš”ç¦»**: ä»£ç†å•†æ•°æ®ä¸æ™®é€šç®¡ç†å‘˜æ•°æ®å®Œå…¨éš”ç¦»
3. **æƒé™æ§åˆ¶**: åªèƒ½æ“ä½œä»£ç†å•†ç›¸å…³æ•°æ®ï¼Œä¸å½±å“å…¶ä»–ç®¡ç†å‘˜
4. **å®Œæ•´CRUD**: æ”¯æŒä»£ç†å•†çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
5. **å”¯ä¸€æ€§**: è´¦å·åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ï¼Œå§“åå¯ä»¥é‡å¤
6. **å±‚çº§ç®¡ç†**: æ”¯æŒç®¡ç†å‘˜å±‚çº§å…³ç³»ï¼Œå®ç°ä¸Šä¸‹çº§æƒé™æ§åˆ¶
7. **è‡ªåŠ¨ä¸Šçº§**: æ·»åŠ ä»£ç†å•†æ—¶è‡ªåŠ¨å°†æ·»åŠ è€…è®¾ç½®ä¸ºä¸Šçº§
8. **æƒé™ç»§æ‰¿**: ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„ä¸‹çº§
9. **çœŸå®åˆ é™¤**: åˆ é™¤ä»£ç†å•†æ—¶ä½¿ç”¨çœŸå®åˆ é™¤ï¼Œç¡®ä¿æ•°æ®å½»åº•æ¸…ç†
10. **åˆ›å»ºæƒé™**: åªæœ‰å¹³å°ç®¡ç†å‘˜æ‰èƒ½åˆ›å»ºä»£ç†å•†ï¼Œç¡®ä¿ä¸Šçº§å…³ç³»æ­£ç¡®

## æµ‹è¯•éªŒè¯

åŠŸèƒ½å·²é€šè¿‡ä»¥ä¸‹æµ‹è¯•ï¼š
- âœ… ä»£ç†å•†æ·»åŠ åŠŸèƒ½
- âœ… ä»£ç†å•†ç¼–è¾‘åŠŸèƒ½
- âœ… ä»£ç†å•†åˆ é™¤åŠŸèƒ½
- âœ… ä»£ç†å•†è¯¦æƒ…æŸ¥çœ‹
- âœ… ä»£ç†å•†åˆ—è¡¨ç­›é€‰
- âœ… è§’è‰²è‡ªåŠ¨åˆ†é…
- âœ… ä¸å½±å“æ™®é€šç®¡ç†å‘˜åŠŸèƒ½
- âœ… å±‚çº§æƒé™æ§åˆ¶
- âœ… è‡ªåŠ¨ä¸Šçº§è®¾ç½®
- âœ… æƒé™éªŒè¯æœºåˆ¶
- âœ… çœŸå®åˆ é™¤åŠŸèƒ½
- âœ… å¹³å°ç®¡ç†å‘˜åˆ›å»ºæƒé™æ§åˆ¶

## ğŸ”„ æœ€æ–°åŠŸèƒ½æ›´æ–° (v1.9.4)

### å¥—é¤ç®¡ç†åŠŸèƒ½å¢å¼º

#### 1. å¥—é¤ç»­è´¹åŠŸèƒ½
- **å•ä¸ªç»­è´¹**: ä¸ºæŒ‡å®šå¥—é¤å»¶é•¿æœ‰æ•ˆæœŸ
- **æ‰¹é‡ç»­è´¹**: åŒæ—¶ä¸ºå¤šä¸ªå¥—é¤ç»­è´¹
- **æ™ºèƒ½è®¡ç®—**: æ ¹æ®å¥—é¤çŠ¶æ€æ™ºèƒ½è®¡ç®—æ–°çš„åˆ°æœŸæ—¶é—´
- **æƒé™æ§åˆ¶**: åªèƒ½ç»­è´¹è‡ªå·±åˆ†é…çš„å¥—é¤

#### 2. å°å·åˆ é™¤ä¼˜åŒ–
- **çº§è”åˆ é™¤**: åˆ é™¤å°å·æ—¶è‡ªåŠ¨æ¸…ç†åˆ†é…å…³ç³»
- **ç«¯å£é‡Šæ”¾**: åˆ é™¤åç«¯å£ç«‹å³å¯é‡æ–°åˆ†é…
- **æ•°æ®ä¸€è‡´æ€§**: ç¡®ä¿åˆ é™¤æ“ä½œçš„å®Œæ•´æ€§

#### 3. ç«¯å£åˆ†é…ä¼˜åŒ–
- **è¿‡æœŸæ£€æŸ¥**: åªèƒ½ä½¿ç”¨æœªè¿‡æœŸå¥—é¤çš„ç«¯å£
- **å®æ—¶è®¡ç®—**: åŠ¨æ€è®¡ç®—å¯ç”¨ç«¯å£æ•°é‡
- **çŠ¶æ€åŒæ­¥**: å¥—é¤è¿‡æœŸåç«‹å³åœæ­¢åˆ†é…

#### 4. æŸ¥è¯¢åŠŸèƒ½å¢å¼º
- **å…¨ç§Ÿæˆ·æŸ¥è¯¢**: æ”¯æŒæŸ¥çœ‹æ‰€æœ‰ç§Ÿæˆ·çš„å¥—é¤å†å²
- **çŠ¶æ€ç­›é€‰**: æ”¯æŒæŒ‰å¥—é¤çŠ¶æ€ç­›é€‰
- **æ•°æ®ä¼˜åŒ–**: ä¼˜åŒ–è¿”å›æ•°æ®æ ¼å¼å’Œæ—¶é—´å¤„ç†

### æ–°å¢APIæ¥å£
- `POST /package/renew` - å•ä¸ªå¥—é¤ç»­è´¹
- `POST /package/batch-renew` - æ‰¹é‡å¥—é¤ç»­è´¹
- `GET /package/renewable-packages` - è·å–å¯ç»­è´¹å¥—é¤åˆ—è¡¨

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ID=1çš„"ä»£ç†"è§’è‰²
2. ç›¸å…³è¡¨ç»“æ„æ˜¯å¦å®Œæ•´
3. æƒé™é…ç½®æ˜¯å¦æ­£ç¡®
4. ç¼“å­˜æ˜¯å¦éœ€è¦æ¸…ç†
5. æ–°å¢åŠŸèƒ½çš„æƒé™æ˜¯å¦å·²é…ç½®
# ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½æ˜¯åŸºäºlikeadminç®¡ç†ç³»ç»Ÿå¼€å‘çš„æ‰©å±•åŠŸèƒ½ï¼Œä¸“é—¨ç”¨äºç®¡ç†ç§Ÿæˆ·è´¦æˆ·ã€‚è¯¥åŠŸèƒ½åœ¨ç°æœ‰ç®¡ç†å‘˜ç³»ç»ŸåŸºç¡€ä¸Šï¼Œé€šè¿‡è§’è‰²åŒºåˆ†å®ç°ç§Ÿæˆ·çš„ä¸“é—¨ç®¡ç†ï¼Œå¹¶æ”¯æŒå±‚çº§æƒé™æ§åˆ¶ã€‚

ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½æ˜¯åŸºäºç°æœ‰ç®¡ç†å‘˜ç³»ç»Ÿå¼€å‘çš„ä¸“é—¨ç”¨äºç®¡ç†ç§Ÿæˆ·çš„æ¨¡å—ã€‚è¯¥åŠŸèƒ½å¤ç”¨äº†ç°æœ‰çš„ç®¡ç†å‘˜è¡¨ï¼ˆ`la_admin`ï¼‰ï¼Œé€šè¿‡è§’è‰²ç³»ç»Ÿæ¥åŒºåˆ†ç§Ÿæˆ·èº«ä»½ï¼Œå¹¶å®ç°äº†å±‚çº§æƒé™æ§åˆ¶ã€‚

## è®¾è®¡ç‰¹ç‚¹

- **å¤ç”¨ç°æœ‰è¡¨**ï¼šä½¿ç”¨ `la_admin` è¡¨å­˜å‚¨ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
- **è§’è‰²åŒºåˆ†**ï¼šé€šè¿‡ `la_admin_role` å…³è”è¡¨ï¼Œä½¿ç”¨è§’è‰²ID=2ï¼ˆç§Ÿæˆ·è§’è‰²ï¼‰æ¥æ ‡è¯†ç§Ÿæˆ·
- **çœŸå®åˆ é™¤**ï¼šä½¿ç”¨çœŸå®åˆ é™¤ï¼Œåˆ é™¤åæ•°æ®ä¸å¯æ¢å¤
- **å±‚çº§ç®¡ç†**ï¼šæ–°å¢ `parent_id` å­—æ®µï¼Œæ”¯æŒç®¡ç†å‘˜å±‚çº§å…³ç³»

## æ–‡ä»¶ç»“æ„

```
app/adminapi/
â”œâ”€â”€ controller/auth/TenantController.php     # ç§Ÿæˆ·æ§åˆ¶å™¨
â”œâ”€â”€ logic/auth/TenantLogic.php              # ç§Ÿæˆ·ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ lists/auth/TenantLists.php              # ç§Ÿæˆ·åˆ—è¡¨ç±»
â””â”€â”€ validate/auth/TenantValidate.php        # ç§Ÿæˆ·éªŒè¯å™¨

app/common/service/
â””â”€â”€ AgentAdminService.php                   # ä»£ç†å•†æƒé™æ§åˆ¶æœåŠ¡
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ•°æ®ç®¡ç† (TenantLogic)
- **æ·»åŠ ç§Ÿæˆ·**ï¼šåˆ›å»ºæ–°çš„ç§Ÿæˆ·è´¦å·ï¼Œè‡ªåŠ¨åˆ†é…ç§Ÿæˆ·è§’è‰²
- **ç¼–è¾‘ç§Ÿæˆ·**ï¼šä¿®æ”¹ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯ï¼Œæ”¯æŒå¯†ç ä¿®æ”¹
- **åˆ é™¤ç§Ÿæˆ·**ï¼šçœŸå®åˆ é™¤ç§Ÿæˆ·æ•°æ®ï¼Œæ¸…ç†å…³è”ä¿¡æ¯
- **æŸ¥çœ‹è¯¦æƒ…**ï¼šè·å–ç§Ÿæˆ·è¯¦ç»†ä¿¡æ¯

### 2. åˆ—è¡¨å±•ç¤º (TenantLists)
- **åˆ†é¡µåˆ—è¡¨**ï¼šæ”¯æŒåˆ†é¡µæ˜¾ç¤ºç§Ÿæˆ·åˆ—è¡¨
- **æœç´¢ç­›é€‰**ï¼šæ”¯æŒæŒ‰å§“åã€è´¦å·æœç´¢
- **æ’åºåŠŸèƒ½**ï¼šæ”¯æŒæŒ‰åˆ›å»ºæ—¶é—´ã€IDæ’åº
- **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒå¯¼å‡ºç§Ÿæˆ·åˆ—è¡¨åˆ°Excel

### 3. æ•°æ®éªŒè¯ (TenantValidate)
- **åŸºç¡€éªŒè¯**ï¼šè´¦å·ã€å§“åã€å¯†ç ç­‰åŸºç¡€å­—æ®µéªŒè¯
- **è§’è‰²éªŒè¯**ï¼šç¡®ä¿æ“ä½œçš„å¯¹è±¡æ˜¯ç§Ÿæˆ·
- **å”¯ä¸€æ€§éªŒè¯**ï¼šè´¦å·å”¯ä¸€æ€§æ£€æŸ¥

### 4. æƒé™æ§åˆ¶ (AgentAdminService)
- **æƒé™éªŒè¯**ï¼šåªæœ‰ä»£ç†å•†æ‰èƒ½åˆ›å»ºç§Ÿæˆ·
- **å±‚çº§æŸ¥è¯¢**ï¼šé€’å½’æŸ¥è¯¢æ‰€æœ‰ä¸‹çº§ç®¡ç†å‘˜
- **å…³ç³»éªŒè¯**ï¼šé˜²æ­¢å¾ªç¯å¼•ç”¨å’Œéæ³•ä¸Šçº§è®¾ç½®

### 5. APIæ¥å£ (TenantController)
- **RESTfulè®¾è®¡**ï¼šæ ‡å‡†çš„å¢åˆ æ”¹æŸ¥æ¥å£
- **æƒé™é›†æˆ**ï¼šé›†æˆå±‚çº§æƒé™æ§åˆ¶
- **å¼‚å¸¸å¤„ç†**ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ä¸šåŠ¡æµç¨‹

### ç§Ÿæˆ·åˆ›å»ºæµç¨‹
1. éªŒè¯æ“ä½œè€…æ˜¯å¦ä¸ºä»£ç†å•†
2. éªŒè¯ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
3. è®¾ç½®ä¸Šçº§å…³ç³»ï¼ˆåˆ›å»ºè€…ä¸ºä¸Šçº§ï¼‰
4. åˆ›å»ºç§Ÿæˆ·è´¦å·
5. åˆ†é…ç§Ÿæˆ·è§’è‰²
6. æ¸…é™¤æƒé™ç¼“å­˜

### ç§Ÿæˆ·ç¼–è¾‘æµç¨‹
1. éªŒè¯æ“ä½œæƒé™ï¼ˆåªèƒ½ç¼–è¾‘ä¸‹çº§ï¼‰
2. éªŒè¯ä¿®æ”¹ä¿¡æ¯
3. æ›´æ–°ç§Ÿæˆ·æ•°æ®
4. å¤„ç†å¯†ç ä¿®æ”¹
5. å¤„ç†ç¦ç”¨çŠ¶æ€
6. é‡æ–°åˆ†é…è§’è‰²

### ç§Ÿæˆ·åˆ é™¤æµç¨‹
1. éªŒè¯æ“ä½œæƒé™
2. æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹çº§
3. çœŸå®åˆ é™¤ç§Ÿæˆ·è®°å½•
4. æ¸…ç†Tokenå’Œç¼“å­˜
5. åˆ é™¤è§’è‰²å…³è”
6. æ¸…é™¤æƒé™ç¼“å­˜

## æƒé™æ§åˆ¶æœºåˆ¶

### åˆ›å»ºæƒé™
- åªæœ‰ä»£ç†å•†è§’è‰²æ‰èƒ½åˆ›å»ºç§Ÿæˆ·
- rootç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºç§Ÿæˆ·
- å¹³å°ç®¡ç†å‘˜æ— æ³•åˆ›å»ºç§Ÿæˆ·

### ç®¡ç†æƒé™
- ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·
- æ”¯æŒå¤šçº§å±‚çº§ç®¡ç†
- è‡ªåŠ¨ä¸Šçº§å…³ç³»è®¾ç½®

### æ•°æ®éš”ç¦»
- ä¸¥æ ¼çš„æ•°æ®æƒé™æ§åˆ¶
- é˜²æ­¢è¶Šæƒè®¿é—®
- å±‚çº§æƒé™ç»§æ‰¿

## æ ¸å¿ƒç‰¹æ€§

1. **è§’è‰²è‡ªåŠ¨åˆ†é…**: æ·»åŠ ç§Ÿæˆ·æ—¶è‡ªåŠ¨åˆ†é…"ç§Ÿæˆ·"è§’è‰²
2. **æ•°æ®éš”ç¦»**: ç§Ÿæˆ·æ•°æ®ä¸å…¶ä»–ç®¡ç†å‘˜æ•°æ®å®Œå…¨éš”ç¦»
3. **æƒé™æ§åˆ¶**: åªèƒ½æ“ä½œç§Ÿæˆ·ç›¸å…³æ•°æ®ï¼Œä¸å½±å“å…¶ä»–ç®¡ç†å‘˜
4. **å®Œæ•´CRUD**: æ”¯æŒç§Ÿæˆ·çš„å¢åˆ æ”¹æŸ¥æ“ä½œ
5. **å”¯ä¸€æ€§**: è´¦å·åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ï¼Œå§“åå¯ä»¥é‡å¤
6. **å±‚çº§ç®¡ç†**: æ”¯æŒç®¡ç†å‘˜å±‚çº§å…³ç³»ï¼Œå®ç°ä¸Šä¸‹çº§æƒé™æ§åˆ¶
7. **è‡ªåŠ¨ä¸Šçº§**: æ·»åŠ ç§Ÿæˆ·æ—¶è‡ªåŠ¨å°†æ·»åŠ è€…è®¾ç½®ä¸ºä¸Šçº§
8. **æƒé™ç»§æ‰¿**: ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„ä¸‹çº§
9. **çœŸå®åˆ é™¤**: åˆ é™¤ç§Ÿæˆ·æ—¶ä½¿ç”¨çœŸå®åˆ é™¤ï¼Œç¡®ä¿æ•°æ®å½»åº•æ¸…ç†
10. **åˆ›å»ºæƒé™**: åªæœ‰ä»£ç†å•†æ‰èƒ½åˆ›å»ºç§Ÿæˆ·ï¼Œç¡®ä¿ä¸Šçº§å…³ç³»æ­£ç¡®

## æ‰©å±•åŠŸèƒ½

1. **å¯¼å‡ºåŠŸèƒ½**ï¼šæ”¯æŒç§Ÿæˆ·åˆ—è¡¨å¯¼å‡º
2. **æœç´¢åŠŸèƒ½**ï¼šæ”¯æŒå¤šå­—æ®µæ¨¡ç³Šæœç´¢
3. **æ’åºåŠŸèƒ½**ï¼šæ”¯æŒå¤šå­—æ®µæ’åº
4. **æ‰¹é‡æ“ä½œ**ï¼šå¯æ‰©å±•æ‰¹é‡å¯ç”¨/ç¦ç”¨åŠŸèƒ½

## æµ‹è¯•éªŒè¯

- âœ… ç§Ÿæˆ·æ·»åŠ åŠŸèƒ½
- âœ… ç§Ÿæˆ·ç¼–è¾‘åŠŸèƒ½  
- âœ… ç§Ÿæˆ·åˆ é™¤åŠŸèƒ½
- âœ… ç§Ÿæˆ·è¯¦æƒ…æŸ¥çœ‹
- âœ… ç§Ÿæˆ·åˆ—è¡¨ç­›é€‰
- âœ… è§’è‰²è‡ªåŠ¨åˆ†é…
- âœ… ä¸å½±å“å…¶ä»–ç®¡ç†å‘˜åŠŸèƒ½
- âœ… å±‚çº§æƒé™æ§åˆ¶
- âœ… è‡ªåŠ¨ä¸Šçº§è®¾ç½®
- âœ… æƒé™éªŒè¯æœºåˆ¶
- âœ… çœŸå®åˆ é™¤åŠŸèƒ½
- âœ… ä»£ç†å•†åˆ›å»ºæƒé™æ§åˆ¶

## æ³¨æ„äº‹é¡¹

1. **æƒé™è¾¹ç•Œ**ï¼šä¸¥æ ¼æŒ‰ç…§å±‚çº§æƒé™æ§åˆ¶ï¼Œä¸èƒ½è¶Šæƒæ“ä½œ
2. **æ•°æ®å®‰å…¨**ï¼šçœŸå®åˆ é™¤ä¸å¯æ¢å¤ï¼Œæ“ä½œéœ€è°¨æ…
3. **è§’è‰²ä¸€è‡´æ€§**ï¼šç¡®ä¿ç§Ÿæˆ·å§‹ç»ˆå…·æœ‰ç§Ÿæˆ·è§’è‰²
4. **ä¸Šçº§å…³ç³»**ï¼šç§Ÿæˆ·çš„ä¸Šçº§å…³ç³»ä¸€æ—¦ç¡®å®šä¸å¯ä¿®æ”¹
5. **è´¦å·å”¯ä¸€æ€§**ï¼šè´¦å·åœ¨å…¨ç³»ç»ŸèŒƒå›´å†…å¿…é¡»å”¯ä¸€

## æŠ€æœ¯è¦ç‚¹

1. **å¤ç”¨è®¾è®¡**ï¼šæœ€å¤§åŒ–å¤ç”¨ç°æœ‰ä»£ç å’Œæ•°æ®ç»“æ„
2. **æƒé™é›†æˆ**ï¼šæ— ç¼é›†æˆå±‚çº§æƒé™æ§åˆ¶ç³»ç»Ÿ
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ç¼“å­˜æé«˜æƒé™æŸ¥è¯¢æ•ˆç‡
4. **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æç¤º
5. **ä»£ç è§„èŒƒ**ï¼šéµå¾ªé¡¹ç›®ç¼–ç è§„èŒƒå’Œæ³¨é‡Šè¦æ±‚

ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½ä¸ºç³»ç»Ÿæä¾›äº†å®Œæ•´çš„ç§Ÿæˆ·ç®¡ç†èƒ½åŠ›ï¼Œé€šè¿‡å±‚çº§æƒé™æ§åˆ¶ç¡®ä¿äº†æ•°æ®å®‰å…¨å’Œæ“ä½œè§„èŒƒï¼Œæ˜¯ç®¡ç†å‘˜å±‚çº§æƒé™ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚
# ç®¡ç†å‘˜å±‚çº§æƒé™æ§åˆ¶ç³»ç»Ÿ

## ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿå®ç°äº†å®Œæ•´çš„ç®¡ç†å‘˜å±‚çº§æƒé™æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡è§’è‰²å’Œä¸Šä¸‹çº§å…³ç³»ï¼Œç¡®ä¿æ¯ä¸ªç®¡ç†å‘˜åªèƒ½åœ¨è‡ªå·±çš„æƒé™èŒƒå›´å†…æ“ä½œï¼Œå®ç°äº†ä¸¥æ ¼çš„æ•°æ®éš”ç¦»å’Œæƒé™è¾¹ç•Œæ§åˆ¶ã€‚

## è§’è‰²å±‚çº§ç»“æ„

```
Rootç”¨æˆ· (è¶…çº§ç®¡ç†å‘˜)
    â†“
å¹³å°ç®¡ç†å‘˜ (è§’è‰²ID: 5)
    â†“
ä»£ç†å•† (è§’è‰²ID: 1)
    â†“
ç§Ÿæˆ· (è§’è‰²ID: 2)
```

## æƒé™æ§åˆ¶è§„åˆ™

### 1. åˆ›å»ºæƒé™
- **Rootç”¨æˆ·**: å¯ä»¥åˆ›å»ºä»»ä½•è§’è‰²çš„ç®¡ç†å‘˜
- **å¹³å°ç®¡ç†å‘˜**: åªèƒ½åˆ›å»ºä»£ç†å•†
- **ä»£ç†å•†**: åªèƒ½åˆ›å»ºç§Ÿæˆ·
- **ç§Ÿæˆ·**: æ— æ³•åˆ›å»ºå…¶ä»–ç®¡ç†å‘˜

### 2. ç®¡ç†æƒé™
- **æŸ¥çœ‹æƒé™**: ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹è‡ªå·±å’Œè‡ªå·±çš„ä¸‹çº§
- **ç¼–è¾‘æƒé™**: ç®¡ç†å‘˜åªèƒ½ç¼–è¾‘è‡ªå·±çš„ä¸‹çº§
- **åˆ é™¤æƒé™**: ç®¡ç†å‘˜åªèƒ½åˆ é™¤è‡ªå·±çš„ä¸‹çº§ï¼ˆä¸”è¯¥ä¸‹çº§æ²¡æœ‰ä¸‹çº§ï¼‰
- **Rootç‰¹æƒ**: Rootç”¨æˆ·å¯ä»¥æ“ä½œæ‰€æœ‰ç®¡ç†å‘˜

### 3. ä¸Šçº§å…³ç³»
- **è‡ªåŠ¨è®¾ç½®**: åˆ›å»ºç®¡ç†å‘˜æ—¶ï¼Œè‡ªåŠ¨å°†åˆ›å»ºè€…è®¾ç½®ä¸ºæ–°ç®¡ç†å‘˜çš„ä¸Šçº§
- **Rootä¾‹å¤–**: Rootç”¨æˆ·åˆ›å»ºçš„ç®¡ç†å‘˜å¯ä»¥æ˜¯é¡¶çº§ï¼ˆparent_id = 0ï¼‰
- **ä¸å¯ä¿®æ”¹**: ä¸Šçº§å…³ç³»ä¸€æ—¦ç¡®å®šï¼Œæ— æ³•é€šè¿‡ç¼–è¾‘æ¥å£ä¿®æ”¹
- **å¾ªç¯é˜²æŠ¤**: ç³»ç»Ÿé˜²æ­¢è®¾ç½®å¾ªç¯å¼•ç”¨çš„ä¸Šçº§å…³ç³»

## æ ¸å¿ƒæœåŠ¡ç±»

### 1. AdminHierarchyService (å±‚çº§æƒé™æ§åˆ¶)
```php
// è·å–æ‰€æœ‰ä¸‹çº§ID
AdminHierarchyService::getSubordinateIds($adminId);

// æƒé™éªŒè¯
AdminHierarchyService::hasPermission($operatorId, $targetId);

// è·å–å¯æŸ¥çœ‹çš„ç®¡ç†å‘˜ID
AdminHierarchyService::getViewableAdminIds($adminId);

// éªŒè¯ä¸Šçº§å…³ç³»
AdminHierarchyService::validateParentRelation($adminId, $parentId, $currentUserId);
```

### 2. PlatformAdminService (å¹³å°ç®¡ç†å‘˜æƒé™)
```php
// æ£€æŸ¥æ˜¯å¦ä¸ºå¹³å°ç®¡ç†å‘˜
PlatformAdminService::isPlatformAdmin($adminId);

// éªŒè¯å¹³å°ç®¡ç†å‘˜æƒé™
PlatformAdminService::validatePlatformAdmin($adminId, 'æ“ä½œåç§°');
```

### 3. AgentAdminService (ä»£ç†å•†æƒé™)
```php
// æ£€æŸ¥æ˜¯å¦ä¸ºä»£ç†å•†
AgentAdminService::isAgent($adminId);

// éªŒè¯ä»£ç†å•†æƒé™
AgentAdminService::validateAgent($adminId, 'æ“ä½œåç§°');
```

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒå­—æ®µ
- `parent_id`: ä¸Šçº§ç®¡ç†å‘˜IDï¼Œ0è¡¨ç¤ºé¡¶çº§
- `root`: æ˜¯å¦ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼Œ1è¡¨ç¤ºæ˜¯
- `role_id`: é€šè¿‡ `la_admin_role` è¡¨å…³è”è§’è‰²

### å…³é”®è¡¨ç»“æ„
```sql
-- ç®¡ç†å‘˜è¡¨
la_admin
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ parent_id (ä¸Šçº§ID)
â”œâ”€â”€ root (æ˜¯å¦è¶…çº§ç®¡ç†å‘˜)
â””â”€â”€ ... (å…¶ä»–å­—æ®µ)

-- è§’è‰²å…³è”è¡¨
la_admin_role
â”œâ”€â”€ admin_id (ç®¡ç†å‘˜ID)
â””â”€â”€ role_id (è§’è‰²ID)

-- è§’è‰²è¡¨
la_system_role
â”œâ”€â”€ id (è§’è‰²ID)
â”œâ”€â”€ name (è§’è‰²åç§°)
â””â”€â”€ desc (è§’è‰²æè¿°)
```

## æƒé™éªŒè¯æµç¨‹

### 1. åˆ›å»ºæµç¨‹
```
1. éªŒè¯åˆ›å»ºè€…è§’è‰²æƒé™
2. è®¾ç½®ä¸Šçº§å…³ç³»
3. éªŒè¯ä¸Šçº§å…³ç³»åˆæ³•æ€§
4. åˆ›å»ºç®¡ç†å‘˜è®°å½•
5. åˆ†é…å¯¹åº”è§’è‰²
6. æ¸…é™¤æƒé™ç¼“å­˜
```

### 2. æ“ä½œæµç¨‹
```
1. è·å–å½“å‰æ“ä½œè€…ID
2. è·å–ç›®æ ‡ç®¡ç†å‘˜ID
3. éªŒè¯æ“ä½œæƒé™
4. æ‰§è¡Œå…·ä½“æ“ä½œ
5. æ›´æ–°ç›¸å…³ç¼“å­˜
```

### 3. æŸ¥è¯¢æµç¨‹
```
1. è·å–å½“å‰ç®¡ç†å‘˜ID
2. æŸ¥è¯¢å¯æŸ¥çœ‹çš„ç®¡ç†å‘˜IDåˆ—è¡¨
3. åº”ç”¨æƒé™è¿‡æ»¤æ¡ä»¶
4. è¿”å›è¿‡æ»¤åçš„æ•°æ®
```

## å®‰å…¨æœºåˆ¶

### 1. æƒé™è¾¹ç•Œ
- **ä¸¥æ ¼éªŒè¯**: æ¯ä¸ªæ“ä½œéƒ½è¿›è¡Œæƒé™éªŒè¯
- **æ•°æ®éš”ç¦»**: ä¸åŒå±‚çº§çš„æ•°æ®å®Œå…¨éš”ç¦»
- **é˜²æ­¢è¶Šæƒ**: å¤šé‡æ£€æŸ¥é˜²æ­¢æƒé™ç»•è¿‡

### 2. æ•°æ®ä¿æŠ¤
- **Rootä¿æŠ¤**: Rootç”¨æˆ·ä¸èƒ½è¢«åˆ é™¤æˆ–é™çº§
- **å±‚çº§ä¿æŠ¤**: æœ‰ä¸‹çº§çš„ç®¡ç†å‘˜ä¸èƒ½è¢«åˆ é™¤
- **å¾ªç¯é˜²æŠ¤**: é˜²æ­¢è®¾ç½®å¾ªç¯å¼•ç”¨çš„ä¸Šçº§å…³ç³»

### 3. ç¼“å­˜æœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ç¼“å­˜æé«˜æŸ¥è¯¢æ•ˆç‡
- **è‡ªåŠ¨æ¸…ç†**: æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜
- **ä¸€è‡´æ€§ä¿è¯**: ç¡®ä¿ç¼“å­˜ä¸æ•°æ®åº“æ•°æ®ä¸€è‡´

## å®é™…åº”ç”¨åœºæ™¯

### 1. ä»£ç†å•†ç®¡ç†
- å¹³å°ç®¡ç†å‘˜åˆ›å»ºä»£ç†å•†
- ä»£ç†å•†ç®¡ç†è‡ªå·±çš„ä¸‹çº§ä»£ç†å•†
- å±‚çº§åˆ†æ¶¦å’Œä¸šåŠ¡ç®¡ç†

### 2. ç§Ÿæˆ·ç®¡ç†
- ä»£ç†å•†åˆ›å»ºç§Ÿæˆ·
- ç§Ÿæˆ·æ•°æ®éš”ç¦»
- å¤šç§Ÿæˆ·ä¸šåŠ¡æ”¯æŒ

### 3. æƒé™ç®¡æ§
- æ•°æ®è®¿é—®æ§åˆ¶
- æ“ä½œæƒé™é™åˆ¶
- ä¸šåŠ¡è¾¹ç•Œåˆ’åˆ†

## æ‰©å±•èƒ½åŠ›

### 1. è§’è‰²æ‰©å±•
- æ”¯æŒæ·»åŠ æ–°çš„è§’è‰²ç±»å‹
- çµæ´»çš„æƒé™é…ç½®
- è‡ªå®šä¹‰æƒé™è§„åˆ™

### 2. å±‚çº§æ‰©å±•
- æ”¯æŒæ— é™å±‚çº§æ·±åº¦
- åŠ¨æ€æƒé™ç»§æ‰¿
- å¤æ‚ç»„ç»‡æ¶æ„æ”¯æŒ

### 3. åŠŸèƒ½æ‰©å±•
- æ‰¹é‡æ“ä½œæ”¯æŒ
- æƒé™å§”æ‰˜æœºåˆ¶
- ä¸´æ—¶æƒé™æˆæƒ

## æ€§èƒ½ä¼˜åŒ–

### 1. æŸ¥è¯¢ä¼˜åŒ–
- ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- ç¼“å­˜çƒ­ç‚¹æ•°æ®
- å‡å°‘é€’å½’æŸ¥è¯¢

### 2. ç¼“å­˜ç­–ç•¥
- åˆ†å±‚ç¼“å­˜è®¾è®¡
- æ™ºèƒ½ç¼“å­˜æ›´æ–°
- ç¼“å­˜é¢„çƒ­æœºåˆ¶

### 3. æ•°æ®åº“ä¼˜åŒ–
- åˆç†çš„è¡¨ç»“æ„è®¾è®¡
- é«˜æ•ˆçš„æŸ¥è¯¢è¯­å¥
- é€‚å½“çš„æ•°æ®å†—ä½™

## ç›‘æ§å’Œç»´æŠ¤

### 1. æƒé™å®¡è®¡
- æ“ä½œæ—¥å¿—è®°å½•
- æƒé™å˜æ›´è¿½è¸ª
- å¼‚å¸¸è¡Œä¸ºç›‘æ§

### 2. æ•°æ®ä¸€è‡´æ€§
- å®šæœŸæ•°æ®æ ¡éªŒ
- å­¤å„¿æ•°æ®æ¸…ç†
- æƒé™å…³ç³»ä¿®å¤

### 3. æ€§èƒ½ç›‘æ§
- æŸ¥è¯¢æ€§èƒ½ç›‘æ§
- ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
- ç³»ç»Ÿè´Ÿè½½åˆ†æ

## æœ€ä½³å®è·µ

### 1. æƒé™è®¾è®¡
- æœ€å°æƒé™åŸåˆ™
- æ˜ç¡®çš„æƒé™è¾¹ç•Œ
- åˆç†çš„è§’è‰²åˆ’åˆ†

### 2. æ•°æ®ç®¡ç†
- è§„èŒƒçš„æ•°æ®æ“ä½œ
- å®Œæ•´çš„äº‹åŠ¡å¤„ç†
- åŠæ—¶çš„ç¼“å­˜æ›´æ–°

### 3. å®‰å…¨è€ƒè™‘
- è¾“å…¥æ•°æ®éªŒè¯
- æƒé™äºŒæ¬¡ç¡®è®¤
- æ•æ„Ÿæ“ä½œå®¡è®¡

ç®¡ç†å‘˜å±‚çº§æƒé™æ§åˆ¶ç³»ç»Ÿä¸ºä¸šåŠ¡æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æƒé™ç®¡ç†èƒ½åŠ›ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
# å¥—é¤åˆ†é…ç³»ç»Ÿé›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ‰ é›†æˆçŠ¶æ€ï¼šå®Œç¾é›†æˆ

ç»è¿‡å…¨é¢çš„åŠŸèƒ½å¼€å‘ã€æµ‹è¯•éªŒè¯å’Œä¼˜åŒ–ï¼Œ**å¥—é¤åˆ†é…ç³»ç»Ÿå·²å®Œç¾é›†æˆåˆ°å°å·ç®¡ç†ç³»ç»Ÿä¸­**ã€‚

## âœ… é›†æˆå®Œæˆçš„åŠŸèƒ½æ¨¡å—

### 1. å°å·åˆ†é…åŠŸèƒ½é›†æˆ âœ…
**ä½ç½®**: `app/adminapi/logic/AltAccountLogic::assignCustomerService()`

**é›†æˆå†…å®¹**:
- âœ… **ç«¯å£å¯ç”¨æ€§æ£€æŸ¥**: åŸºäºå¥—é¤åˆ†é…è¡¨è®¡ç®—ç«¯å£é…é¢
- âœ… **æƒé™å±‚çº§éªŒè¯**: ç¡®ä¿å®¢æœæ˜¯ç§Ÿæˆ·çš„ç›´æ¥ä¸‹çº§
- âœ… **è§’è‰²æƒé™éªŒè¯**: éªŒè¯ç›®æ ‡ç”¨æˆ·å…·æœ‰è¿è¥è§’è‰²
- âœ… **å°å·çŠ¶æ€éªŒè¯**: ç¡®ä¿å°å·æœªè¢«åˆ†é…ä¸”å±äºå½“å‰ç§Ÿæˆ·
- âœ… **äº‹åŠ¡å®‰å…¨ä¿éšœ**: æ‰€æœ‰æ“ä½œåœ¨æ•°æ®åº“äº‹åŠ¡ä¸­æ‰§è¡Œ

**æ ¸å¿ƒé€»è¾‘**:
```php
// 1. æƒé™éªŒè¯
AdminHierarchyService::hasPermission($currentAdminId, $operatorId)

// 2. ç«¯å£å¯ç”¨æ€§æ£€æŸ¥
$availability = self::checkPortAvailability($currentAdminId, $needCount);

// 3. å°å·åˆ†é…
AltAccount::where('id', 'in', $altAccountIds)->update([
    'operator_id' => $operatorId,
    'update_time' => time()
]);
```

### 2. ç§Ÿæˆ·åˆ—è¡¨ç«¯å£ç»Ÿè®¡é›†æˆ âœ…
**ä½ç½®**: `app/adminapi/lists/auth/TenantLists::calculatePortStats()`

**é›†æˆå†…å®¹**:
- âœ… **total_ports**: ç«¯å£æ€»æ•°ï¼ˆå½“å‰æœ‰æ•ˆç«¯å£æ•°é‡ï¼‰
- âœ… **used_ports**: å·²ç”¨ç«¯å£ï¼ˆå·²åˆ†é…ç»™å®¢æœçš„å°å·æ•°é‡ï¼‰
- âœ… **available_ports**: ç©ºé—²ç«¯å£ï¼ˆæ€»ç«¯å£ - å·²ç”¨ç«¯å£ï¼‰
- âœ… **expired_ports**: è¿‡æœŸç«¯å£ï¼ˆå·²è¿‡æœŸä½†çŠ¶æ€ä»ä¸º1çš„å¥—é¤ç«¯å£æ•°ï¼‰

**æ•°æ®æ¥æº**:
```php
// æ€»ç«¯å£æ•°ï¼šä»å¥—é¤åˆ†é…è¡¨
PackageAssignment::where('tenant_id', $tenantId)
    ->where('status', 1)
    ->where('expire_time', '>', time())
    ->sum('port_count');

// å·²ç”¨ç«¯å£æ•°ï¼šä»å°å·è¡¨
AltAccount::where('tenant_id', $tenantId)
    ->where('operator_id', '>', 0)
    ->count();
```

### 3. APIæ¥å£ç»Ÿä¸€æ€§ âœ…
**åŒæ¥å£æ”¯æŒ**:

#### åŸæœ‰æ¥å£ï¼ˆå®Œå…¨å…¼å®¹ï¼‰
```http
POST /adminapi/alt_account/assignCustomerService
{
    "alt_account_ids": [1, 2, 3],
    "operator_id": 56
}
```

#### æ–°å¢æ¥å£ï¼ˆåŠŸèƒ½ç›¸åŒï¼‰
```http
POST /adminapi/package/assign-alt-account
{
    "alt_account_ids": [1, 2, 3],
    "operator_id": 56
}
```

**åº•å±‚ç»Ÿä¸€**: ä¸¤ä¸ªæ¥å£éƒ½è°ƒç”¨ `AltAccountLogic::assignCustomerService()`

### 4. æ•°æ®è¡¨ç»“æ„ä¼˜åŒ– âœ…
**ä½¿ç”¨ç°æœ‰è¡¨ç»“æ„**:
- âœ… **la_alt_account.operator_id**: è®°å½•åˆ†é…å…³ç³»
- âœ… **la_alt_account.update_time**: è®°å½•åˆ†é…æ—¶é—´
- âœ… **la_package_assignment**: æä¾›ç«¯å£é…é¢æ§åˆ¶
- âœ… **æ— éœ€æ–°å¢è¡¨**: ç®€æ´é«˜æ•ˆçš„è®¾è®¡

## ğŸ§ª æµ‹è¯•éªŒè¯ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… **ç«¯å£ç®¡æ§é›†æˆ**: åŒ…å«ç«¯å£å¯ç”¨æ€§æ£€æŸ¥ï¼ŒåŸºäºå¥—é¤åˆ†é…è¡¨è®¡ç®—é…é¢
- âœ… **ç«¯å£ç»Ÿè®¡é›†æˆ**: åŒ…å«ç«¯å£ç»Ÿè®¡è®¡ç®—æ–¹æ³•ï¼Œæ˜¾ç¤ºç«¯å£ç›¸å…³å­—æ®µ
- âœ… **APIæ¥å£ç»Ÿä¸€**: ä¸¤ä¸ªæ¥å£å­˜åœ¨ä¸”åº•å±‚é€»è¾‘ç»Ÿä¸€
- âœ… **æƒé™éªŒè¯å®Œæ•´**: åŒ…å«å±‚çº§ã€è§’è‰²ã€ç§Ÿæˆ·æƒé™éªŒè¯
- âœ… **æ•°æ®ä¸€è‡´æ€§**: æ€»ç«¯å£æ•°200ï¼Œå·²ç”¨ç«¯å£æ•°3ï¼Œè®¡ç®—ä¸€è‡´

### æ€§èƒ½æµ‹è¯•
- âœ… **æŸ¥è¯¢æ•ˆç‡**: åŸºäºç°æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢é«˜æ•ˆ
- âœ… **æ“ä½œç®€å•**: å•è¡¨æ›´æ–°æ“ä½œï¼Œæ€§èƒ½ä¼˜ç§€
- âœ… **å¹¶å‘å®‰å…¨**: äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§

## ğŸ“Š ä¸šåŠ¡ä»·å€¼å®ç°

### 1. èµ„æºç®¡æ§
- **ç«¯å£é…é¢æ§åˆ¶**: ä¸¥æ ¼é™åˆ¶å°å·åˆ†é…æ•°é‡ï¼Œé˜²æ­¢è¶…å‡ºå¥—é¤é…é¢
- **å®æ—¶ç›‘æ§**: ç§Ÿæˆ·åˆ—è¡¨å®æ—¶æ˜¾ç¤ºç«¯å£ä½¿ç”¨æƒ…å†µ
- **è¶…é™ä¿æŠ¤**: åˆ†é…å‰æ£€æŸ¥ç«¯å£å¯ç”¨æ€§ï¼Œé¿å…èµ„æºæµªè´¹

### 2. æƒé™å®‰å…¨
- **å±‚çº§æ§åˆ¶**: åªèƒ½åˆ†é…ç»™ç›´æ¥ä¸‹çº§å®¢æœï¼Œç¡®ä¿æƒé™è¾¹ç•Œ
- **çŠ¶æ€éªŒè¯**: ç¦ç”¨è´¦å·æ— æ³•æ¥å—åˆ†é…ï¼Œä¿éšœç³»ç»Ÿå®‰å…¨
- **è§’è‰²éªŒè¯**: ç¡®ä¿åˆ†é…ç›®æ ‡å…·æœ‰æ­£ç¡®è§’è‰²ï¼Œé¿å…è¯¯æ“ä½œ

### 3. æ•°æ®è¿½æº¯
- **åˆ†é…å†å²**: é€šè¿‡update_timeè®°å½•åˆ†é…æ—¶é—´
- **è‡ªç„¶æ’åº**: åŸºäºIDçš„å…ˆè¿›å…ˆå‡ºé‡Šæ”¾ç­–ç•¥
- **çŠ¶æ€æŸ¥è¯¢**: å®æ—¶æŸ¥çœ‹å°å·åˆ†é…çŠ¶æ€

### 4. ç³»ç»Ÿé›†æˆ
- **ç»Ÿä¸€ç®¡ç†**: å¥—é¤å’Œå°å·åˆ†é…ç»Ÿä¸€ç®¡ç†
- **æ•°æ®ä¸€è‡´**: ç«¯å£ç»Ÿè®¡æ•°æ®å®æ—¶å‡†ç¡®
- **æ¥å£å…¼å®¹**: ä¿æŒåŸæœ‰APIçš„å®Œå…¨å…¼å®¹

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å°å·åˆ†é…
```bash
# æ–¹å¼1ï¼šåŸæœ‰æ¥å£
curl -X POST /adminapi/alt_account/assignCustomerService \
  -d '{"alt_account_ids":[1,2,3],"operator_id":56}'

# æ–¹å¼2ï¼šæ–°å¢æ¥å£  
curl -X POST /adminapi/package/assign-alt-account \
  -d '{"alt_account_ids":[1,2,3],"operator_id":56}'
```

### ç§Ÿæˆ·åˆ—è¡¨æŸ¥çœ‹
```bash
# è·å–åŒ…å«ç«¯å£ç»Ÿè®¡çš„ç§Ÿæˆ·åˆ—è¡¨
curl -X GET /adminapi/auth.tenant/lists
```

### ç«¯å£ç»Ÿè®¡å¯¼å‡º
```bash
# å¯¼å‡ºåŒ…å«ç«¯å£ç»Ÿè®¡çš„Excelæ–‡ä»¶
curl -X POST /adminapi/auth.tenant/export
```

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### æŠ€æœ¯ä¼˜åŠ¿
1. **ç®€æ´è®¾è®¡**: æ— éœ€æ–°å¢è¡¨ï¼ŒåŸºäºç°æœ‰ç»“æ„å®ç°
2. **é«˜æ€§èƒ½**: æŸ¥è¯¢é«˜æ•ˆï¼Œæ“ä½œç®€å•
3. **é«˜å¯é **: äº‹åŠ¡ä¿è¯ï¼Œæ•°æ®ä¸€è‡´
4. **æ˜“ç»´æŠ¤**: é€»è¾‘æ¸…æ™°ï¼Œç»“æ„ç®€å•

### ä¸šåŠ¡ä¼˜åŠ¿
1. **èµ„æºç®¡æ§**: ä¸¥æ ¼çš„ç«¯å£é…é¢æ§åˆ¶
2. **æƒé™å®‰å…¨**: å®Œæ•´çš„å±‚çº§å’Œè§’è‰²éªŒè¯
3. **å®æ—¶ç›‘æ§**: ç«¯å£ä½¿ç”¨æƒ…å†µå®æ—¶å¯è§
4. **å®Œå…¨å…¼å®¹**: ä¿æŒåŸæœ‰åŠŸèƒ½ä¸å˜

### è¿ç»´ä¼˜åŠ¿
1. **é›¶åœæœº**: æ— éœ€æ•°æ®è¿ç§»ï¼Œå¹³æ»‘å‡çº§
2. **é›¶é£é™©**: ä¸æ”¹å˜ç°æœ‰è¡¨ç»“æ„
3. **æ˜“ç›‘æ§**: æ¸…æ™°çš„æ•°æ®ç»Ÿè®¡å’ŒçŠ¶æ€æ˜¾ç¤º
4. **æ˜“æ‰©å±•**: ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•é¢„ç•™ç©ºé—´

## ğŸ“‹ æ€»ç»“

å¥—é¤åˆ†é…ç³»ç»Ÿå·²ç»**å®Œç¾é›†æˆ**åˆ°å°å·ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°äº†ï¼š

1. âœ… **åŠŸèƒ½å®Œæ•´**: ç«¯å£ç®¡æ§ã€æƒé™éªŒè¯ã€ç»Ÿè®¡æ˜¾ç¤ºå…¨éƒ¨åˆ°ä½
2. âœ… **æ€§èƒ½ä¼˜ç§€**: åŸºäºç°æœ‰è¡¨ç»“æ„ï¼ŒæŸ¥è¯¢é«˜æ•ˆï¼Œæ“ä½œç®€å•
3. âœ… **å…¼å®¹æ€§å¥½**: ä¿æŒåŸæœ‰APIå®Œå…¨å…¼å®¹ï¼Œå¹³æ»‘å‡çº§
4. âœ… **å®‰å…¨å¯é **: ä¸¥æ ¼çš„æƒé™æ§åˆ¶å’Œäº‹åŠ¡ä¿éšœ
5. âœ… **æ˜“äºç»´æŠ¤**: ç®€æ´çš„è®¾è®¡ï¼Œæ¸…æ™°çš„é€»è¾‘

ç°åœ¨ç³»ç»Ÿå…·å¤‡äº†ä¼ä¸šçº§çš„èµ„æºç®¡æ§èƒ½åŠ›ï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ï¼

---

## ğŸ”„ æœ€æ–°åŠŸèƒ½æ›´æ–° (v1.9.4)

### æ–°å¢åŠŸèƒ½

#### 1. å¥—é¤ç»­è´¹åŠŸèƒ½ âœ…
**ä½ç½®**: `app/adminapi/logic/PackageLogic::renew()`

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… **å•ä¸ªç»­è´¹**: æ”¯æŒä¸ºå•ä¸ªå¥—é¤å»¶é•¿æœ‰æ•ˆæœŸ
- âœ… **æ‰¹é‡ç»­è´¹**: æ”¯æŒåŒæ—¶ä¸ºå¤šä¸ªå¥—é¤ç»­è´¹
- âœ… **æ™ºèƒ½è®¡ç®—**: æœªè¿‡æœŸå¥—é¤åœ¨åŸåŸºç¡€ä¸Šå»¶é•¿ï¼Œå·²è¿‡æœŸå¥—é¤ä»å½“å‰æ—¶é—´å¼€å§‹
- âœ… **æƒé™æ§åˆ¶**: åªèƒ½ç»­è´¹è‡ªå·±åˆ†é…çš„å¥—é¤
- âœ… **çŠ¶æ€æ›´æ–°**: ç»­è´¹åå¥—é¤çŠ¶æ€è‡ªåŠ¨è®¾ä¸ºæœ‰æ•ˆ

**APIæ¥å£**:
- `POST /package/renew` - å•ä¸ªå¥—é¤ç»­è´¹
- `POST /package/batch-renew` - æ‰¹é‡å¥—é¤ç»­è´¹
- `GET /package/renewable-packages` - è·å–å¯ç»­è´¹å¥—é¤åˆ—è¡¨

#### 2. å°å·åˆ é™¤ä¼˜åŒ– âœ…
**ä½ç½®**: `app/adminapi/logic/AltAccountLogic::delete()`

**ä¼˜åŒ–å†…å®¹**:
- âœ… **çº§è”åˆ é™¤**: åˆ é™¤å°å·æ—¶è‡ªåŠ¨æ¸…ç†åˆ†é…å…³ç³»
- âœ… **ç«¯å£é‡Šæ”¾**: åˆ é™¤åç«¯å£ç«‹å³å¯é‡æ–°åˆ†é…
- âœ… **äº‹åŠ¡ä¿æŠ¤**: ç¡®ä¿åˆ é™¤æ“ä½œçš„æ•°æ®ä¸€è‡´æ€§

**æ ¸å¿ƒé€»è¾‘**:
```php
// åˆ é™¤åˆ†é…å…³ç³»ï¼ˆå¦‚æœå­˜åœ¨ï¼‰- é‡Šæ”¾ç«¯å£
AltAccountAssignment::where('alt_account_id', $params['id'])->delete();

// åˆ é™¤å°å·æœ¬èº«
$result = AltAccount::destroy($params['id']);
```

#### 3. ç«¯å£åˆ†é…ä¼˜åŒ– âœ…
**ä½ç½®**: `app/common/model/package/PackageAssignment::getTenantValidPorts()`

**ä¼˜åŒ–å†…å®¹**:
- âœ… **è¿‡æœŸæ£€æŸ¥**: åªè®¡ç®—æœªè¿‡æœŸå¥—é¤çš„ç«¯å£
- âœ… **å®æ—¶è®¡ç®—**: åŠ¨æ€è®¡ç®—å¯ç”¨ç«¯å£æ•°é‡
- âœ… **çŠ¶æ€åŒæ­¥**: å¥—é¤è¿‡æœŸåç«‹å³åœæ­¢åˆ†é…

#### 4. å†å²æŸ¥è¯¢ä¼˜åŒ– âœ…
**ä½ç½®**: `app/adminapi/logic/PackageLogic::getAssignHistory()`

**ä¼˜åŒ–å†…å®¹**:
- âœ… **å…¨ç§Ÿæˆ·æŸ¥è¯¢**: æ”¯æŒä¸é€‰æ‹©ç§Ÿæˆ·æŸ¥çœ‹å…¨éƒ¨è®°å½•
- âœ… **çŠ¶æ€ç­›é€‰**: æ”¯æŒæŒ‰å¥—é¤çŠ¶æ€ï¼ˆ0:è¿‡æœŸ 1:æœ‰æ•ˆï¼‰ç­›é€‰
- âœ… **å‚æ•°éªŒè¯**: ä¼˜åŒ–éªŒè¯å™¨ï¼Œæ”¯æŒå¯é€‰å‚æ•°

### æŠ€æœ¯ä¿®å¤

#### 1. æ—¶é—´å­—æ®µç±»å‹ä¿®å¤ âœ…
**é—®é¢˜**: æ¨¡å‹è·å–å™¨å¯¼è‡´æ—¶é—´æˆ³è¢«æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²
**è§£å†³**: åœ¨æ¨¡å‹ä¸­æ˜ç¡®è®¾ç½®æ—¶é—´å­—æ®µç±»å‹ä¸ºæ•´æ•°

```php
protected $type = [
    'assign_time' => 'integer',
    'expire_time' => 'integer',
    'create_time' => 'integer',
    'update_time' => 'integer',
];
```

#### 2. è¿”å›æ•°æ®ä¼˜åŒ– âœ…
**é—®é¢˜**: å¥—é¤åˆ†é…æˆåŠŸåè¿”å›ç©ºæ•°æ®
**è§£å†³**: è¿”å›è¯¦ç»†çš„åˆ†é…ä¿¡æ¯

```php
$assignInfo = [
    'tenant_id' => $params['tenant_id'],
    'port_count' => $params['port_count'],
    'expire_days' => $params['expire_days'],
    'assign_time' => date('Y-m-d H:i:s'),
    'expire_time' => date('Y-m-d H:i:s', time() + ($params['expire_days'] * 24 * 60 * 60))
];
```

#### 3. é€‰é¡¹æ¥å£æ•°æ®æ¸…ç† âœ…
**é—®é¢˜**: tenant_options æ¥å£è¿”å›é¢å¤–å­—æ®µ
**è§£å†³**: æ‰‹åŠ¨æ„é€ çº¯å‡€çš„æ•°ç»„ç»“æ„ï¼Œåªè¿”å›å¿…è¦å­—æ®µ

---

## ğŸ“Š ç³»ç»Ÿèƒ½åŠ›æ€»ç»“

ç»è¿‡æœ¬æ¬¡æ›´æ–°ï¼Œå¥—é¤åˆ†é…ç³»ç»Ÿç°åœ¨å…·å¤‡ï¼š

### æ ¸å¿ƒåŠŸèƒ½
1. âœ… **å¥—é¤åˆ†é…ç®¡ç†**: åˆ†é…ã€æŸ¥è¯¢ã€ç»Ÿè®¡
2. âœ… **å¥—é¤ç»­è´¹ç®¡ç†**: å•ä¸ªç»­è´¹ã€æ‰¹é‡ç»­è´¹
3. âœ… **ç«¯å£èµ„æºç®¡æ§**: å®æ—¶è®¡ç®—ã€è¿‡æœŸæ£€æŸ¥
4. âœ… **å°å·åˆ†é…é›†æˆ**: åŸºäºå¥—é¤çš„ç«¯å£é…é¢æ§åˆ¶
5. âœ… **æƒé™å±‚çº§æ§åˆ¶**: ä¸¥æ ¼çš„è§’è‰²å’Œå±‚çº§éªŒè¯
6. âœ… **æ•°æ®ç»Ÿè®¡å±•ç¤º**: å¤šç»´åº¦çš„ç»Ÿè®¡ä¿¡æ¯

### æŠ€æœ¯ç‰¹æ€§
1. âœ… **é«˜æ€§èƒ½**: åŸºäºç´¢å¼•çš„é«˜æ•ˆæŸ¥è¯¢
2. âœ… **é«˜å¯é **: äº‹åŠ¡ä¿æŠ¤å’Œé”™è¯¯å¤„ç†
3. âœ… **é«˜å…¼å®¹**: ä¿æŒåŸæœ‰APIå®Œå…¨å…¼å®¹
4. âœ… **æ˜“ç»´æŠ¤**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£

### ä¸šåŠ¡ä»·å€¼
1. âœ… **èµ„æºç®¡æ§**: ç²¾ç¡®çš„ç«¯å£é…é¢ç®¡ç†
2. âœ… **æˆæœ¬æ§åˆ¶**: åŸºäºå¥—é¤çš„è®¡è´¹æ¨¡å¼
3. âœ… **è¿è¥æ•ˆç‡**: è‡ªåŠ¨åŒ–çš„èµ„æºåˆ†é…å’Œå›æ”¶
4. âœ… **æ•°æ®æ´å¯Ÿ**: ä¸°å¯Œçš„ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

ç³»ç»Ÿå·²è¾¾åˆ°ä¼ä¸šçº§åº”ç”¨æ ‡å‡†ï¼Œä¸ºä¸šåŠ¡çš„è§„æ¨¡åŒ–å‘å±•æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼

## ğŸ“ v1.9.4 é‡å¤§å‡çº§æ€»ç»“

### ç»Ÿä¸€æœºåˆ¶å‡çº§
åœ¨v1.9.4ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿå®ç°äº†é‡å¤§çš„æ¶æ„å‡çº§ï¼š

#### æ ¸å¿ƒå˜æ›´
1. **ç»Ÿä¸€ç«¯å£ç»Ÿè®¡æœºåˆ¶**ï¼šä»åŸºäº`operator_id`æ”¹ä¸ºåŸºäº`package_id`çš„ç²¾ç¡®ç»Ÿè®¡
2. **å¥—é¤ä¼˜å…ˆçº§åˆ†é…ç­–ç•¥**ï¼šå®ç°"æœ€æ—©å¥—é¤ä¼˜å…ˆä½¿ç”¨"çš„æ™ºèƒ½åˆ†é…
3. **æ•°æ®ä¸€è‡´æ€§ä¿éšœ**ï¼šåˆ›å»ºç»Ÿä¸€çš„`PortStatisticsService`æœåŠ¡ç±»
4. **å®Œæ•´çš„æ•°æ®éªŒè¯ä½“ç³»**ï¼šæä¾›æ•°æ®ä¸€è‡´æ€§éªŒè¯æ¥å£

#### æŠ€æœ¯ä¼˜åŠ¿
1. **ç²¾ç¡®è¿½è¸ª**ï¼šæ¯ä¸ªå°å·è®°å½•ä½¿ç”¨çš„å…·ä½“å¥—é¤ID
2. **æ™ºèƒ½åˆ†é…**ï¼šè‡ªåŠ¨æŒ‰æ—¶é—´ä¼˜å…ˆçº§åˆ†é…ç«¯å£èµ„æº
3. **æ•°æ®ä¸€è‡´**ï¼šæ‰€æœ‰æ¥å£ä½¿ç”¨ç»Ÿä¸€çš„ç»Ÿè®¡æ ‡å‡†
4. **å‘åå…¼å®¹**ï¼šä¿æŒç°æœ‰APIæ¥å£å®Œå…¨ä¸å˜

#### ä¸šåŠ¡ä»·å€¼
1. **èµ„æºä¼˜åŒ–**ï¼šé¿å…æ—©æœŸå¥—é¤è¿‡æœŸæµªè´¹ï¼Œæé«˜åˆ©ç”¨ç‡
2. **ç®¡ç†æ¸…æ™°**ï¼šé€æ˜çš„å¥—é¤ä½¿ç”¨æƒ…å†µå’Œç²¾ç¡®çš„ç»Ÿè®¡æ•°æ®
3. **è¿è¥æ•ˆç‡**ï¼šè‡ªåŠ¨åŒ–çš„ä¼˜å…ˆçº§åˆ†é…å’Œæ™ºèƒ½çš„èµ„æºç®¡ç†
4. **æ•°æ®å¯é **ï¼šå®Œæ•´çš„éªŒè¯æœºåˆ¶ç¡®ä¿ç»Ÿè®¡å‡†ç¡®æ€§

### å‡çº§æˆæœ
- âœ… **æ•°æ®åº“ç»“æ„ä¼˜åŒ–**ï¼šæ–°å¢package_idå­—æ®µå’Œç›¸å…³ç´¢å¼•
- âœ… **ç»Ÿè®¡é€»è¾‘ç»Ÿä¸€**ï¼š5ä¸ªæ ¸å¿ƒæ¥å£ç»Ÿä¸€ä½¿ç”¨æ–°æœºåˆ¶
- âœ… **æœåŠ¡ç±»é‡æ„**ï¼šåˆ›å»ºPortStatisticsServiceç»Ÿä¸€ç®¡ç†
- âœ… **éªŒè¯ä½“ç³»å®Œå–„**ï¼šæä¾›å®Œæ•´çš„æ•°æ®ä¸€è‡´æ€§éªŒè¯
- âœ… **æ–‡æ¡£å…¨é¢æ›´æ–°**ï¼šæ›´æ–°æ‰€æœ‰ç›¸å…³æŠ€æœ¯æ–‡æ¡£

è¿™æ¬¡å‡çº§æ ‡å¿—ç€å¥—é¤åˆ†é…ç³»ç»Ÿä»åŠŸèƒ½å®Œæ•´æ€§å‘æ•°æ®ç²¾ç¡®æ€§å’Œä¸šåŠ¡æ™ºèƒ½åŒ–çš„é‡è¦è·ƒå‡ï¼
# ä»£ç†å•†ç®¡ç† API æ–‡æ¡£

## æ¦‚è¿°

ä»£ç†å•†ç®¡ç†åŠŸèƒ½æä¾›äº†å®Œæ•´çš„ä»£ç†å•†ä¿¡æ¯ç®¡ç†æ¥å£ï¼ŒåŒ…æ‹¬ä»£ç†å•†çš„å¢åˆ æ”¹æŸ¥ã€åˆ—è¡¨ç­›é€‰ã€æœç´¢ç­‰åŠŸèƒ½ã€‚æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç®¡ç†å‘˜æƒé™è®¤è¯ï¼Œå¹¶å®ç°äº†å±‚çº§æƒé™æ§åˆ¶ã€‚

**åŸºç¡€ä¿¡æ¯**
- åŸºç¡€è·¯å¾„: `/adminapi`
- è®¤è¯æ–¹å¼: Bearer Token (ç®¡ç†å‘˜ç™»å½•åè·å–)
- æ•°æ®æ ¼å¼: JSON
- å­—ç¬¦ç¼–ç : UTF-8

**å±‚çº§æƒé™æ§åˆ¶**
- ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„ä¸‹çº§ä»£ç†å•†
- rootç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œæ“ä½œæ‰€æœ‰ä»£ç†å•†
- æ·»åŠ ä»£ç†å•†æ—¶ï¼Œè‡ªåŠ¨å°†æ·»åŠ è€…è®¾ç½®ä¸ºæ–°ä»£ç†å•†çš„ä¸Šçº§
- ä¸æ”¯æŒä¿®æ”¹ä»£ç†å•†çš„ä¸Šçº§å…³ç³»

**åˆ›å»ºæƒé™æ§åˆ¶**
- åªæœ‰"å¹³å°ç®¡ç†å‘˜"è§’è‰²æ‰èƒ½åˆ›å»ºä»£ç†å•†
- rootç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºä»£ç†å•†
- æ™®é€šä»£ç†å•†æ— æ³•åˆ›å»ºæ–°çš„ä»£ç†å•†

---

## 1. ä»£ç†å•†åˆ—è¡¨

### æ¥å£ä¿¡æ¯
- **æ¥å£åœ°å€**: `GET /adminapi/auth.agent/lists`
- **æ¥å£æè¿°**: è·å–ä»£ç†å•†åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢ã€æ’åº
- **æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜ç™»å½•

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 | 1 |
| limit | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤25 | 25 |
| name | string | å¦ | æŒ‰å§“åæœç´¢ | å¼ ä¸‰ |
| account | string | å¦ | æŒ‰è´¦å·æœç´¢ | agent001 |
| sort_field | string | å¦ | æ’åºå­—æ®µ | create_time |
| sort_order | string | å¦ | æ’åºæ–¹å‘ asc/desc | desc |

### è¯·æ±‚ç¤ºä¾‹

```bash
GET /adminapi/auth.agent/lists?page=1&limit=10&name=å¼ ä¸‰
Authorization: Bearer your_admin_token
```

### å“åº”å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | int | çŠ¶æ€ç ï¼Œ1æˆåŠŸï¼Œ0å¤±è´¥ |
| msg | string | å“åº”æ¶ˆæ¯ |
| data | object | å“åº”æ•°æ® |
| data.lists | array | ä»£ç†å•†åˆ—è¡¨ |
| data.count | int | æ€»æ•°é‡ |
| data.page_no | int | å½“å‰é¡µç  |
| data.page_size | int | æ¯é¡µæ•°é‡ |

#### ä»£ç†å•†ä¿¡æ¯å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä»£ç†å•†ID |
| name | string | ä»£ç†å•†å§“å |
| account | string | ç™»å½•è´¦å· |
| avatar | string | å¤´åƒURL |
| create_time | string | åˆ›å»ºæ—¶é—´ |
| login_time | string | æœ€åç™»å½•æ—¶é—´ |
| login_ip | string | æœ€åç™»å½•IP |
| disable | int | çŠ¶æ€ 0-å¯ç”¨ 1-ç¦ç”¨ |
| disable_desc | string | çŠ¶æ€æè¿° |
| multipoint_login | int | å¤šç‚¹ç™»å½• 0-ä¸æ”¯æŒ 1-æ”¯æŒ |
| role_name | string | è§’è‰²åç§°ï¼Œå›ºå®šä¸º"ä»£ç†" |
| parent_name | string | ä¸Šçº§å§“å |

### å“åº”ç¤ºä¾‹

```json
{
    "code": 1,
    "msg": "æˆåŠŸ",
    "data": {
        "lists": [
            {
                "id": 2,
                "name": "å¼ ä¸‰ä»£ç†å•†",
                "account": "agent_zhangsan",
                "avatar": "http://example.com/avatar.jpg",
                "create_time": "2024-08-24 15:30:00",
                "login_time": "2024-08-24 16:00:00",
                "login_ip": "192.168.1.100",
                "disable": 0,
                "disable_desc": "æ­£å¸¸",
                "multipoint_login": 1,
                "role_name": "ä»£ç†",
                "parent_name": "admin"
            }
        ],
        "count": 1,
        "page_no": 1,
        "page_size": 25
    }
}
```

---

## 2. æ·»åŠ ä»£ç†å•†

### æ¥å£ä¿¡æ¯
- **æ¥å£åœ°å€**: `POST /adminapi/auth.agent/add`
- **æ¥å£æè¿°**: åˆ›å»ºæ–°çš„ä»£ç†å•†è´¦å·ï¼ˆä»…é™å¹³å°ç®¡ç†å‘˜ï¼‰
- **æƒé™è¦æ±‚**: éœ€è¦å¹³å°ç®¡ç†å‘˜è§’è‰²æˆ–rootç”¨æˆ·

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| name | string | æ˜¯ | ä»£ç†å•†å§“åï¼Œ1-16å­—ç¬¦ | å¼ ä¸‰ä»£ç†å•† |
| account | string | æ˜¯ | ç™»å½•è´¦å·ï¼Œ1-32å­—ç¬¦ï¼Œç³»ç»Ÿå”¯ä¸€ | agent_zhangsan |
| password | string | æ˜¯ | ç™»å½•å¯†ç ï¼Œ6-32å­—ç¬¦ | 123456 |
| password_confirm | string | æ˜¯ | ç¡®è®¤å¯†ç ï¼Œå¿…é¡»ä¸passwordä¸€è‡´ | 123456 |
| avatar | string | å¦ | å¤´åƒæ–‡ä»¶è·¯å¾„ | /uploads/avatar.jpg |
| disable | int | å¦ | çŠ¶æ€ï¼Œ0-å¯ç”¨ 1-ç¦ç”¨ï¼Œé»˜è®¤0 | 0 |
| multipoint_login | int | å¦ | å¤šç‚¹ç™»å½•ï¼Œ0-ä¸æ”¯æŒ 1-æ”¯æŒï¼Œé»˜è®¤1 | 1 |

### è¯·æ±‚ç¤ºä¾‹

```bash
POST /adminapi/auth.agent/add
Authorization: Bearer your_admin_token
Content-Type: application/json

{
    "name": "å¼ ä¸‰ä»£ç†å•†",
    "account": "agent_zhangsan",
    "password": "123456",
    "password_confirm": "123456",
    "disable": 0,
    "multipoint_login": 1
}
```

### å“åº”ç¤ºä¾‹

```json
{
    "code": 1,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": [],
    "count": 1,
    "show": 1
}
```

---

## 3. ç¼–è¾‘ä»£ç†å•†

### æ¥å£ä¿¡æ¯
- **æ¥å£åœ°å€**: `POST /adminapi/auth.agent/edit`
- **æ¥å£æè¿°**: ä¿®æ”¹ä»£ç†å•†ä¿¡æ¯
- **æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜ç™»å½•

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | int | æ˜¯ | ä»£ç†å•†ID | 2 |
| name | string | æ˜¯ | ä»£ç†å•†å§“åï¼Œ1-16å­—ç¬¦ | æå››ä»£ç†å•† |
| account | string | æ˜¯ | ç™»å½•è´¦å·ï¼Œ1-32å­—ç¬¦ï¼Œç³»ç»Ÿå”¯ä¸€ | agent_lisi |
| password | string | å¦ | æ–°å¯†ç ï¼Œ6-32å­—ç¬¦ï¼Œä¸å¡«åˆ™ä¸ä¿®æ”¹ | 654321 |
| password_confirm | string | å¦ | ç¡®è®¤å¯†ç ï¼Œå¡«å†™passwordæ—¶å¿…å¡« | 654321 |
| avatar | string | å¦ | å¤´åƒæ–‡ä»¶è·¯å¾„ | /uploads/new_avatar.jpg |
| disable | int | æ˜¯ | çŠ¶æ€ï¼Œ0-å¯ç”¨ 1-ç¦ç”¨ | 0 |
| multipoint_login | int | æ˜¯ | å¤šç‚¹ç™»å½•ï¼Œ0-ä¸æ”¯æŒ 1-æ”¯æŒ | 1 |

### è¯·æ±‚ç¤ºä¾‹

```bash
POST /adminapi/auth.agent/edit
Authorization: Bearer your_admin_token
Content-Type: application/json

{
    "id": 2,
    "name": "æå››ä»£ç†å•†",
    "account": "agent_lisi",
    "disable": 0,
    "multipoint_login": 1
}
```

### å“åº”ç¤ºä¾‹

```json
{
    "code": 1,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": [],
    "count": 1,
    "show": 1
}
```

---

## 4. åˆ é™¤ä»£ç†å•†

### æ¥å£ä¿¡æ¯
- **æ¥å£åœ°å€**: `POST /adminapi/auth.agent/delete`
- **æ¥å£æè¿°**: åˆ é™¤ä»£ç†å•†ï¼ˆçœŸå®åˆ é™¤ï¼Œä¸å¯æ¢å¤ï¼‰
- **æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜ç™»å½•

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | int | æ˜¯ | ä»£ç†å•†ID | 2 |

### è¯·æ±‚ç¤ºä¾‹

```bash
POST /adminapi/auth.agent/delete
Authorization: Bearer your_admin_token
Content-Type: application/json

{
    "id": 2
}
```

### å“åº”ç¤ºä¾‹

```json
{
    "code": 1,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": [],
    "count": 1,
    "show": 1
}
```

---

## 5. ä»£ç†å•†è¯¦æƒ…

### æ¥å£ä¿¡æ¯
- **æ¥å£åœ°å€**: `GET /adminapi/auth.agent/detail`
- **æ¥å£æè¿°**: è·å–ä»£ç†å•†è¯¦ç»†ä¿¡æ¯
- **æƒé™è¦æ±‚**: éœ€è¦ç®¡ç†å‘˜ç™»å½•

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | int | æ˜¯ | ä»£ç†å•†ID | 2 |

### è¯·æ±‚ç¤ºä¾‹

```bash
GET /adminapi/auth.agent/detail?id=2
Authorization: Bearer your_admin_token
```

### å“åº”å‚æ•°

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| code | int | çŠ¶æ€ç ï¼Œ1æˆåŠŸï¼Œ0å¤±è´¥ |
| msg | string | å“åº”æ¶ˆæ¯ |
| data | object | ä»£ç†å•†è¯¦ç»†ä¿¡æ¯ |

#### ä»£ç†å•†è¯¦æƒ…å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ä»£ç†å•†ID |
| name | string | ä»£ç†å•†å§“å |
| account | string | ç™»å½•è´¦å· |
| avatar | string | å¤´åƒURL |
| disable | int | çŠ¶æ€ 0-å¯ç”¨ 1-ç¦ç”¨ |
| root | int | æ˜¯å¦è¶…çº§ç®¡ç†å‘˜ 0-å¦ 1-æ˜¯ |
| multipoint_login | int | å¤šç‚¹ç™»å½• 0-ä¸æ”¯æŒ 1-æ”¯æŒ |
| parent_id | int | ä¸Šçº§ç®¡ç†å‘˜ID |
| parent_name | string | ä¸Šçº§å§“å |

### å“åº”ç¤ºä¾‹

```json
{
    "code": 1,
    "msg": "æˆåŠŸ",
    "data": {
        "id": 2,
        "name": "å¼ ä¸‰ä»£ç†å•†",
        "account": "agent_zhangsan",
        "avatar": "http://example.com/avatar.jpg",
        "disable": 0,
        "root": 0,
        "multipoint_login": 1,
        "parent_id": 1,
        "parent_name": "admin"
    }
}
```

---

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 0 | æ“ä½œå¤±è´¥ |
| 1 | æ“ä½œæˆåŠŸ |
| -1 | ç™»å½•è¶…æ—¶ï¼Œè¯·é‡æ–°ç™»å½• |

## å¸¸è§é”™è¯¯å“åº”

### å‚æ•°éªŒè¯å¤±è´¥
```json
{
    "code": 0,
    "msg": "è´¦å·ä¸èƒ½ä¸ºç©º",
    "data": [],
    "count": 0,
    "show": 1
}
```

### æƒé™ä¸è¶³
```json
{
    "code": 0,
    "msg": "ç™»å½•è¶…æ—¶ï¼Œè¯·é‡æ–°ç™»å½•",
    "data": [],
    "count": -1,
    "show": 0
}
```

### ä¸šåŠ¡é€»è¾‘é”™è¯¯
```json
{
    "code": 0,
    "msg": "è¯¥ç®¡ç†å‘˜ä¸æ˜¯ä»£ç†å•†",
    "data": [],
    "count": 0,
    "show": 1
}
```

---

## æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç®¡ç†å‘˜ç™»å½•è®¤è¯
2. **è§’è‰²é™åˆ¶**: ä»£ç†å•†åªèƒ½å…·æœ‰ä»£ç†è§’è‰²ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é…
3. **æ•°æ®å®‰å…¨**: åˆ é™¤æ“ä½œä¸ºçœŸå®åˆ é™¤ï¼Œæ•°æ®ä¸å¯æ¢å¤
4. **å¯†ç å®‰å…¨**: å¯†ç ä¼šè‡ªåŠ¨åŠ å¯†å­˜å‚¨
5. **å”¯ä¸€æ€§**: è´¦å·åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ï¼Œå§“åå¯ä»¥é‡å¤
6. **ç¼“å­˜æ¸…ç†**: ä¿®æ”¹æ“ä½œä¼šè‡ªåŠ¨æ¸…ç†ç›¸å…³ç¼“å­˜

## SDKç¤ºä¾‹

### JavaScript (Axios)

```javascript
// è·å–ä»£ç†å•†åˆ—è¡¨
const getAgentList = async (params = {}) => {
    try {
        const response = await axios.get('/adminapi/auth.agent/lists', {
            params,
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        return response.data;
    } catch (error) {
        console.error('è·å–ä»£ç†å•†åˆ—è¡¨å¤±è´¥:', error);
    }
};

// æ·»åŠ ä»£ç†å•†
const addAgent = async (agentData) => {
    try {
        const response = await axios.post('/adminapi/auth.agent/add', agentData, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });
        return response.data;
    } catch (error) {
        console.error('æ·»åŠ ä»£ç†å•†å¤±è´¥:', error);
    }
};
```

### PHP (cURL)

```php
// è·å–ä»£ç†å•†åˆ—è¡¨
function getAgentList($token, $params = []) {
    $url = '/adminapi/auth.agent/lists?' . http_build_query($params);
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Bearer ' . $token
    ]);
    
    $response = curl_exec($ch);
    curl_close($ch);
    
    return json_decode($response, true);
}

// æ·»åŠ ä»£ç†å•†
function addAgent($token, $agentData) {
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, '/adminapi/auth.agent/add');
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($agentData));
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Bearer ' . $token,
        'Content-Type: application/json'
    ]);
    
    $response = curl_exec($ch);
    curl_close($ch);
    
    return json_decode($response, true);
}
```
# ç§Ÿæˆ·ç®¡ç†APIæ–‡æ¡£

## æ¦‚è¿°

ç§Ÿæˆ·ç®¡ç†åŠŸèƒ½æä¾›äº†å®Œæ•´çš„ç§Ÿæˆ·ä¿¡æ¯ç®¡ç†æ¥å£ï¼ŒåŒ…æ‹¬ç§Ÿæˆ·çš„å¢åˆ æ”¹æŸ¥ã€åˆ—è¡¨ç­›é€‰ã€æœç´¢ç­‰åŠŸèƒ½ã€‚æ‰€æœ‰æ¥å£éƒ½éœ€è¦ç®¡ç†å‘˜æƒé™è®¤è¯ï¼Œå¹¶å®ç°äº†å±‚çº§æƒé™æ§åˆ¶ã€‚

**åŸºç¡€ä¿¡æ¯**
- åŸºç¡€è·¯å¾„: `/adminapi`
- è®¤è¯æ–¹å¼: Bearer Token (ç®¡ç†å‘˜ç™»å½•åè·å–)
- æ•°æ®æ ¼å¼: JSON
- å­—ç¬¦ç¼–ç : UTF-8

**å±‚çº§æƒé™æ§åˆ¶**
- ç®¡ç†å‘˜åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·
- rootç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œæ“ä½œæ‰€æœ‰ç§Ÿæˆ·
- æ·»åŠ ç§Ÿæˆ·æ—¶ï¼Œè‡ªåŠ¨å°†æ·»åŠ è€…è®¾ç½®ä¸ºæ–°ç§Ÿæˆ·çš„ä¸Šçº§
- ä¸æ”¯æŒä¿®æ”¹ç§Ÿæˆ·çš„ä¸Šçº§å…³ç³»

**åˆ›å»ºæƒé™æ§åˆ¶**
- åªæœ‰"ä»£ç†å•†"è§’è‰²æ‰èƒ½åˆ›å»ºç§Ÿæˆ·
- rootç”¨æˆ·ä¹Ÿå¯ä»¥åˆ›å»ºç§Ÿæˆ·
- å¹³å°ç®¡ç†å‘˜æ— æ³•åˆ›å»ºç§Ÿæˆ·

## æ¥å£åˆ—è¡¨

### 1. ç§Ÿæˆ·åˆ—è¡¨

#### GET /adminapi/auth.tenant/lists

è·å–ç§Ÿæˆ·åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢å’Œæ’åºã€‚

**è¯·æ±‚å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 | 1 |
| limit | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤15 | 15 |
| name | string | å¦ | ç§Ÿæˆ·å§“åæœç´¢ | å¼ ä¸‰ |
| account | string | å¦ | è´¦å·æœç´¢ | tenant001 |

**å“åº”ç¤ºä¾‹**

```json
{
    "code": 1,
    "msg": "æˆåŠŸ",
    "data": {
        "lists": [
            {
                "id": 38,
                "name": "å¼ ä¸‰ç§Ÿæˆ·",
                "account": "tenant_zhangsan",
                "create_time": "2024-08-24 10:30:00",
                "disable": 0,
                "disable_desc": "æ­£å¸¸",
                "multipoint_login": 1,
                "role_name": "ç§Ÿæˆ·",
                "parent_name": "ä»£ç†å•†A"
            }
        ],
        "count": 1,
        "page_no": 1,
        "page_size": 15
    }
}
```

**å“åº”å­—æ®µè¯´æ˜**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ç§Ÿæˆ·ID |
| name | string | ç§Ÿæˆ·å§“å |
| account | string | ç™»å½•è´¦å· |
| create_time | string | åˆ›å»ºæ—¶é—´ |
| disable | int | çŠ¶æ€ 0-å¯ç”¨ 1-ç¦ç”¨ |
| disable_desc | string | çŠ¶æ€æè¿° |
| multipoint_login | int | å¤šç‚¹ç™»å½• 0-ä¸æ”¯æŒ 1-æ”¯æŒ |
| role_name | string | è§’è‰²åç§°ï¼Œå›ºå®šä¸º"ç§Ÿæˆ·" |
| parent_name | string | ä¸Šçº§å§“å |

### 2. æ·»åŠ ç§Ÿæˆ·

#### POST /adminapi/auth.tenant/add

åˆ›å»ºæ–°çš„ç§Ÿæˆ·è´¦å·ã€‚

- **æ¥å£æè¿°**: åˆ›å»ºæ–°çš„ç§Ÿæˆ·è´¦å·ï¼ˆä»…é™ä»£ç†å•†ï¼‰
- **æƒé™è¦æ±‚**: éœ€è¦ä»£ç†å•†è§’è‰²æˆ–rootç”¨æˆ·

**è¯·æ±‚å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| name | string | æ˜¯ | ç§Ÿæˆ·å§“åï¼Œ1-16å­—ç¬¦ | å¼ ä¸‰ç§Ÿæˆ· |
| account | string | æ˜¯ | ç™»å½•è´¦å·ï¼Œ1-32å­—ç¬¦ï¼Œç³»ç»Ÿå”¯ä¸€ | tenant_zhangsan |
| password | string | æ˜¯ | ç™»å½•å¯†ç ï¼Œ6-32å­—ç¬¦ | 123456 |
| password_confirm | string | æ˜¯ | ç¡®è®¤å¯†ç ï¼Œå¿…é¡»ä¸passwordä¸€è‡´ | 123456 |
| avatar | string | å¦ | å¤´åƒURL | /uploads/avatar.jpg |
| multipoint_login | int | å¦ | å¤šç‚¹ç™»å½• 0-ä¸æ”¯æŒ 1-æ”¯æŒï¼Œé»˜è®¤1 | 1 |

**è¯·æ±‚ç¤ºä¾‹**

```json
{
    "name": "å¼ ä¸‰ç§Ÿæˆ·",
    "account": "tenant_zhangsan",
    "password": "123456",
    "password_confirm": "123456",
    "multipoint_login": 1
}
```

**å“åº”ç¤ºä¾‹**

```json
{
    "code": 1,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": [],
    "show": 1,
    "exit": 1
}
```

### 3. ç¼–è¾‘ç§Ÿæˆ·

#### POST /adminapi/auth.tenant/edit

ç¼–è¾‘ç§Ÿæˆ·ä¿¡æ¯ã€‚

- **æ¥å£æè¿°**: ç¼–è¾‘ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯
- **æƒé™è¦æ±‚**: åªèƒ½ç¼–è¾‘è‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·

**è¯·æ±‚å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | int | æ˜¯ | ç§Ÿæˆ·ID | 38 |
| name | string | æ˜¯ | ç§Ÿæˆ·å§“åï¼Œ1-16å­—ç¬¦ | æå››ç§Ÿæˆ· |
| account | string | æ˜¯ | ç™»å½•è´¦å·ï¼Œ1-32å­—ç¬¦ï¼Œç³»ç»Ÿå”¯ä¸€ | tenant_lisi |
| password | string | å¦ | ç™»å½•å¯†ç ï¼Œ6-32å­—ç¬¦ï¼Œä¸å¡«åˆ™ä¸ä¿®æ”¹ | 654321 |
| password_confirm | string | å¦ | ç¡®è®¤å¯†ç ï¼Œä¿®æ”¹å¯†ç æ—¶å¿…å¡« | 654321 |
| avatar | string | å¦ | å¤´åƒURL | /uploads/avatar2.jpg |
| disable | int | æ˜¯ | çŠ¶æ€ 0-å¯ç”¨ 1-ç¦ç”¨ | 0 |
| multipoint_login | int | æ˜¯ | å¤šç‚¹ç™»å½• 0-ä¸æ”¯æŒ 1-æ”¯æŒ | 1 |

**è¯·æ±‚ç¤ºä¾‹**

```json
{
    "id": 38,
    "name": "æå››ç§Ÿæˆ·",
    "account": "tenant_lisi",
    "disable": 0,
    "multipoint_login": 1
}
```

**å“åº”ç¤ºä¾‹**

```json
{
    "code": 1,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": [],
    "show": 1,
    "exit": 1
}
```

### 4. åˆ é™¤ç§Ÿæˆ·

#### POST /adminapi/auth.tenant/delete

åˆ é™¤æŒ‡å®šçš„ç§Ÿæˆ·ï¼ˆçœŸå®åˆ é™¤ï¼Œä¸å¯æ¢å¤ï¼‰ã€‚

- **æ¥å£æè¿°**: åˆ é™¤ç§Ÿæˆ·ï¼ˆçœŸå®åˆ é™¤ï¼Œä¸å¯æ¢å¤ï¼‰
- **æƒé™è¦æ±‚**: åªèƒ½åˆ é™¤è‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·

**è¯·æ±‚å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | int | æ˜¯ | ç§Ÿæˆ·ID | 38 |

**è¯·æ±‚ç¤ºä¾‹**

```json
{
    "id": 38
}
```

**å“åº”ç¤ºä¾‹**

```json
{
    "code": 1,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": [],
    "show": 1,
    "exit": 1
}
```

### 5. ç§Ÿæˆ·è¯¦æƒ…

#### GET /adminapi/auth.tenant/detail

è·å–ç§Ÿæˆ·è¯¦ç»†ä¿¡æ¯ã€‚

- **æ¥å£æè¿°**: è·å–ç§Ÿæˆ·è¯¦ç»†ä¿¡æ¯
- **æƒé™è¦æ±‚**: åªèƒ½æŸ¥çœ‹è‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·

**è¯·æ±‚å‚æ•°**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| id | int | æ˜¯ | ç§Ÿæˆ·ID | 38 |

**å“åº”ç¤ºä¾‹**

```json
{
    "code": 1,
    "msg": "æˆåŠŸ",
    "data": {
        "id": 38,
        "account": "tenant_zhangsan",
        "name": "å¼ ä¸‰ç§Ÿæˆ·",
        "avatar": "http://example.com/avatar.jpg",
        "disable": 0,
        "root": 0,
        "multipoint_login": 1,
        "parent_id": 28,
        "parent_name": "ä»£ç†å•†A"
    }
}
```

**å“åº”å­—æ®µè¯´æ˜**

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | int | ç§Ÿæˆ·ID |
| account | string | ç™»å½•è´¦å· |
| name | string | ç§Ÿæˆ·å§“å |
| avatar | string | å¤´åƒURL |
| disable | int | çŠ¶æ€ 0-å¯ç”¨ 1-ç¦ç”¨ |
| root | int | æ˜¯å¦è¶…çº§ç®¡ç†å‘˜ 0-å¦ 1-æ˜¯ |
| multipoint_login | int | å¤šç‚¹ç™»å½• 0-ä¸æ”¯æŒ 1-æ”¯æŒ |
| parent_id | int | ä¸Šçº§ç®¡ç†å‘˜ID |
| parent_name | string | ä¸Šçº§å§“å |

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ |
|--------|------|
| 0 | æ“ä½œå¤±è´¥ |
| 1 | æ“ä½œæˆåŠŸ |

## å¸¸è§é”™è¯¯ä¿¡æ¯

| é”™è¯¯ä¿¡æ¯ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|
| åˆ›å»ºç§Ÿæˆ·åªèƒ½ç”±ä»£ç†å•†æ‰§è¡Œ | éä»£ç†å•†å°è¯•åˆ›å»ºç§Ÿæˆ· | ç¡®ä¿æ“ä½œè€…å…·æœ‰ä»£ç†å•†è§’è‰² |
| æ‚¨æ²¡æœ‰æƒé™ç¼–è¾‘è¯¥ç§Ÿæˆ· | å°è¯•ç¼–è¾‘éä¸‹çº§ç§Ÿæˆ· | åªèƒ½ç¼–è¾‘è‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ· |
| æ‚¨æ²¡æœ‰æƒé™åˆ é™¤è¯¥ç§Ÿæˆ· | å°è¯•åˆ é™¤éä¸‹çº§ç§Ÿæˆ· | åªèƒ½åˆ é™¤è‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ· |
| è´¦å·å·²å­˜åœ¨ | è´¦å·é‡å¤ | ä½¿ç”¨ä¸åŒçš„è´¦å· |
| è¯¥ç§Ÿæˆ·è¿˜æœ‰ä¸‹çº§ï¼Œæ— æ³•åˆ é™¤ | ç§Ÿæˆ·æœ‰ä¸‹çº§ç®¡ç†å‘˜ | å…ˆåˆ é™¤ä¸‹çº§ç®¡ç†å‘˜ |

## ä¸šåŠ¡è§„åˆ™

1. **è§’è‰²é™åˆ¶**: åªæœ‰ä»£ç†å•†è§’è‰²æ‰èƒ½åˆ›å»ºç§Ÿæˆ·
2. **å±‚çº§å…³ç³»**: ç§Ÿæˆ·çš„ä¸Šçº§è‡ªåŠ¨è®¾ç½®ä¸ºåˆ›å»ºè€…
3. **æƒé™è¾¹ç•Œ**: ç®¡ç†å‘˜åªèƒ½æ“ä½œè‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·
4. **æ•°æ®å®‰å…¨**: åˆ é™¤æ“ä½œä¸ºçœŸå®åˆ é™¤ï¼Œæ•°æ®ä¸å¯æ¢å¤
5. **å”¯ä¸€æ€§**: è´¦å·åœ¨ç³»ç»Ÿä¸­å¿…é¡»å”¯ä¸€ï¼Œå§“åå¯ä»¥é‡å¤
6. **çœŸå®åˆ é™¤**: åˆ é™¤ç§Ÿæˆ·æ—¶ä½¿ç”¨çœŸå®åˆ é™¤ï¼Œç¡®ä¿æ•°æ®å½»åº•æ¸…ç†

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦æœ‰æ•ˆçš„ç®¡ç†å‘˜Token
2. åˆ›å»ºç§Ÿæˆ·æ—¶ä¼šè‡ªåŠ¨åˆ†é…ç§Ÿæˆ·è§’è‰²ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®š
3. ç§Ÿæˆ·çš„ä¸Šçº§å…³ç³»ä¸€æ—¦ç¡®å®šï¼Œæ— æ³•é€šè¿‡ç¼–è¾‘æ¥å£ä¿®æ”¹
4. åˆ é™¤æ“ä½œä¸å¯é€†ï¼Œè¯·è°¨æ…æ“ä½œ
5. è´¦å·å…·æœ‰å…¨å±€å”¯ä¸€æ€§ï¼Œä¸èƒ½ä¸å…¶ä»–ç®¡ç†å‘˜è´¦å·é‡å¤
# ä»£ç†å•†å¥—é¤åˆ†é…ç³»ç»ŸAPIæ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£æ¦‚è§ˆ

### **åŸºç¡€ä¿¡æ¯**
- **åŸºç¡€URL**: `http://your-domain/adminapi`
- **è®¤è¯æ–¹å¼**: Bearer Token
- **è¯·æ±‚æ ¼å¼**: JSON
- **å“åº”æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

### **ç»Ÿä¸€å“åº”æ ¼å¼**
```json
{
  "code": 1,           // çŠ¶æ€ç ï¼š1-æˆåŠŸï¼Œ0-å¤±è´¥ï¼Œ-1-ç™»å½•å¤±æ•ˆ
  "msg": "æ“ä½œæˆåŠŸ",    // æç¤ºä¿¡æ¯
  "data": {},          // å“åº”æ•°æ®
  "show": 1            // æ˜¯å¦æ˜¾ç¤ºæç¤ºï¼š1-æ˜¾ç¤ºï¼Œ0-ä¸æ˜¾ç¤º
}
```

## ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½æ¥å£

### 1. åˆ†é…å¥—é¤

**æ¥å£åœ°å€**: `POST /package/assign`  
**æƒé™æ ‡è¯†**: `package/assign`  
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†

#### è¯·æ±‚å‚æ•°
```json
{
  "tenant_id": 123,        // ç§Ÿæˆ·IDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
  "port_count": 100,       // ç«¯å£æ•°é‡ï¼Œå¿…å¡«ï¼Œ1-10000
  "expire_days": 30,       // æœ‰æ•ˆå¤©æ•°ï¼Œå¿…å¡«ï¼Œ1-3650
  "remark": "æµ‹è¯•åˆ†é…"     // å¤‡æ³¨ï¼Œå¯é€‰ï¼Œæœ€å¤§255å­—ç¬¦
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "å¥—é¤åˆ†é…æˆåŠŸ",
  "data": {},
  "show": 1
}
```

#### é”™è¯¯ç¤ºä¾‹
```json
{
  "code": 0,
  "msg": "æ‚¨åªèƒ½ä¸ºè‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·åˆ†é…å¥—é¤",
  "data": {},
  "show": 1
}
```

---

### 2. æŸ¥è¯¢ç§Ÿæˆ·å¥—é¤

**æ¥å£åœ°å€**: `GET /package/tenant-packages`  
**æƒé™æ ‡è¯†**: `package/tenant-packages`  
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†ã€ç§Ÿæˆ·

#### è¯·æ±‚å‚æ•°
```
tenant_id=123    // ç§Ÿæˆ·IDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "port_pool_status": {
      "total_ports": 500,        // æ€»ç«¯å£æ•°
      "used_ports": 200,         // å·²ç”¨ç«¯å£æ•°
      "available_ports": 300,    // å¯ç”¨ç«¯å£æ•°
      "expiring_soon": 50        // å³å°†è¿‡æœŸç«¯å£æ•°ï¼ˆ7å¤©å†…ï¼‰
    },
    "packages": [
      {
        "id": 1,
        "agent_name": "ä»£ç†å•†A",
        "port_count": 200,
        "assign_time_text": "2025-08-27 10:00:00",
        "expire_time_text": "2025-09-26 10:00:00",
        "status_text": "æœ‰æ•ˆ",
        "remaining_days": 30,
        "remark": "æµ‹è¯•å¥—é¤"
      }
    ],
    "assigned_accounts": [
      {
        "alt_account_id": 1001,
        "operator_name": "å®¢æœA",
        "assign_time_text": "2025-08-27 11:00:00"
      }
    ]
  },
  "show": 0
}
```

---

### 3. åˆ†é…å°å·

**æ¥å£åœ°å€**: `POST /package/assign-alt-account`  
**æƒé™æ ‡è¯†**: `package/assign-alt-account`  
**é€‚ç”¨è§’è‰²**: ç§Ÿæˆ·

#### è¯·æ±‚å‚æ•°
```json
{
  "alt_account_ids": [1001, 1002, 1003],  // å°å·IDæ•°ç»„ï¼Œå¿…å¡«ï¼Œæœ€å¤š1000ä¸ª
  "operator_id": 456                      // å®¢æœIDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "å°å·åˆ†é…æˆåŠŸ",
  "data": {},
  "show": 1
}
```

#### é”™è¯¯ç¤ºä¾‹
```json
{
  "code": 0,
  "msg": "ç«¯å£ä¸è¶³ï¼Œå½“å‰å¯ç”¨ç«¯å£ï¼š2ä¸ªï¼Œéœ€è¦ï¼š3ä¸ª",
  "data": {},
  "show": 1
}
```

---

### 4. æ£€æŸ¥ç«¯å£å¯ç”¨æ€§

**æ¥å£åœ°å€**: `GET /package/check-port-availability`  
**æƒé™æ ‡è¯†**: `package/check-port-availability`  
**é€‚ç”¨è§’è‰²**: ç§Ÿæˆ·

#### è¯·æ±‚å‚æ•°
```
tenant_id=123      // ç§Ÿæˆ·IDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
need_count=50      // éœ€è¦ç«¯å£æ•°ï¼Œå¯é€‰ï¼Œé»˜è®¤0
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "available": true,           // æ˜¯å¦å¯ç”¨
    "total_ports": 500,          // æ€»ç«¯å£æ•°
    "used_ports": 200,           // å·²ç”¨ç«¯å£æ•°
    "available_ports": 300,      // å¯ç”¨ç«¯å£æ•°
    "need_ports": 50,            // éœ€è¦ç«¯å£æ•°
    "can_assign": true           // æ˜¯å¦å¯ä»¥åˆ†é…
  },
  "show": 0
}
```

---

### 5. åˆ†é…å†å²æŸ¥è¯¢

**æ¥å£åœ°å€**: `GET /package/assign-history`  
**æƒé™æ ‡è¯†**: `package/assign-history`  
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†ã€ç®¡ç†å‘˜

#### è¯·æ±‚å‚æ•°
```
tenant_id=123                    // ç§Ÿæˆ·IDï¼Œå¯é€‰
status=1                         // çŠ¶æ€ï¼Œå¯é€‰ï¼Œ0-è¿‡æœŸï¼Œ1-æœ‰æ•ˆ
time_range[]=2025-08-01         // å¼€å§‹æ—¶é—´ï¼Œå¯é€‰
time_range[]=2025-08-31         // ç»“æŸæ—¶é—´ï¼Œå¯é€‰
page=1                          // é¡µç ï¼Œå¯é€‰ï¼Œé»˜è®¤1
limit=20                        // æ¯é¡µæ•°é‡ï¼Œå¯é€‰ï¼Œé»˜è®¤20
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 100,
    "per_page": 20,
    "current_page": 1,
    "last_page": 5,
    "data": [
      {
        "id": 1,
        "agent_name": "ä»£ç†å•†A",
        "tenant_name": "ç§Ÿæˆ·B",
        "port_count": 200,
        "assign_time_text": "2025-08-27 10:00:00",
        "expire_time_text": "2025-09-26 10:00:00",
        "status_text": "æœ‰æ•ˆ",
        "remaining_days": 30,
        "remark": "æµ‹è¯•åˆ†é…"
      }
    ]
  },
  "show": 0
}
```

## ğŸ“Š ç®¡ç†åŠŸèƒ½æ¥å£

### 6. å¥—é¤åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /package/lists`  
**æƒé™æ ‡è¯†**: `package/lists`  
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†ã€ç®¡ç†å‘˜

#### è¯·æ±‚å‚æ•°
```
agent_id=123                     // ä»£ç†å•†IDï¼Œå¯é€‰
tenant_id=456                    // ç§Ÿæˆ·IDï¼Œå¯é€‰
status=1                         // çŠ¶æ€ï¼Œå¯é€‰
remark=æµ‹è¯•                      // å¤‡æ³¨å…³é”®è¯ï¼Œå¯é€‰
expire_status=valid              // åˆ°æœŸçŠ¶æ€ï¼Œå¯é€‰ï¼švalid-æœ‰æ•ˆï¼Œexpired-å·²è¿‡æœŸï¼Œexpiring_soon-å³å°†è¿‡æœŸ
port_count_min=100              // æœ€å°ç«¯å£æ•°ï¼Œå¯é€‰
port_count_max=1000             // æœ€å¤§ç«¯å£æ•°ï¼Œå¯é€‰
start_time=2025-08-01           // å¼€å§‹æ—¶é—´ï¼Œå¯é€‰
end_time=2025-08-31             // ç»“æŸæ—¶é—´ï¼Œå¯é€‰
page=1                          // é¡µç ï¼Œå¯é€‰
limit=20                        // æ¯é¡µæ•°é‡ï¼Œå¯é€‰
sort_field=create_time          // æ’åºå­—æ®µï¼Œå¯é€‰
sort_order=desc                 // æ’åºæ–¹å‘ï¼Œå¯é€‰ï¼šasc-å‡åºï¼Œdesc-é™åº
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total": 100,
    "per_page": 20,
    "current_page": 1,
    "last_page": 5,
    "data": [
      {
        "id": 1,
        "agent_name": "ä»£ç†å•†A",
        "agent_account": "agent001",
        "tenant_name": "ç§Ÿæˆ·B",
        "tenant_account": "tenant001",
        "port_count": 200,
        "assign_time_text": "2025-08-27 10:00:00",
        "expire_time_text": "2025-09-26 10:00:00",
        "status_text": "æœ‰æ•ˆ",
        "remaining_days": 30,
        "is_expiring_soon": false,
        "remark": "æµ‹è¯•åˆ†é…"
      }
    ]
  },
  "show": 0
}
```

---

### 7. ç»Ÿè®¡ä¿¡æ¯

**æ¥å£åœ°å€**: `GET /package/statistics`  
**æƒé™æ ‡è¯†**: `package/statistics`  
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†ã€ç®¡ç†å‘˜

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total_count": 150,              // æ€»è®°å½•æ•°
    "total_ports": 15000,            // æ€»ç«¯å£æ•°
    "valid_count": 120,              // æœ‰æ•ˆè®°å½•æ•°
    "valid_ports": 12000,            // æœ‰æ•ˆç«¯å£æ•°
    "expired_count": 30,             // è¿‡æœŸè®°å½•æ•°
    "expired_ports": 3000,           // è¿‡æœŸç«¯å£æ•°
    "expiring_soon_count": 10,       // å³å°†è¿‡æœŸè®°å½•æ•°
    "expiring_soon_ports": 1000      // å³å°†è¿‡æœŸç«¯å£æ•°
  },
  "show": 0
}
```

## âš™ï¸ ç³»ç»Ÿç»´æŠ¤æ¥å£

### 10. å¤„ç†è¿‡æœŸå¥—é¤

**æ¥å£åœ°å€**: `POST /package/handle-expired`
**æƒé™æ ‡è¯†**: `package/handle-expired`
**é€‚ç”¨è§’è‰²**: ç®¡ç†å‘˜

#### è¯·æ±‚å‚æ•°
æ— éœ€å‚æ•°

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "å¤„ç†å®Œæˆ",
  "data": {
    "expired_packages": 5,           // è¿‡æœŸå¥—é¤æ•°é‡
    "released_accounts": 20,         // é‡Šæ”¾çš„å°å·æ•°é‡
    "affected_tenants": 3,           // å—å½±å“çš„ç§Ÿæˆ·æ•°é‡
    "release_details": [
      {
        "tenant_id": 123,
        "released_count": 10,
        "remaining_ports": 50
      }
    ]
  },
  "show": 1
}
```

---

### 11. æ›´æ–°è¿‡æœŸçŠ¶æ€

**æ¥å£åœ°å€**: `POST /package/update-expired-status`
**æƒé™æ ‡è¯†**: `package/update-expired-status`
**é€‚ç”¨è§’è‰²**: ç®¡ç†å‘˜

#### è¯·æ±‚å‚æ•°
æ— éœ€å‚æ•°

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "æ›´æ–°å®Œæˆ",
  "data": {
    "updated_count": 8,
    "update_time": "2025-08-27 15:30:00"
  },
  "show": 1
}
```

## ğŸ”§ è¾…åŠ©åŠŸèƒ½æ¥å£

### 12. ç§Ÿæˆ·é€‰é¡¹

**æ¥å£åœ°å€**: `GET /package/tenant-options`
**æƒé™æ ‡è¯†**: `package/tenant-options`
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": [
    {
      "id": 123,
      "name": "ç§Ÿæˆ·A",
      "account": "tenant001"
    },
    {
      "id": 124,
      "name": "ç§Ÿæˆ·B",
      "account": "tenant002"
    }
  ],
  "show": 0
}
```

---

### 13. å®¢æœé€‰é¡¹

**æ¥å£åœ°å€**: `GET /package/operator-options`
**æƒé™æ ‡è¯†**: `package/operator-options`
**é€‚ç”¨è§’è‰²**: ç§Ÿæˆ·

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": [
    {
      "id": 456,
      "name": "å®¢æœA",
      "account": "service001"
    },
    {
      "id": 457,
      "name": "å®¢æœB",
      "account": "service002"
    }
  ],
  "show": 0
}
```

---

### 14. å°å·é€‰é¡¹

**æ¥å£åœ°å€**: `GET /package/alt-account-options`
**æƒé™æ ‡è¯†**: `package/alt-account-options`
**é€‚ç”¨è§’è‰²**: ç§Ÿæˆ·

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": [
    {
      "id": 1001,
      "nickname": "å°å·001",
      "phone": "13800138001"
    },
    {
      "id": 1002,
      "nickname": "å°å·002",
      "phone": "13800138002"
    }
  ],
  "show": 0
}
```

## ğŸ“ é”™è¯¯ç è¯´æ˜

### **é€šç”¨é”™è¯¯ç **
| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|-------|------|---------|
| -1 | ç™»å½•è¶…æ—¶ï¼Œè¯·é‡æ–°ç™»å½• | é‡æ–°è·å–token |
| 0 | ä¸šåŠ¡é€»è¾‘é”™è¯¯ | æ ¹æ®msgæç¤ºå¤„ç† |
| 1 | æ“ä½œæˆåŠŸ | æ­£å¸¸å“åº” |

### **ä¸šåŠ¡é”™è¯¯ç¤ºä¾‹**
```json
// æƒé™ä¸è¶³
{
  "code": 0,
  "msg": "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®æˆ–æ“ä½œ",
  "data": {},
  "show": 1
}

// å‚æ•°éªŒè¯å¤±è´¥
{
  "code": 0,
  "msg": "ç«¯å£æ•°é‡å¿…é¡»åœ¨1-10000ä¹‹é—´",
  "data": {},
  "show": 1
}

// ä¸šåŠ¡é€»è¾‘é”™è¯¯
{
  "code": 0,
  "msg": "æ‚¨åªèƒ½ä¸ºè‡ªå·±çš„ä¸‹çº§ç§Ÿæˆ·åˆ†é…å¥—é¤",
  "data": {},
  "show": 1
}
```

## ğŸ” è®¤è¯è¯´æ˜

### **Tokenè·å–**
é€šè¿‡ç™»å½•æ¥å£è·å–tokenï¼š
```bash
curl -X POST "http://your-domain/adminapi/login/account" \
  -H "Content-Type: application/json" \
  -d '{
    "account": "your-account",
    "password": "your-password"
  }'
```

### **Tokenä½¿ç”¨**
åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ Authorizationï¼š
```bash
curl -H "Authorization: Bearer your-token-here" \
  "http://your-domain/adminapi/package/lists"
```

### **Tokenåˆ·æ–°**
Tokenæœ‰æ•ˆæœŸ8å°æ—¶ï¼Œä¸´æ—¶è¿‡æœŸå‰1å°æ—¶è‡ªåŠ¨ç»­æœŸã€‚

## ğŸ“Š æ¥å£ç»Ÿè®¡

| æ¥å£ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|---------|------|------|
| æ ¸å¿ƒåŠŸèƒ½ | 5ä¸ª | å¥—é¤åˆ†é…ã€æŸ¥è¯¢ã€å°å·åˆ†é…ç­‰ |
| ç®¡ç†åŠŸèƒ½ | 4ä¸ª | åˆ—è¡¨ã€ç»Ÿè®¡ã€è¯¦æƒ…ã€çŠ¶æ€æŸ¥è¯¢ |
| ç³»ç»Ÿç»´æŠ¤ | 2ä¸ª | è¿‡æœŸå¤„ç†ã€çŠ¶æ€æ›´æ–° |
| è¾…åŠ©åŠŸèƒ½ | 3ä¸ª | é€‰é¡¹åˆ—è¡¨æ¥å£ |
| **æ€»è®¡** | **14ä¸ª** | **å®Œæ•´åŠŸèƒ½è¦†ç›–** |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ—¶åŒº**: æ‰€æœ‰æ—¶é—´å‡ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰
2. **ç¼–ç **: è¯·æ±‚å’Œå“åº”å‡ä½¿ç”¨UTF-8ç¼–ç 
3. **é™æµ**: å»ºè®®æ§åˆ¶è¯·æ±‚é¢‘ç‡ï¼Œé¿å…è¿‡äºé¢‘ç¹çš„è°ƒç”¨
4. **ç¼“å­˜**: éƒ¨åˆ†æŸ¥è¯¢æ¥å£æ”¯æŒç¼“å­˜ï¼Œå¯é€‚å½“ç¼“å­˜ç»“æœ
5. **æ—¥å¿—**: æ‰€æœ‰æ“ä½œéƒ½ä¼šè®°å½•æ“ä½œæ—¥å¿—ï¼Œä¾¿äºå®¡è®¡
```

---

### 8. å¥—é¤è¯¦æƒ…

**æ¥å£åœ°å€**: `GET /package/detail`  
**æƒé™æ ‡è¯†**: `package/detail`  
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†ã€ç®¡ç†å‘˜

#### è¯·æ±‚å‚æ•°
```
id=123    // å¥—é¤è®°å½•IDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "id": 1,
    "agent_name": "ä»£ç†å•†A",
    "tenant_name": "ç§Ÿæˆ·B",
    "port_count": 200,
    "assign_time_text": "2025-08-27 10:00:00",
    "expire_time_text": "2025-09-26 10:00:00",
    "status_text": "æœ‰æ•ˆ",
    "remaining_days": 30,
    "remark": "æµ‹è¯•åˆ†é…",
    "create_time": 1724734800,
    "update_time": 1724734800
  },
  "show": 0
}
```

---

### 9. ç«¯å£æ± çŠ¶æ€

**æ¥å£åœ°å€**: `GET /package/port-pool-status`  
**æƒé™æ ‡è¯†**: `package/port-pool-status`  
**é€‚ç”¨è§’è‰²**: ç§Ÿæˆ·ã€ä»£ç†å•†

#### è¯·æ±‚å‚æ•°
```
tenant_id=123    // ç§Ÿæˆ·IDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "total_ports": 500,        // æ€»ç«¯å£æ•°
    "used_ports": 200,         // å·²ç”¨ç«¯å£æ•°
    "available_ports": 300,    // å¯ç”¨ç«¯å£æ•°
    "expiring_soon": 50        // å³å°†è¿‡æœŸç«¯å£æ•°
  },
  "show": 0
}
```

## ğŸ”„ å¥—é¤ç»­è´¹åŠŸèƒ½

### 1. å•ä¸ªå¥—é¤ç»­è´¹

**æ¥å£åœ°å€**: `POST /package/renew`
**æƒé™æ ‡è¯†**: `package/renew`
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†

#### è¯·æ±‚å‚æ•°
```json
{
  "package_id": 123,       // å¥—é¤IDï¼Œå¿…å¡«ï¼Œæ­£æ•´æ•°
  "extend_days": 30        // ç»­è´¹å¤©æ•°ï¼Œå¿…å¡«ï¼Œ1-3650å¤©
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "å¥—é¤ç»­è´¹æˆåŠŸ",
  "data": [],
  "show": 1
}
```

#### é”™è¯¯ç¤ºä¾‹
```json
{
  "code": 0,
  "msg": "å¥—é¤è®°å½•ä¸å­˜åœ¨",
  "data": [],
  "show": 1
}
```

### 2. æ‰¹é‡å¥—é¤ç»­è´¹

**æ¥å£åœ°å€**: `POST /package/batch-renew`
**æƒé™æ ‡è¯†**: `package/batchRenew`
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†

#### è¯·æ±‚å‚æ•°
```json
{
  "package_ids": [123, 124, 125],  // å¥—é¤IDåˆ—è¡¨ï¼Œå¿…å¡«ï¼Œæœ€å¤š100ä¸ª
  "extend_days": 30                // ç»­è´¹å¤©æ•°ï¼Œå¿…å¡«ï¼Œ1-3650å¤©
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "æ‰¹é‡ç»­è´¹æˆåŠŸ",
  "data": [],
  "show": 1
}
```

### 3. è·å–å¯ç»­è´¹å¥—é¤åˆ—è¡¨

**æ¥å£åœ°å€**: `GET /package/renewable-packages`
**æƒé™æ ‡è¯†**: `package/renewablePackages`
**é€‚ç”¨è§’è‰²**: ä»£ç†å•†

#### è¯·æ±‚å‚æ•°
```
tenant_id=456  // ç§Ÿæˆ·IDï¼Œå¿…å¡«
```

#### å“åº”ç¤ºä¾‹
```json
{
  "code": 1,
  "msg": "",
  "data": [
    {
      "id": 123,
      "tenant_id": 456,
      "port_count": 100,
      "assign_time": 1703664000,
      "expire_time": 1706256000,
      "status": 1,
      "remark": "æµ‹è¯•å¥—é¤",
      "remaining_days": 5,
      "is_expired": false,
      "is_expiring_soon": true,
      "tenant": {
        "id": 456,
        "name": "æµ‹è¯•ç§Ÿæˆ·",
        "account": "test_tenant"
      }
    }
  ],
  "show": 0
}
```

#### ç»­è´¹ä¸šåŠ¡é€»è¾‘
- **æœªè¿‡æœŸå¥—é¤**: åœ¨åŸåˆ°æœŸæ—¶é—´åŸºç¡€ä¸Šå»¶é•¿
- **å·²è¿‡æœŸå¥—é¤**: ä»å½“å‰æ—¶é—´å¼€å§‹è®¡ç®—æ–°çš„åˆ°æœŸæ—¶é—´
- **æƒé™æ§åˆ¶**: åªèƒ½ç»­è´¹è‡ªå·±åˆ†é…çš„å¥—é¤
- **çŠ¶æ€æ›´æ–°**: ç»­è´¹åå¥—é¤çŠ¶æ€è‡ªåŠ¨è®¾ä¸ºæœ‰æ•ˆ

## ğŸ”§ åŠŸèƒ½ä¼˜åŒ–æ›´æ–°

### å°å·åˆ é™¤ä¼˜åŒ–
- **çº§è”åˆ é™¤**: åˆ é™¤å°å·æ—¶è‡ªåŠ¨æ¸…ç†åˆ†é…å…³ç³»
- **ç«¯å£é‡Šæ”¾**: åˆ é™¤åç«¯å£ç«‹å³å¯é‡æ–°åˆ†é…
- **äº‹åŠ¡ä¿æŠ¤**: ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### ç«¯å£åˆ†é…ä¼˜åŒ–
- **è¿‡æœŸæ£€æŸ¥**: åªèƒ½ä½¿ç”¨æœªè¿‡æœŸå¥—é¤çš„ç«¯å£
- **å®æ—¶è®¡ç®—**: åŠ¨æ€è®¡ç®—å¯ç”¨ç«¯å£æ•°é‡
- **çŠ¶æ€åŒæ­¥**: å¥—é¤è¿‡æœŸåç«‹å³åœæ­¢åˆ†é…

### å†å²æŸ¥è¯¢ä¼˜åŒ–
- **å…¨ç§Ÿæˆ·æŸ¥è¯¢**: æ”¯æŒä¸é€‰æ‹©ç§Ÿæˆ·æŸ¥çœ‹å…¨éƒ¨è®°å½•
- **çŠ¶æ€ç­›é€‰**: æ”¯æŒæŒ‰å¥—é¤çŠ¶æ€ï¼ˆ0:è¿‡æœŸ 1:æœ‰æ•ˆï¼‰ç­›é€‰
- **æ—¶é—´èŒƒå›´**: æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢

---

## ğŸ“Š ç«¯å£ç»Ÿè®¡æœºåˆ¶ï¼ˆv1.9.4æ›´æ–°ï¼‰

### ç»Ÿä¸€ç»Ÿè®¡æ ‡å‡†
ä» v1.9.4 ç‰ˆæœ¬å¼€å§‹ï¼Œæ‰€æœ‰ç«¯å£ç»Ÿè®¡éƒ½ä½¿ç”¨åŸºäº `package_id` çš„æ–°æœºåˆ¶ï¼š

```php
// ç»Ÿä¸€çš„ç«¯å£ç»Ÿè®¡æ–¹å¼
$usedPorts = AltAccount::where('tenant_id', $tenantId)
    ->where('package_id', '>', 0)  // åŸºäºpackage_idç»Ÿè®¡
    ->count();
```

### ç»Ÿè®¡åŸç†
- **ç«¯å£æ€»æ•°**: ç§Ÿæˆ·æ‰€æœ‰æœ‰æ•ˆå¥—é¤çš„ç«¯å£æ•°ä¹‹å’Œ
- **å·²ç”¨ç«¯å£**: å·²åˆ†é…ç»™å®¢æœçš„å°å·æ•°é‡ï¼ˆåŸºäºpackage_idç»Ÿè®¡ï¼‰
- **å¯ç”¨ç«¯å£**: ç«¯å£æ€»æ•° - å·²ç”¨ç«¯å£
- **è¿‡æœŸç«¯å£**: å·²è¿‡æœŸå¥—é¤çš„ç«¯å£æ•°

### ä¼˜å…ˆçº§åˆ†é…ç­–ç•¥
- **æ—¶é—´ä¼˜å…ˆ**: æœ€æ—©åˆ†é…çš„å¥—é¤ä¼˜å…ˆä½¿ç”¨
- **ç²¾ç¡®è¿½è¸ª**: æ¯ä¸ªå°å·è®°å½•ä½¿ç”¨çš„å…·ä½“å¥—é¤ID
- **æ™ºèƒ½åˆ†é…**: è‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§å°†å°å·åˆ†é…åˆ°å¯¹åº”å¥—é¤

### æ•°æ®ä¸€è‡´æ€§
- æ‰€æœ‰æ¥å£ä½¿ç”¨ç»Ÿä¸€çš„ `PortStatisticsService` æœåŠ¡ç±»
- ç¡®ä¿ `auth.tenant/lists` å’Œ `package/lists` æ•°æ®ä¸€è‡´
- æä¾›æ•°æ®éªŒè¯æ¥å£ç¡®ä¿ç»Ÿè®¡å‡†ç¡®æ€§

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.9.4 (2025-08-27)
- âœ… æ–°å¢å¥—é¤ç»­è´¹åŠŸèƒ½ï¼ˆå•ä¸ªç»­è´¹ã€æ‰¹é‡ç»­è´¹ï¼‰
- âœ… ä¼˜åŒ–å°å·åˆ é™¤é€»è¾‘ï¼ˆçº§è”åˆ é™¤åˆ†é…å…³ç³»ï¼‰
- âœ… ä¿®å¤ç«¯å£å¯ç”¨æ€§æ£€æŸ¥ï¼ˆåªè®¡ç®—æœªè¿‡æœŸå¥—é¤ï¼‰
- âœ… ä¼˜åŒ–å†å²æŸ¥è¯¢åŠŸèƒ½ï¼ˆæ”¯æŒå…¨ç§Ÿæˆ·æŸ¥è¯¢å’ŒçŠ¶æ€ç­›é€‰ï¼‰
- âœ… ä¿®å¤æ—¶é—´å­—æ®µç±»å‹é”™è¯¯
- âœ… ä¼˜åŒ–æ¥å£è¿”å›æ•°æ®æ ¼å¼
- âœ… ç»Ÿä¸€ç«¯å£ç»Ÿè®¡æœºåˆ¶ï¼ˆåŸºäºpackage_idï¼‰
- âœ… å®ç°å¥—é¤ä¼˜å…ˆçº§åˆ†é…ç­–ç•¥
- âœ… æ–°å¢ç«¯å£ç»Ÿè®¡æœåŠ¡ç±»å’Œæ•°æ®éªŒè¯æ¥å£
# ç«¯å£ç»Ÿè®¡ç»Ÿä¸€æœºåˆ¶è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

ä» v1.9.4 ç‰ˆæœ¬å¼€å§‹ï¼Œç³»ç»Ÿå®ç°äº†åŸºäº `package_id` çš„ç»Ÿä¸€ç«¯å£ç»Ÿè®¡æœºåˆ¶ï¼Œæ›¿ä»£äº†åŸæœ‰çš„åŸºäº `operator_id` çš„ç»Ÿè®¡æ–¹å¼ï¼Œå®ç°äº†æ›´ç²¾ç¡®çš„ç«¯å£ä½¿ç”¨è¿½è¸ªå’Œå¥—é¤ä¼˜å…ˆçº§åˆ†é…ã€‚

## ğŸ”„ æœºåˆ¶å˜æ›´

### æ—§æœºåˆ¶ï¼ˆv1.9.3åŠä¹‹å‰ï¼‰
```php
// åŸºäº operator_id ç»Ÿè®¡
$usedPorts = AltAccount::where('tenant_id', $tenantId)
    ->where('operator_id', '>', 0)
    ->count();
```

**é—®é¢˜**ï¼š
- æ— æ³•è¿½è¸ªå°å·ä½¿ç”¨çš„å…·ä½“å¥—é¤
- æ— æ³•å®ç°å¥—é¤ä¼˜å…ˆçº§åˆ†é…
- å¤šå¥—é¤åœºæ™¯ä¸‹ç»Ÿè®¡ä¸å¤Ÿç²¾ç¡®

### æ–°æœºåˆ¶ï¼ˆv1.9.4ï¼‰
```php
// åŸºäº package_id ç»Ÿè®¡
$usedPorts = AltAccount::where('tenant_id', $tenantId)
    ->where('package_id', '>', 0)
    ->count();
```

**ä¼˜åŠ¿**ï¼š
- ç²¾ç¡®è¿½è¸ªæ¯ä¸ªå°å·ä½¿ç”¨çš„å¥—é¤
- æ”¯æŒå¥—é¤ä¼˜å…ˆçº§åˆ†é…ç­–ç•¥
- å®ç°çœŸæ­£çš„å¤šå¥—é¤ç®¡ç†

## ğŸ—„ï¸ æ•°æ®åº“å˜æ›´

### æ–°å¢å­—æ®µ
```sql
-- ä¸ºå°å·è¡¨æ·»åŠ å¥—é¤IDå­—æ®µ
ALTER TABLE `la_alt_account` ADD COLUMN `package_id` int(11) DEFAULT NULL COMMENT 'ä½¿ç”¨çš„å¥—é¤ID' AFTER `operator_id`;

-- æ·»åŠ ç´¢å¼•
ALTER TABLE `la_alt_account` ADD KEY `idx_package_id` (`package_id`);
ALTER TABLE `la_alt_account` ADD KEY `idx_tenant_package` (`tenant_id`, `package_id`);
```

### å­—æ®µå«ä¹‰
- `package_id = NULL`: å°å·æœªåˆ†é…æˆ–å†å²æ•°æ®
- `package_id > 0`: å°å·å·²åˆ†é…å¹¶è®°å½•äº†ä½¿ç”¨çš„å¥—é¤

## ğŸ”§ ç»Ÿä¸€æœåŠ¡ç±»

### PortStatisticsService
åˆ›å»ºäº†ç»Ÿä¸€çš„ç«¯å£ç»Ÿè®¡æœåŠ¡ç±»ï¼Œç¡®ä¿æ‰€æœ‰åœ°æ–¹ä½¿ç”¨ç›¸åŒçš„ç»Ÿè®¡é€»è¾‘ï¼š

```php
// è·å–ç§Ÿæˆ·ç«¯å£ç»Ÿè®¡
PortStatisticsService::getTenantPortStats($tenantId);

// è·å–ç§Ÿæˆ·å·²ç”¨ç«¯å£æ•°
PortStatisticsService::getTenantUsedPorts($tenantId);

// æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
PortStatisticsService::checkPortAvailability($tenantId, $needCount);
```

## ğŸ“Š ç»Ÿè®¡é€»è¾‘ç»Ÿä¸€

### æ¶‰åŠçš„æ¥å£å’Œæ–‡ä»¶
1. **`auth.tenant/lists`**: ç§Ÿæˆ·åˆ—è¡¨ç«¯å£ç»Ÿè®¡
2. **`package/lists`**: å¥—é¤åˆ—è¡¨ç«¯å£ç»Ÿè®¡
3. **`package/port_pool_status`**: ç«¯å£æ± çŠ¶æ€
4. **`alt_account/assign`**: å°å·åˆ†é…ç«¯å£æ£€æŸ¥

### ç»Ÿä¸€å‰åå¯¹æ¯”
```php
// ç»Ÿä¸€å‰ï¼šå„å¤„ä½¿ç”¨ä¸åŒçš„ç»Ÿè®¡æ–¹å¼
// TenantLists
$usedPorts = AltAccount::where('operator_id', '>', 0)->count();

// PackageLogic
$usedPorts = AltAccountAssignment::getTenantUsedPorts($tenantId);

// AltAccountLogic
$usedPorts = AltAccount::where('operator_id', '>', 0)->count();

// ç»Ÿä¸€åï¼šæ‰€æœ‰åœ°æ–¹ä½¿ç”¨ç›¸åŒçš„æœåŠ¡
$usedPorts = PortStatisticsService::getTenantUsedPorts($tenantId);
```

## ğŸ¯ å¥—é¤ä¼˜å…ˆçº§åˆ†é…

### åˆ†é…ç­–ç•¥
1. **æ—¶é—´ä¼˜å…ˆ**: æŒ‰ `assign_time` å‡åºæ’åˆ—å¥—é¤
2. **ç”¨å®Œå†æ¢**: ä¼˜å…ˆç”¨å®Œæ—©æœŸå¥—é¤
3. **ç²¾ç¡®è®°å½•**: è®°å½•æ¯ä¸ªå°å·ä½¿ç”¨çš„å¥—é¤ID

### åˆ†é…ç®—æ³•
```php
// 1. è·å–å¥—é¤æŒ‰ä¼˜å…ˆçº§æ’åº
$packages = PackageAssignment::getTenantPackagesByPriority($tenantId);

// 2. è®¡ç®—å„å¥—é¤çš„ç«¯å£åˆ†é…è¯¦æƒ…
$allocationDetails = PackageAssignment::calculatePortAllocationDetails($tenantId, $usedPorts);

// 3. æŒ‰ä¼˜å…ˆçº§åˆ†é…å°å·
foreach ($allocationDetails as $detail) {
    if ($detail['port_free'] > 0) {
        // åˆ†é…å°å·åˆ°è¿™ä¸ªå¥—é¤
        AltAccount::update([
            'operator_id' => $operatorId,
            'package_id' => $detail['package_id'],
            'update_time' => time()
        ]);
    }
}
```

## ğŸ” æ•°æ®éªŒè¯

### éªŒè¯æ¥å£
æä¾›äº†æ•°æ®ä¸€è‡´æ€§éªŒè¯æ¥å£ï¼š

```bash
# éªŒè¯å•ä¸ªç§Ÿæˆ·
GET /adminapi/port-validation/validate-tenant-ports?tenant_id=45

# éªŒè¯æ‰€æœ‰ç§Ÿæˆ·
GET /adminapi/port-validation/validate-all-tenants
```

### éªŒè¯å†…å®¹
```php
return [
    'package_based_used' => åŸºäºpackage_idç»Ÿè®¡,
    'operator_based_used' => åŸºäºoperator_idç»Ÿè®¡,
    'calculated_used' => æŒ‰å¥—é¤è®¡ç®—ç»Ÿè®¡,
    'is_consistent' => æ˜¯å¦ä¸€è‡´,
    'difference' => å·®å¼‚æ•°é‡
];
```

## ğŸ“ˆ å‡çº§å½±å“

### å…¼å®¹æ€§
- **å‘åå…¼å®¹**: ä¿æŒæ‰€æœ‰ç°æœ‰APIæ¥å£ä¸å˜
- **æ¸è¿›å‡çº§**: æ–°åˆ†é…ä½¿ç”¨æ–°æœºåˆ¶ï¼Œå†å²æ•°æ®ä¿æŒä¸å˜
- **æ•°æ®è¿ç§»**: å¯é€‰æ‹©æ€§åœ°ä¸ºå†å²æ•°æ®è®¾ç½®package_id

### æ€§èƒ½å½±å“
- **æŸ¥è¯¢ä¼˜åŒ–**: æ–°å¢ç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½
- **ç»Ÿä¸€è®¡ç®—**: é¿å…é‡å¤è®¡ç®—ï¼Œæå‡æ•ˆç‡
- **ç¼“å­˜å‹å¥½**: ç»Ÿä¸€çš„æ•°æ®ç»“æ„ä¾¿äºç¼“å­˜

## ğŸ› ï¸ è¿ç§»æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»
```sql
-- æ‰§è¡Œæ•°æ®åº“ç»“æ„å˜æ›´
source database/migration_add_package_id_to_alt_account.sql;
```

### 2. å†å²æ•°æ®è¿ç§»ï¼ˆå¯é€‰ï¼‰
```sql
-- ä¸ºå†å²åˆ†é…è®°å½•è®¾ç½®package_id
UPDATE la_alt_account aa
SET package_id = (
    SELECT pa.id 
    FROM la_package_assignment pa 
    WHERE pa.tenant_id = aa.tenant_id 
    AND pa.status = 1 
    ORDER BY pa.assign_time ASC 
    LIMIT 1
)
WHERE aa.operator_id > 0 
AND aa.package_id IS NULL;
```

### 3. éªŒè¯æ•°æ®ä¸€è‡´æ€§
```bash
# éªŒè¯è¿ç§»ç»“æœ
GET /adminapi/port-validation/validate-all-tenants
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. å¼€å‘è§„èŒƒ
- æ‰€æœ‰ç«¯å£ç»Ÿè®¡å¿…é¡»ä½¿ç”¨ `PortStatisticsService`
- ç¦æ­¢ç›´æ¥æŸ¥è¯¢ `operator_id` è¿›è¡Œç«¯å£ç»Ÿè®¡
- æ–°åŠŸèƒ½å¼€å‘å¿…é¡»è€ƒè™‘å¥—é¤ä¼˜å…ˆçº§

### 2. æ•°æ®ç»´æŠ¤
- å®šæœŸéªŒè¯æ•°æ®ä¸€è‡´æ€§
- ç›‘æ§å¥—é¤ä½¿ç”¨æ•ˆç‡
- åŠæ—¶å¤„ç†è¿‡æœŸå¥—é¤

### 3. æ€§èƒ½ç›‘æ§
- ç›‘æ§ç«¯å£ç»Ÿè®¡æŸ¥è¯¢æ€§èƒ½
- å…³æ³¨å¥—é¤åˆ†é…ç®—æ³•æ•ˆç‡
- ä¼˜åŒ–é«˜é¢‘æŸ¥è¯¢æ¥å£

è¿™ä¸ªç»Ÿä¸€æœºåˆ¶ç¡®ä¿äº†ç«¯å£ç»Ÿè®¡çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ï¼Œä¸ºå¤šå¥—é¤ç®¡ç†æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚
# å¥—é¤ä¼˜å…ˆçº§ä½¿ç”¨ç­–ç•¥

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†"ä¼˜å…ˆä½¿ç”¨æœ€æ—©å¥—é¤"çš„ç­–ç•¥ï¼Œç¡®ä¿ç§Ÿæˆ·çš„å¤šä¸ªå¥—é¤æŒ‰ç…§åˆ†é…æ—¶é—´é¡ºåºä½¿ç”¨ï¼Œé¿å…èµ„æºæµªè´¹å’Œç®¡ç†æ··ä¹±ã€‚

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. æ—¶é—´ä¼˜å…ˆåŸåˆ™
- **æœ€æ—©åˆ†é…çš„å¥—é¤ä¼˜å…ˆä½¿ç”¨**
- æŒ‰ `assign_time` å‡åºæ’åˆ—å¥—é¤
- å…ˆç”¨å®Œæ—©æœŸå¥—é¤ï¼Œå†ä½¿ç”¨åæœŸå¥—é¤

### 2. ç«¯å£åˆ†é…ç­–ç•¥
```
ç§Ÿæˆ·æœ‰3ä¸ªå¥—é¤ï¼š
å¥—é¤A: 100ç«¯å£ (2024-01-01åˆ†é…)
å¥—é¤B: 50ç«¯å£  (2024-01-15åˆ†é…) 
å¥—é¤C: 200ç«¯å£ (2024-02-01åˆ†é…)

åˆ†é…é¡ºåºï¼šA â†’ B â†’ C
```

### 3. ç²¾ç¡®è·Ÿè¸ª
- å°å·è¡¨æ–°å¢ `package_id` å­—æ®µ
- è®°å½•æ¯ä¸ªå°å·ä½¿ç”¨çš„å…·ä½“å¥—é¤
- æ”¯æŒç²¾ç¡®çš„ç«¯å£ä½¿ç”¨ç»Ÿè®¡

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ•°æ®åº“ç»“æ„å˜æ›´

#### å°å·è¡¨æ–°å¢å­—æ®µ
```sql
ALTER TABLE `la_alt_account` ADD COLUMN `package_id` int(11) DEFAULT NULL COMMENT 'ä½¿ç”¨çš„å¥—é¤ID' AFTER `operator_id`;
```

#### ç´¢å¼•ä¼˜åŒ–
```sql
-- å¥—é¤IDç´¢å¼•
ALTER TABLE `la_alt_account` ADD KEY `idx_package_id` (`package_id`);

-- ç§Ÿæˆ·å¥—é¤å¤åˆç´¢å¼•
ALTER TABLE `la_alt_account` ADD KEY `idx_tenant_package` (`tenant_id`, `package_id`);
```

### 2. æ ¸å¿ƒç®—æ³•

#### å¥—é¤ä¼˜å…ˆçº§æ’åº
```php
public static function getTenantPackagesByPriority(int $tenantId, bool $onlyValid = true): array
{
    $query = self::where('tenant_id', $tenantId);
    
    if ($onlyValid) {
        $query->where('status', 1)
              ->where('expire_time', '>', time());
    }
    
    return $query->order('assign_time', 'asc') // æœ€æ—©çš„ä¼˜å…ˆ
                 ->select()
                 ->toArray();
}
```

#### ç«¯å£åˆ†é…è®¡ç®—
```php
public static function calculatePortAllocationDetails(int $tenantId, int $usedPorts): array
{
    $packages = self::getTenantPackagesByPriority($tenantId, true);
    $allocationDetails = [];
    $remainingUsed = $usedPorts;
    
    foreach ($packages as $package) {
        $packageUsed = min($remainingUsed, $package['port_count']);
        $packageFree = $package['port_count'] - $packageUsed;
        
        $allocationDetails[] = [
            'package_id' => $package['id'],
            'port_total' => $package['port_count'],
            'port_used' => $packageUsed,
            'port_free' => $packageFree,
            'is_fully_used' => $packageUsed >= $package['port_count']
        ];
        
        $remainingUsed -= $packageUsed;
        if ($remainingUsed <= 0) break;
    }
    
    return $allocationDetails;
}
```

#### å°å·åˆ†é…é€»è¾‘
```php
private static function assignAccountsWithPackagePriority(array $altAccountIds, int $tenantId, int $operatorId): bool
{
    // 1. è·å–å¥—é¤æŒ‰ä¼˜å…ˆçº§æ’åº
    $packages = PackageAssignment::getTenantPackagesByPriority($tenantId, true);
    
    // 2. è®¡ç®—å„å¥—é¤çš„å¯ç”¨ç«¯å£
    $allocationDetails = PackageAssignment::calculatePortAllocationDetails($tenantId, $currentUsedPorts);
    
    // 3. æŒ‰ä¼˜å…ˆçº§åˆ†é…å°å·åˆ°å¥—é¤
    $assignmentPlan = [];
    $remainingAccounts = count($altAccountIds);
    
    foreach ($allocationDetails as $detail) {
        if ($remainingAccounts <= 0) break;
        
        $availableInPackage = $detail['port_free'];
        if ($availableInPackage > 0) {
            $assignToThisPackage = min($remainingAccounts, $availableInPackage);
            $assignmentPlan[] = [
                'package_id' => $detail['package_id'],
                'count' => $assignToThisPackage
            ];
            $remainingAccounts -= $assignToThisPackage;
        }
    }
    
    // 4. æ‰§è¡Œåˆ†é…
    $accountIndex = 0;
    foreach ($assignmentPlan as $plan) {
        $accountsForThisPackage = array_slice($altAccountIds, $accountIndex, $plan['count']);
        
        AltAccount::where('id', 'in', $accountsForThisPackage)->update([
            'operator_id' => $operatorId,
            'package_id' => $plan['package_id'],
            'update_time' => time()
        ]);
        
        $accountIndex += $plan['count'];
    }
    
    return true;
}
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šå¤šå¥—é¤åˆ†é…
```
ç§Ÿæˆ·æœ‰2ä¸ªå¥—é¤ï¼š
- å¥—é¤A: 100ç«¯å£ (2024-01-01åˆ†é…)
- å¥—é¤B: 50ç«¯å£  (2024-01-15åˆ†é…)

å½“å‰å·²åˆ†é…80ä¸ªå°å·ï¼š
- å¥—é¤A: 80ä¸ªå°å· (å·²ç”¨80/100)
- å¥—é¤B: 0ä¸ªå°å·  (å·²ç”¨0/50)

æ–°åˆ†é…30ä¸ªå°å·ï¼š
- å¥—é¤A: åˆ†é…20ä¸ª (ç”¨æ»¡100/100)
- å¥—é¤B: åˆ†é…10ä¸ª (å·²ç”¨10/50)
```

### åœºæ™¯2ï¼šå¥—é¤è¿‡æœŸå¤„ç†
```
å¥—é¤Aè¿‡æœŸåï¼š
- å¥—é¤Açš„å°å·ä¿æŒåˆ†é…çŠ¶æ€
- package_id ä¿æŒä¸å˜ï¼ˆå†å²è®°å½•ï¼‰
- æ–°åˆ†é…åªä½¿ç”¨å¥—é¤Bçš„ç«¯å£
```

## ğŸ¯ ä¸šåŠ¡ä»·å€¼

### 1. èµ„æºä¼˜åŒ–
- **é¿å…æµªè´¹**: ä¼˜å…ˆç”¨å®Œæ—©æœŸå¥—é¤ï¼Œé¿å…è¿‡æœŸæµªè´¹
- **æˆæœ¬æ§åˆ¶**: åˆç†åˆ©ç”¨å·²è´­ä¹°çš„ç«¯å£èµ„æº
- **å®¹é‡è§„åˆ’**: æ¸…æ™°çš„å¥—é¤ä½¿ç”¨é¡ºåº

### 2. ç®¡ç†æ¸…æ™°
- **ä½¿ç”¨é€æ˜**: æ¯ä¸ªå¥—é¤çš„ä½¿ç”¨æƒ…å†µä¸€ç›®äº†ç„¶
- **å†å²è¿½è¸ª**: å®Œæ•´çš„ç«¯å£ä½¿ç”¨å†å²è®°å½•
- **ç²¾ç¡®ç»Ÿè®¡**: åŸºäºå®é™…ä½¿ç”¨çš„ç²¾ç¡®ç»Ÿè®¡

### 3. è¿è¥æ•ˆç‡
- **è‡ªåŠ¨åˆ†é…**: ç³»ç»Ÿè‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§åˆ†é…
- **æ™ºèƒ½æé†’**: åŸºäºä½¿ç”¨é¡ºåºçš„ç»­è´¹æé†’
- **æ•°æ®åˆ†æ**: æ”¯æŒæ›´ç²¾ç¡®çš„ä½¿ç”¨åˆ†æ

## ğŸ” æŸ¥è¯¢ç¤ºä¾‹

### æŸ¥è¯¢å¥—é¤ä½¿ç”¨æƒ…å†µ
```sql
-- æŸ¥è¯¢ç§Ÿæˆ·å„å¥—é¤çš„ç«¯å£ä½¿ç”¨æƒ…å†µ
SELECT 
    pa.id as package_id,
    pa.port_count as total_ports,
    COUNT(aa.id) as used_ports,
    (pa.port_count - COUNT(aa.id)) as free_ports,
    pa.assign_time,
    pa.expire_time
FROM la_package_assignment pa
LEFT JOIN la_alt_account aa ON pa.id = aa.package_id AND aa.operator_id > 0
WHERE pa.tenant_id = ? AND pa.status = 1 AND pa.expire_time > UNIX_TIMESTAMP()
GROUP BY pa.id
ORDER BY pa.assign_time ASC;
```

### æŸ¥è¯¢å°å·åˆ†é…è¯¦æƒ…
```sql
-- æŸ¥è¯¢å°å·ä½¿ç”¨çš„å¥—é¤ä¿¡æ¯
SELECT 
    aa.id,
    aa.phone,
    aa.operator_id,
    pa.id as package_id,
    pa.assign_time as package_assign_time,
    pa.expire_time as package_expire_time
FROM la_alt_account aa
LEFT JOIN la_package_assignment pa ON aa.package_id = pa.id
WHERE aa.tenant_id = ? AND aa.operator_id > 0;
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¥—é¤è§„åˆ’
- åˆç†è§„åˆ’å¥—é¤è´­ä¹°æ—¶é—´
- é¿å…åŒæ—¶è´­ä¹°è¿‡å¤šå¥—é¤
- è€ƒè™‘ä¸šåŠ¡å¢é•¿çš„æ—¶é—´èŠ‚ç‚¹

### 2. ç›‘æ§æé†’
- ç›‘æ§æ—©æœŸå¥—é¤çš„ä½¿ç”¨ç‡
- æå‰è§„åˆ’ç»­è´¹ç­–ç•¥
- å…³æ³¨å³å°†è¿‡æœŸçš„å¥—é¤

### 3. æ•°æ®åˆ†æ
- åˆ†æå¥—é¤ä½¿ç”¨æ•ˆç‡
- ä¼˜åŒ–å¥—é¤è´­ä¹°ç­–ç•¥
- åŸºäºå†å²æ•°æ®é¢„æµ‹éœ€æ±‚

è¿™ä¸ªç­–ç•¥ç¡®ä¿äº†ç§Ÿæˆ·çš„å¤šå¥—é¤èµ„æºå¾—åˆ°æœ€ä¼˜åŒ–çš„ä½¿ç”¨ï¼Œæé«˜äº†èµ„æºåˆ©ç”¨ç‡å’Œç®¡ç†æ•ˆç‡ã€‚
# å°å·åˆ†é…ç³»ç»Ÿç®€åŒ–æ–¹æ¡ˆè¯´æ˜

## æ¦‚è¿°

ç»è¿‡é‡æ–°åˆ†æï¼Œç¡®è®¤ç°æœ‰çš„æ•°æ®è¡¨ç»“æ„å®Œå…¨èƒ½å¤Ÿæ»¡è¶³å°å·åˆ†é…å’Œç«¯å£ç®¡æ§çš„éœ€æ±‚ï¼Œ**æ— éœ€æ–°å¢é¢å¤–çš„æ•°æ®è¡¨**ã€‚

## ğŸ¯ æ ¸å¿ƒç»“è®º

**ç°æœ‰è¡¨ç»“æ„å®Œå…¨å¤Ÿç”¨ï¼Œæ— éœ€æ–°å¢ `la_alt_account_assignment` è¡¨ï¼**

## ğŸ“Š ç°æœ‰è¡¨ç»“æ„åˆ†æ

### æ ¸å¿ƒè¡¨ç»“æ„
```sql
-- 1. å°å·è¡¨ï¼ˆå·²æœ‰ï¼‰
la_alt_account
â”œâ”€â”€ id                 -- ä¸»é”®ï¼Œå¯ä½œä¸ºåˆ†é…é¡ºåºæ’åº
â”œâ”€â”€ tenant_id          -- ç§Ÿæˆ·ID
â”œâ”€â”€ operator_id        -- å®¢æœIDï¼ˆåˆ†é…å…³ç³»ï¼‰
â”œâ”€â”€ update_time        -- æ›´æ–°æ—¶é—´ï¼ˆå¯ä½œä¸ºåˆ†é…æ—¶é—´ï¼‰
â””â”€â”€ ...

-- 2. å¥—é¤åˆ†é…è¡¨ï¼ˆå·²æœ‰ï¼‰
la_package_assignment
â”œâ”€â”€ tenant_id          -- ç§Ÿæˆ·ID
â”œâ”€â”€ port_count         -- ç«¯å£æ•°é‡
â”œâ”€â”€ expire_time        -- åˆ°æœŸæ—¶é—´
â”œâ”€â”€ status             -- çŠ¶æ€
â””â”€â”€ ...

-- 3. ç®¡ç†å‘˜è¡¨ï¼ˆå·²æœ‰ï¼‰
la_admin
â”œâ”€â”€ id                 -- ç®¡ç†å‘˜ID
â”œâ”€â”€ parent_id          -- ä¸Šçº§IDï¼ˆå±‚çº§å…³ç³»ï¼‰
â”œâ”€â”€ disable            -- æ˜¯å¦ç¦ç”¨
â””â”€â”€ ...
```

### åŠŸèƒ½å®ç°æ˜ å°„

| åŠŸèƒ½éœ€æ±‚ | å®ç°æ–¹å¼ | ä½¿ç”¨å­—æ®µ |
|----------|----------|----------|
| è®°å½•åˆ†é…å…³ç³» | `la_alt_account.operator_id` | operator_id |
| åˆ†é…æ—¶é—´è®°å½• | `la_alt_account.update_time` | update_time |
| åˆ†é…é¡ºåºæ’åº | `la_alt_account.id` | idï¼ˆè‡ªç„¶æ’åºï¼‰ |
| ç«¯å£é…é¢æ§åˆ¶ | `la_package_assignment` | port_count |
| æƒé™å±‚çº§éªŒè¯ | `la_admin.parent_id` | parent_id |

## âœ… åŠŸèƒ½å®ç°

### 1. ç«¯å£å¯ç”¨æ€§æ£€æŸ¥ï¼ˆv1.9.4æ›´æ–°ï¼‰
```php
// ä½¿ç”¨ç»Ÿä¸€çš„ç«¯å£ç»Ÿè®¡æœåŠ¡
$portStats = PortStatisticsService::getTenantPortStats($tenantId);

// å†…éƒ¨å®ç°ï¼š
// è®¡ç®—æ€»ç«¯å£æ•°ï¼ˆä»å¥—é¤åˆ†é…è¡¨ï¼‰
$totalPorts = PackageAssignment::where('tenant_id', $tenantId)
    ->where('status', 1)
    ->where('expire_time', '>', time())
    ->sum('port_count');

// è®¡ç®—å·²ç”¨ç«¯å£æ•°ï¼ˆåŸºäºpackage_idç»Ÿè®¡ - æ–°æœºåˆ¶ï¼‰
$usedPorts = AltAccount::where('tenant_id', $tenantId)
    ->where('package_id', '>', 0)  // ä½¿ç”¨package_idç»Ÿè®¡
    ->count();

// è®¡ç®—å¯ç”¨ç«¯å£æ•°
$availablePorts = max(0, $totalPorts - $usedPorts);
```

### 2. å°å·åˆ†é…æ“ä½œï¼ˆv1.9.4æ›´æ–°ï¼‰
```php
// ä½¿ç”¨ä¼˜å…ˆçº§åˆ†é…ç­–ç•¥
$assignResult = AltAccountLogic::assignAccountsWithPackagePriority($altAccountIds, $tenantId, $operatorId);

// å†…éƒ¨å®ç°ï¼šæŒ‰å¥—é¤ä¼˜å…ˆçº§åˆ†é…
AltAccount::where('id', 'in', $accountsForThisPackage)->update([
    'operator_id' => $operatorId,
    'package_id' => $packageId,  // è®°å½•ä½¿ç”¨çš„å¥—é¤ID
    'update_time' => time()
]);
```

### 3. å°å·é‡Šæ”¾æ“ä½œï¼ˆv1.9.4æ›´æ–°ï¼‰
```php
// æŒ‰åˆ†é…é¡ºåºé‡Šæ”¾ï¼ˆIDå°çš„å…ˆé‡Šæ”¾ï¼‰
$toReleaseIds = AltAccount::where('tenant_id', $tenantId)
    ->where('package_id', '>', 0)  // åŸºäºpackage_idæŸ¥è¯¢
    ->order('id', 'asc')  // å…ˆåˆ†é…çš„å…ˆé‡Šæ”¾
    ->limit($releaseCount)
    ->column('id');

AltAccount::where('id', 'in', $toReleaseIds)->update([
    'operator_id' => 0,
    'package_id' => null,  // æ¸…ç©ºå¥—é¤ä½¿ç”¨è®°å½•
    'update_time' => time()
]);
```

### 4. ç§Ÿæˆ·ç«¯å£ç»Ÿè®¡
```php
// ç”¨äºç§Ÿæˆ·åˆ—è¡¨æ˜¾ç¤º
$portStats = [
    'total_ports' => $totalPorts,      // æ€»ç«¯å£æ•°
    'used_ports' => $usedPorts,        // å·²ç”¨ç«¯å£
    'available_ports' => $availablePorts, // ç©ºé—²ç«¯å£
    'expired_ports' => $expiredPorts,   // è¿‡æœŸç«¯å£
];
```

## ğŸ”§ ä»£ç å®ç°

### AltAccountLogic::assignCustomerService()
```php
public static function assignCustomerService(array $params, int $currentAdminId = 0): bool
{
    Db::startTrans();
    try {
        // 1. æƒé™éªŒè¯
        // 2. ç«¯å£å¯ç”¨æ€§æ£€æŸ¥
        // 3. å°å·çŠ¶æ€éªŒè¯
        // 4. æ‰¹é‡æ›´æ–°åˆ†é…å…³ç³»
        AltAccount::where('id', 'in', $altAccountIds)->update([
            'operator_id' => $operatorId,
            'update_time' => time()
        ]);
        
        Db::commit();
        return true;
    } catch (\Exception $e) {
        Db::rollback();
        self::setError($e->getMessage());
        return false;
    }
}
```

### TenantListsç«¯å£ç»Ÿè®¡ï¼ˆv1.9.4æ›´æ–°ï¼‰
```php
// ä½¿ç”¨ç»Ÿä¸€çš„ç«¯å£ç»Ÿè®¡æœåŠ¡
$portStats = PortStatisticsService::getTenantPortStats($tenantId);

// æ›¿ä»£äº†åŸæ¥çš„ calculatePortStats æ–¹æ³•
// å†…éƒ¨å®ç°åŸºäºpackage_idç»Ÿè®¡ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
return [
    'total_ports' => $portStats['total_ports'],
    'used_ports' => $portStats['used_ports'],
    'available_ports' => $portStats['available_ports'],
    'expired_ports' => $portStats['expired_ports'],
];
```

## ğŸ§ª æµ‹è¯•éªŒè¯ç»“æœ

### åŠŸèƒ½æµ‹è¯•
- âœ… **ç«¯å£å¯ç”¨æ€§æ£€æŸ¥**: æ€»ç«¯å£200ï¼Œå·²ç”¨3ï¼Œå¯ç”¨197
- âœ… **å°å·åˆ†é…çŠ¶æ€**: æ­£ç¡®æ˜¾ç¤ºåˆ†é…å…³ç³»å’Œæ—¶é—´
- âœ… **ç«¯å£ç»Ÿè®¡**: å‡†ç¡®è®¡ç®—å„é¡¹ç«¯å£æ•°æ®
- âœ… **é‡Šæ”¾é€»è¾‘**: æŒ‰IDé¡ºåºæ­£ç¡®æ’åº

### æ€§èƒ½æµ‹è¯•
- âœ… **æŸ¥è¯¢æ•ˆç‡**: åŸºäºç°æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢é«˜æ•ˆ
- âœ… **æ•°æ®ä¸€è‡´æ€§**: ç»Ÿè®¡æ•°æ®å‡†ç¡®å¯é 
- âœ… **å¹¶å‘å®‰å…¨**: äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§

## ğŸ’¡ æ–¹æ¡ˆä¼˜åŠ¿

### 1. ç®€æ´æ€§
- **æ— é¢å¤–è¡¨**: ä¸å¢åŠ æ•°æ®åº“å¤æ‚åº¦
- **é€»è¾‘æ¸…æ™°**: åˆ†é…å…³ç³»ä¸€ç›®äº†ç„¶
- **ç»´æŠ¤ç®€å•**: å‡å°‘æ•°æ®åŒæ­¥é—®é¢˜

### 2. æ€§èƒ½ä¼˜åŠ¿
- **æŸ¥è¯¢é«˜æ•ˆ**: åˆ©ç”¨ç°æœ‰ç´¢å¼•
- **å­˜å‚¨èŠ‚çœ**: æ— å†—ä½™æ•°æ®å­˜å‚¨
- **æ“ä½œç®€å•**: å•è¡¨æ›´æ–°æ“ä½œ

### 3. å…¼å®¹æ€§
- **å‘åå…¼å®¹**: å®Œå…¨å…¼å®¹ç°æœ‰ä»£ç 
- **å¹³æ»‘å‡çº§**: æ— éœ€æ•°æ®è¿ç§»
- **é£é™©æœ€ä½**: ä¸æ”¹å˜ç°æœ‰ç»“æ„

### 4. åŠŸèƒ½å®Œæ•´
- **ç«¯å£ç®¡æ§**: ä¸¥æ ¼çš„é…é¢æ§åˆ¶
- **æƒé™éªŒè¯**: å®Œæ•´çš„å±‚çº§éªŒè¯
- **å†å²è¿½æº¯**: é€šè¿‡update_timeè®°å½•
- **æ™ºèƒ½é‡Šæ”¾**: åŸºäºIDçš„è‡ªç„¶æ’åº

## ğŸš€ å®æ–½å»ºè®®

### ç«‹å³å¯ç”¨
1. **å°å·åˆ†é…åŠŸèƒ½**: å·²é›†æˆç«¯å£ç®¡æ§å’Œæƒé™éªŒè¯
2. **ç§Ÿæˆ·åˆ—è¡¨ç»Ÿè®¡**: å·²æ·»åŠ ç«¯å£ç»Ÿè®¡å­—æ®µ
3. **APIæ¥å£**: ä¿æŒå®Œå…¨å…¼å®¹

### æ— éœ€æ“ä½œ
1. **æ•°æ®è¿ç§»**: æ— éœ€ä»»ä½•æ•°æ®è¿ç§»
2. **è¡¨ç»“æ„ä¿®æ”¹**: æ— éœ€ä¿®æ”¹ç°æœ‰è¡¨
3. **åœæœºç»´æŠ¤**: æ— éœ€åœæœºæ“ä½œ

## ğŸ“‹ æ€»ç»“

é€šè¿‡é‡æ–°åˆ†æå’Œä¼˜åŒ–ï¼Œç¡®è®¤äº†ï¼š

1. **ç°æœ‰è¡¨ç»“æ„å®Œå…¨å¤Ÿç”¨** - æ— éœ€æ–°å¢ä»»ä½•è¡¨
2. **åŠŸèƒ½å®ç°å®Œæ•´** - æ»¡è¶³æ‰€æœ‰ä¸šåŠ¡éœ€æ±‚
3. **æ€§èƒ½è¡¨ç°ä¼˜ç§€** - æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œæ“ä½œç®€å•
4. **ç»´æŠ¤æˆæœ¬æœ€ä½** - ç»“æ„ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°

è¿™ä¸ªç®€åŒ–æ–¹æ¡ˆæ—¢æ»¡è¶³äº†ä¸šåŠ¡éœ€æ±‚ï¼Œåˆä¿æŒäº†ç³»ç»Ÿçš„ç®€æ´æ€§å’Œé«˜æ€§èƒ½ï¼Œæ˜¯æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚
# å°å·åˆ†é…é€»è¾‘è¯¦è§£

## æ¦‚è¿°

å°å·åˆ†é…æ˜¯æŒ‡å°†ç§Ÿæˆ·çš„å°å·è´¦æˆ·åˆ†é…ç»™å…·ä½“çš„å®¢æœäººå‘˜ä½¿ç”¨çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹é›†æˆäº†å¥—é¤åˆ†é…ç³»ç»Ÿï¼Œå®ç°äº†ä¸¥æ ¼çš„ç«¯å£é…é¢æ§åˆ¶å’Œæƒé™éªŒè¯ã€‚

## ğŸ”„ å®Œæ•´åˆ†é…æµç¨‹

### è°ƒç”¨å…¥å£
```php
// APIæ¥å£è°ƒç”¨
AltAccountLogic::assignCustomerService($params, $currentAdminId);

// å‚æ•°ç»“æ„
$params = [
    'alt_account_ids' => [1, 2, 3],  // è¦åˆ†é…çš„å°å·IDæ•°ç»„
    'operator_id' => 56              // ç›®æ ‡å®¢æœID
];
$currentAdminId = 45;  // å½“å‰æ“ä½œçš„ç§Ÿæˆ·ID
```

### æ ¸å¿ƒæµç¨‹ï¼ˆ5ä¸ªæ­¥éª¤ï¼‰

## ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šæƒé™å±‚çº§éªŒè¯

### ç›®çš„
ç¡®ä¿å½“å‰ç§Ÿæˆ·åªèƒ½å°†å°å·åˆ†é…ç»™è‡ªå·±çš„ç›´æ¥ä¸‹çº§å®¢æœï¼Œé˜²æ­¢è¶Šæƒæ“ä½œã€‚

### å®ç°é€»è¾‘
```php
// æ£€æŸ¥å®¢æœæ˜¯å¦ä¸ºå½“å‰ç§Ÿæˆ·çš„ä¸‹çº§
if (!AdminHierarchyService::hasPermission($currentAdminId, $operatorId)) {
    throw new \Exception('æ‚¨æ²¡æœ‰æƒé™å°†å°å·åˆ†é…ç»™è¯¥è¿è¥äººå‘˜');
}
```

### éªŒè¯è§„åˆ™
- **å±‚çº§å…³ç³»**: å®¢æœçš„`parent_id`å¿…é¡»ç­‰äºå½“å‰ç§Ÿæˆ·çš„ID
- **æƒé™è¾¹ç•Œ**: ç§Ÿæˆ·åªèƒ½ç®¡ç†è‡ªå·±çš„ç›´æ¥ä¸‹çº§
- **å®‰å…¨ä¿éšœ**: é˜²æ­¢è·¨ç§Ÿæˆ·åˆ†é…å°å·

### æ•°æ®è¡¨ä¾èµ–
```sql
-- æ£€æŸ¥å±‚çº§å…³ç³»
SELECT * FROM la_admin 
WHERE id = {operatorId} AND parent_id = {currentAdminId}
```

## ğŸ­ ç¬¬äºŒæ­¥ï¼šè§’è‰²æƒé™éªŒè¯

### ç›®çš„
ç¡®ä¿åˆ†é…ç›®æ ‡å…·æœ‰æ­£ç¡®çš„è¿è¥è§’è‰²ï¼Œé¿å…å°†å°å·åˆ†é…ç»™éå®¢æœäººå‘˜ã€‚

### å®ç°é€»è¾‘
```php
// éªŒè¯è¿è¥æ˜¯å¦å…·æœ‰è¿è¥è§’è‰²
$hasOperatorRole = AdminRole::where('admin_id', $operatorId)
    ->where('role_id', OperatorLogic::$operatorRoleId)
    ->find();
if (!$hasOperatorRole) {
    throw new \Exception('é€‰æ‹©çš„äººå‘˜ä¸æ˜¯è¿è¥è§’è‰²');
}
```

### éªŒè¯è§„åˆ™
- **è§’è‰²åŒ¹é…**: ç›®æ ‡ç”¨æˆ·å¿…é¡»å…·æœ‰è¿è¥è§’è‰²
- **è§’è‰²æœ‰æ•ˆ**: è§’è‰²åˆ†é…è®°å½•å¿…é¡»å­˜åœ¨ä¸”æœ‰æ•ˆ
- **ä¸šåŠ¡é€»è¾‘**: åªæœ‰è¿è¥äººå‘˜æ‰èƒ½æ¥å—å°å·åˆ†é…

### æ•°æ®è¡¨ä¾èµ–
```sql
-- æ£€æŸ¥è§’è‰²åˆ†é…
SELECT * FROM la_admin_role 
WHERE admin_id = {operatorId} AND role_id = {operatorRoleId}
```

## ğŸ”¢ ç¬¬ä¸‰æ­¥ï¼šç«¯å£å¯ç”¨æ€§æ£€æŸ¥ï¼ˆæ ¸å¿ƒï¼‰

### ç›®çš„
åŸºäºå¥—é¤åˆ†é…ç³»ç»Ÿæ£€æŸ¥ç§Ÿæˆ·æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç«¯å£é…é¢è¿›è¡Œåˆ†é…ã€‚

### å®ç°é€»è¾‘
```php
// æ£€æŸ¥ç«¯å£å¯ç”¨æ€§
$needCount = count($altAccountIds);
$availability = self::checkPortAvailability($currentAdminId, $needCount);
if (!$availability['available']) {
    throw new \Exception('ç«¯å£ä¸è¶³ï¼Œå½“å‰å¯ç”¨ç«¯å£ï¼š' . $availability['available_ports'] . 'ä¸ªï¼Œéœ€è¦ï¼š' . $needCount . 'ä¸ª');
}
```

### ç«¯å£è®¡ç®—è¯¦è§£

#### 3.1 è®¡ç®—æ€»ç«¯å£æ•°
```php
// ä»å¥—é¤åˆ†é…è¡¨ç»Ÿè®¡æœ‰æ•ˆç«¯å£
$totalPorts = PackageAssignment::where('tenant_id', $tenantId)
    ->where('status', 1)           // çŠ¶æ€æœ‰æ•ˆ
    ->where('expire_time', '>', time())  // æœªè¿‡æœŸ
    ->sum('port_count') ?: 0;
```

**è¯´æ˜**:
- **æ•°æ®æ¥æº**: `la_package_assignment` è¡¨
- **ç­›é€‰æ¡ä»¶**: çŠ¶æ€ä¸º1ä¸”æœªè¿‡æœŸçš„å¥—é¤
- **è®¡ç®—æ–¹å¼**: æ‰€æœ‰æœ‰æ•ˆå¥—é¤çš„ç«¯å£æ•°ä¹‹å’Œ

#### 3.2 è®¡ç®—å·²ç”¨ç«¯å£æ•°
```php
// ä»å°å·è¡¨ç»Ÿè®¡å·²åˆ†é…çš„å°å·æ•°é‡ï¼ˆä½¿ç”¨æ–°æœºåˆ¶ï¼‰
$usedPorts = AltAccount::where('tenant_id', $tenantId)
    ->where('package_id', '>', 0)  // åŸºäºpackage_idç»Ÿè®¡
    ->count();
```

**è¯´æ˜**:
- **æ•°æ®æ¥æº**: `la_alt_account` è¡¨
- **ç­›é€‰æ¡ä»¶**: `package_id > 0` è¡¨ç¤ºå·²åˆ†é…å¹¶è®°å½•äº†ä½¿ç”¨çš„å¥—é¤
- **è®¡ç®—æ–¹å¼**: ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„å°å·æ•°é‡
- **ä¼˜åŠ¿**: ç²¾ç¡®è¿½è¸ªæ¯ä¸ªå°å·ä½¿ç”¨çš„å…·ä½“å¥—é¤

#### 3.3 è®¡ç®—å¯ç”¨ç«¯å£æ•°
```php
// å¯ç”¨ç«¯å£ = æ€»ç«¯å£ - å·²ç”¨ç«¯å£
$availablePorts = max(0, $totalPorts - $usedPorts);
```

#### 3.4 å¯ç”¨æ€§åˆ¤æ–­
```php
return [
    'available' => $availablePorts >= $needCount,  // æ˜¯å¦å¯åˆ†é…
    'total_ports' => (int)$totalPorts,           // æ€»ç«¯å£æ•°
    'used_ports' => (int)$usedPorts,             // å·²ç”¨ç«¯å£æ•°
    'available_ports' => (int)$availablePorts,   // å¯ç”¨ç«¯å£æ•°
    'need_ports' => $needCount,                  // éœ€è¦ç«¯å£æ•°
];
```

## ğŸ“± ç¬¬å››æ­¥ï¼šå°å·çŠ¶æ€éªŒè¯

### ç›®çš„
ç¡®ä¿è¦åˆ†é…çš„å°å·éƒ½æ˜¯æœ‰æ•ˆçš„ã€å±äºå½“å‰ç§Ÿæˆ·çš„ã€ä¸”æœªè¢«åˆ†é…çš„ã€‚

### å®ç°é€»è¾‘
```php
foreach ($altAccountIds as $altAccountId) {
    $altAccount = AltAccount::findOrEmpty($altAccountId);
    
    // 4.1 å°å·å­˜åœ¨æ€§æ£€æŸ¥
    if ($altAccount->isEmpty()) {
        throw new \Exception("å°å·ID {$altAccountId} ä¸å­˜åœ¨");
    }
    
    // 4.2 æ‰€æœ‰æƒæ£€æŸ¥
    if ($altAccount->tenant_id != $currentAdminId) {
        throw new \Exception("æ‚¨æ²¡æœ‰æƒé™æ“ä½œå°å·ID {$altAccountId}");
    }
    
    // 4.3 åˆ†é…çŠ¶æ€æ£€æŸ¥
    if ($altAccount->operator_id > 0) {
        throw new \Exception("å°å·ID {$altAccountId} å·²è¢«åˆ†é…ç»™å…¶ä»–å®¢æœ");
    }
}
```

### éªŒè¯è§„åˆ™
- **å­˜åœ¨æ€§**: å°å·è®°å½•å¿…é¡»å­˜åœ¨
- **æ‰€æœ‰æƒ**: å°å·å¿…é¡»å±äºå½“å‰ç§Ÿæˆ·
- **å¯ç”¨æ€§**: å°å·å¿…é¡»æœªè¢«åˆ†é…ï¼ˆ`operator_id = 0`ï¼‰

## âœ… ç¬¬äº”æ­¥ï¼šæ‰§è¡Œåˆ†é…æ“ä½œ

### ç›®çš„
åœ¨æ‰€æœ‰éªŒè¯é€šè¿‡åï¼Œæ‰§è¡Œå®é™…çš„åˆ†é…æ“ä½œã€‚

### å®ç°é€»è¾‘
```php
// æ‰¹é‡æ›´æ–°å°å·çš„è¿è¥åˆ†é…
AltAccount::where('id', 'in', $altAccountIds)->update([
    'operator_id' => $operatorId,  // è®¾ç½®å®¢æœID
    'update_time' => time()        // è®°å½•åˆ†é…æ—¶é—´
]);
```

### æ“ä½œç‰¹ç‚¹
- **æ‰¹é‡æ›´æ–°**: ä¸€æ¬¡SQLæ“ä½œæ›´æ–°å¤šä¸ªå°å·
- **æ—¶é—´è®°å½•**: `update_time`è®°å½•åˆ†é…æ—¶é—´
- **åŸå­æ“ä½œ**: åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­æ‰§è¡Œ

## ğŸ›¡ï¸ äº‹åŠ¡å®‰å…¨ä¿éšœ

### äº‹åŠ¡ç»“æ„
```php
Db::startTrans();  // å¼€å§‹äº‹åŠ¡
try {
    // æ‰§è¡Œæ‰€æœ‰éªŒè¯å’Œåˆ†é…æ“ä½œ
    Db::commit();   // æäº¤äº‹åŠ¡
    return true;
} catch (\Exception $e) {
    Db::rollback(); // å›æ»šäº‹åŠ¡
    self::setError($e->getMessage());
    return false;
}
```

### å®‰å…¨ç‰¹æ€§
- **åŸå­æ€§**: è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
- **ä¸€è‡´æ€§**: æ•°æ®çŠ¶æ€å§‹ç»ˆä¿æŒä¸€è‡´
- **éš”ç¦»æ€§**: å¹¶å‘æ“ä½œä¸ä¼šç›¸äº’å¹²æ‰°
- **æŒä¹…æ€§**: æˆåŠŸçš„æ“ä½œæ°¸ä¹…ä¿å­˜

## ğŸ“Š æ•°æ®æµå‘å›¾

```
è¾“å…¥å‚æ•°
    â†“
æƒé™å±‚çº§éªŒè¯ â†’ AdminHierarchyService
    â†“
è§’è‰²æƒé™éªŒè¯ â†’ la_admin_role è¡¨
    â†“
ç«¯å£å¯ç”¨æ€§æ£€æŸ¥ â†’ la_package_assignment + la_alt_account
    â†“
å°å·çŠ¶æ€éªŒè¯ â†’ la_alt_account è¡¨
    â†“
æ‰§è¡Œåˆ†é…æ“ä½œ â†’ æ›´æ–° la_alt_account.operator_id
    â†“
è¿”å›ç»“æœ
```

## ğŸ¯ ä¸šåŠ¡ä»·å€¼

### 1. èµ„æºç®¡æ§
- **ç«¯å£é…é¢**: ä¸¥æ ¼æ§åˆ¶åˆ†é…æ•°é‡ï¼Œé˜²æ­¢è¶…å‡ºå¥—é¤é™åˆ¶
- **æˆæœ¬æ§åˆ¶**: é¿å…èµ„æºæµªè´¹å’Œè¶…é¢ä½¿ç”¨
- **å®¹é‡è§„åˆ’**: åŸºäºå®é™…ä½¿ç”¨æƒ…å†µè¿›è¡Œèµ„æºè§„åˆ’

### 2. æƒé™å®‰å…¨
- **å±‚çº§æ§åˆ¶**: ç¡®ä¿æƒé™è¾¹ç•Œï¼Œé˜²æ­¢è¶Šæƒæ“ä½œ
- **è§’è‰²éªŒè¯**: ç¡®ä¿åˆ†é…ç›®æ ‡çš„åˆæ³•æ€§
- **æ•°æ®å®‰å…¨**: ä¿æŠ¤ç§Ÿæˆ·æ•°æ®ä¸è¢«éæ³•è®¿é—®

### 3. ä¸šåŠ¡æµç¨‹
- **è§„èŒƒæ“ä½œ**: æ ‡å‡†åŒ–çš„åˆ†é…æµç¨‹
- **çŠ¶æ€ç®¡ç†**: æ¸…æ™°çš„å°å·çŠ¶æ€è·Ÿè¸ª
- **å†å²è®°å½•**: å®Œæ•´çš„æ“ä½œæ—¶é—´è®°å½•

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦æ£€æŸ¥ç«¯å£å¯ç”¨æ€§ï¼Ÿ
**A**: å› ä¸ºæ¯ä¸ªç§Ÿæˆ·çš„ç«¯å£æ•°é‡æ˜¯æœ‰é™çš„ï¼ˆåŸºäºè´­ä¹°çš„å¥—é¤ï¼‰ï¼Œéœ€è¦ç¡®ä¿ä¸è¶…å‡ºé…é¢ã€‚

### Q2: å°å·åˆ†é…åå¦‚ä½•é‡Šæ”¾ï¼Ÿ
**A**: å°†`operator_id`è®¾ç½®ä¸º0å³å¯é‡Šæ”¾ï¼Œé‡Šæ”¾æ—¶æŒ‰IDé¡ºåºï¼ˆå…ˆåˆ†é…çš„å…ˆé‡Šæ”¾ï¼‰ã€‚

### Q3: å¦‚ä½•æŸ¥çœ‹ç§Ÿæˆ·çš„ç«¯å£ä½¿ç”¨æƒ…å†µï¼Ÿ
**A**: åœ¨ç§Ÿæˆ·åˆ—è¡¨ä¸­å¯ä»¥çœ‹åˆ°å®æ—¶çš„ç«¯å£ç»Ÿè®¡ä¿¡æ¯ã€‚

### Q4: åˆ†é…å¤±è´¥å¦‚ä½•å¤„ç†ï¼Ÿ
**A**: ç³»ç»Ÿä¼šå›æ»šæ‰€æœ‰æ“ä½œï¼Œè¿”å›å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´ã€‚

è¿™å¥—å°å·åˆ†é…é€»è¾‘æ—¢ä¿è¯äº†ä¸šåŠ¡éœ€æ±‚çš„å®ç°ï¼Œåˆç¡®ä¿äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ•°æ®çš„ä¸€è‡´æ€§ã€‚
# å°å·åˆ†ç»„ç®¡ç†åŠŸèƒ½æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

ä¸ºAltAccountå°å·ç®¡ç†ç³»ç»Ÿæ–°å¢åˆ†ç»„ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå¯¹å°å·è¿›è¡Œåˆ†ç»„ç®¡ç†ï¼Œæé«˜ç®¡ç†æ•ˆç‡ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **åˆ†ç»„ç®¡ç†**: æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åˆ†ç»„
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡ä¸ºå°å·è®¾ç½®åˆ†ç»„
- **æƒé™æ§åˆ¶**: ç§Ÿæˆ·åªèƒ½ç®¡ç†è‡ªå·±åˆ›å»ºçš„åˆ†ç»„å’Œå°å·
- **æ•°æ®å…³è”**: ä¸€ä¸ªå°å·åªèƒ½å±äºä¸€ä¸ªåˆ†ç»„ï¼Œä¸€ä¸ªåˆ†ç»„å¯ä»¥åŒ…å«å¤šä¸ªå°å·

## æ•°æ®åº“è®¾è®¡

### 1. æ–°å¢åˆ†ç»„è¡¨ `la_alt_account_group`

```sql
CREATE TABLE `la_alt_account_group` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `tenant_id` int(11) DEFAULT NULL COMMENT 'ç§Ÿæˆ·ID',
  `name` varchar(50) NOT NULL DEFAULT '' COMMENT 'åˆ†ç»„åç§°',
  `description` varchar(255) DEFAULT '' COMMENT 'åˆ†ç»„æè¿°',
  `create_time` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'æ›´æ–°æ—¶é—´',
  `delete_time` int(10) unsigned DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_tenant_id` (`tenant_id`) USING BTREE,
  KEY `idx_name` (`name`) USING BTREE,
  UNIQUE KEY `uk_tenant_name` (`tenant_id`, `name`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å°å·åˆ†ç»„è¡¨';
```

### 2. ä¿®æ”¹å°å·è¡¨ `la_alt_account`

```sql
-- æ·»åŠ åˆ†ç»„IDå­—æ®µ
ALTER TABLE `la_alt_account` ADD COLUMN `group_id` int(11) DEFAULT NULL COMMENT 'åˆ†ç»„ID' AFTER `tenant_id`;

-- æ·»åŠ ç´¢å¼•
ALTER TABLE `la_alt_account` ADD KEY `idx_group_id` (`group_id`) USING BTREE;
```

## APIæ¥å£æ–‡æ¡£

### åˆ†ç»„ç®¡ç†æ¥å£

#### 1. è·å–åˆ†ç»„åˆ—è¡¨
- **æ¥å£**: `GET /adminapi/alt_account_group/lists`
- **æƒé™**: `alt_account_group/lists`
- **å‚æ•°**: 
  ```json
  {
    "page": 1,
    "limit": 20,
    "name": "åˆ†ç»„åç§°æœç´¢",
    "description": "æè¿°æœç´¢"
  }
  ```
- **è¿”å›**: åˆ†ç»„åˆ—è¡¨ï¼ŒåŒ…å«æ¯ä¸ªåˆ†ç»„çš„å°å·æ•°é‡

#### 2. æ·»åŠ åˆ†ç»„
- **æ¥å£**: `POST /adminapi/alt_account_group/add`
- **æƒé™**: `alt_account_group/add`
- **å‚æ•°**:
  ```json
  {
    "name": "åˆ†ç»„åç§°",
    "description": "åˆ†ç»„æè¿°"
  }
  ```

#### 3. ç¼–è¾‘åˆ†ç»„
- **æ¥å£**: `POST /adminapi/alt_account_group/edit`
- **æƒé™**: `alt_account_group/edit`
- **å‚æ•°**:
  ```json
  {
    "id": 1,
    "name": "æ–°åˆ†ç»„åç§°",
    "description": "æ–°åˆ†ç»„æè¿°"
  }
  ```

#### 4. åˆ é™¤åˆ†ç»„
- **æ¥å£**: `POST /adminapi/alt_account_group/delete`
- **æƒé™**: `alt_account_group/delete`
- **å‚æ•°**:
  ```json
  {
    "id": 1
  }
  ```
- **è¯´æ˜**: åˆ é™¤åˆ†ç»„æ—¶ï¼Œè¯¥åˆ†ç»„ä¸‹çš„å°å·ä¼šè‡ªåŠ¨è®¾ç½®ä¸º"æœªåˆ†ç»„"çŠ¶æ€

#### 5. è·å–åˆ†ç»„è¯¦æƒ…
- **æ¥å£**: `GET /adminapi/alt_account_group/detail`
- **æƒé™**: `alt_account_group/detail`
- **å‚æ•°**:
  ```json
  {
    "id": 1
  }
  ```

#### 6. è·å–åˆ†ç»„é€‰é¡¹åˆ—è¡¨
- **æ¥å£**: `GET /adminapi/alt_account_group/getGroupOptions`
- **æƒé™**: `alt_account_group/getGroupOptions`
- **è¿”å›**: ç”¨äºä¸‹æ‹‰é€‰æ‹©çš„åˆ†ç»„åˆ—è¡¨ï¼ŒåŒ…å«"æœªåˆ†ç»„"é€‰é¡¹

### å°å·åˆ†ç»„æ“ä½œæ¥å£

#### æ‰¹é‡è®¾ç½®å°å·åˆ†ç»„
- **æ¥å£**: `POST /adminapi/alt_account/batchSetGroup`
- **æƒé™**: `alt_account/batchSetGroup`
- **å‚æ•°**:
  ```json
  {
    "alt_account_ids": [1, 2, 3],
    "group_id": 5
  }
  ```
- **è¯´æ˜**: 
  - `group_id` ä¸º 0 è¡¨ç¤ºè®¾ç½®ä¸º"æœªåˆ†ç»„"
  - æ”¯æŒæ‰¹é‡æ“ä½œå¤šä¸ªå°å·
  - å¦‚æœå°å·å·²æœ‰åˆ†ç»„ï¼Œä¼šè‡ªåŠ¨è½¬ç§»åˆ°æ–°åˆ†ç»„

## æƒé™æ ‡è¯†

### åˆ†ç»„ç®¡ç†æƒé™
- `alt_account_group/lists` - æŸ¥çœ‹åˆ†ç»„åˆ—è¡¨
- `alt_account_group/add` - æ·»åŠ åˆ†ç»„
- `alt_account_group/edit` - ç¼–è¾‘åˆ†ç»„
- `alt_account_group/delete` - åˆ é™¤åˆ†ç»„
- `alt_account_group/detail` - æŸ¥çœ‹åˆ†ç»„è¯¦æƒ…
- `alt_account_group/getGroupOptions` - è·å–åˆ†ç»„é€‰é¡¹

### å°å·åˆ†ç»„æ“ä½œæƒé™
- `alt_account/batchSetGroup` - æ‰¹é‡è®¾ç½®å°å·åˆ†ç»„

## å®ç°æ–‡ä»¶ç»“æ„

```
app/
â”œâ”€â”€ adminapi/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ AltAccountGroupController.php     # åˆ†ç»„ç®¡ç†æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ AltAccountController.php          # å°å·æ§åˆ¶å™¨ï¼ˆæ–°å¢æ‰¹é‡è®¾ç½®åˆ†ç»„æ–¹æ³•ï¼‰
â”‚   â”œâ”€â”€ logic/
â”‚   â”‚   â”œâ”€â”€ AltAccountGroupLogic.php          # åˆ†ç»„ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ AltAccountLogic.php               # å°å·ä¸šåŠ¡é€»è¾‘ï¼ˆæ–°å¢æ‰¹é‡è®¾ç½®åˆ†ç»„æ–¹æ³•ï¼‰
â”‚   â”œâ”€â”€ lists/
â”‚   â”‚   â”œâ”€â”€ AltAccountGroupLists.php          # åˆ†ç»„åˆ—è¡¨ç±»
â”‚   â”‚   â””â”€â”€ AltAccountLists.php               # å°å·åˆ—è¡¨ç±»ï¼ˆæ˜¾ç¤ºåˆ†ç»„ä¿¡æ¯ï¼‰
â”‚   â””â”€â”€ validate/
â”‚       â”œâ”€â”€ AltAccountGroupValidate.php       # åˆ†ç»„éªŒè¯å™¨
â”‚       â””â”€â”€ AltAccountValidate.php            # å°å·éªŒè¯å™¨ï¼ˆæ–°å¢æ‰¹é‡è®¾ç½®åˆ†ç»„éªŒè¯ï¼‰
â””â”€â”€ common/
    â””â”€â”€ model/
        â”œâ”€â”€ AltAccountGroup.php               # åˆ†ç»„æ¨¡å‹
        â””â”€â”€ AltAccount.php                    # å°å·æ¨¡å‹ï¼ˆæ–°å¢åˆ†ç»„å…³è”ï¼‰
```

## æƒé™æ§åˆ¶æœºåˆ¶

### 1. ç§Ÿæˆ·éš”ç¦»
- åˆ†ç»„åˆ›å»ºæ—¶è‡ªåŠ¨è®¾ç½® `tenant_id` ä¸ºå½“å‰ç”¨æˆ·ID
- ç§Ÿæˆ·åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±åˆ›å»ºçš„åˆ†ç»„
- åªèƒ½ä¸ºè‡ªå·±çš„å°å·è®¾ç½®åˆ†ç»„

### 2. æ•°æ®éªŒè¯
- åˆ†ç»„åç§°åœ¨åŒä¸€ç§Ÿæˆ·ä¸‹å¿…é¡»å”¯ä¸€
- æ‰¹é‡æ“ä½œæ—¶éªŒè¯æ‰€æœ‰å°å·çš„å½’å±æƒ
- éªŒè¯ç›®æ ‡åˆ†ç»„çš„å½’å±æƒ

### 3. ä¸šåŠ¡è§„åˆ™
- åˆ é™¤åˆ†ç»„æ—¶è‡ªåŠ¨å°†è¯¥åˆ†ç»„ä¸‹çš„å°å·è®¾ç½®ä¸ºæœªåˆ†ç»„
- æ”¯æŒå°†å°å·è®¾ç½®ä¸ºæœªåˆ†ç»„çŠ¶æ€ï¼ˆgroup_id = nullï¼‰
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

## å‰ç«¯å¼€å‘æŒ‡å—

### 1. åˆ†ç»„ç®¡ç†é¡µé¢
- åˆ†ç»„åˆ—è¡¨å±•ç¤ºï¼šåç§°ã€æè¿°ã€å°å·æ•°é‡ã€åˆ›å»ºæ—¶é—´
- æ”¯æŒæœç´¢ï¼šæŒ‰åˆ†ç»„åç§°å’Œæè¿°æœç´¢
- æ“ä½œæŒ‰é’®ï¼šæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤åˆ†ç»„

### 2. å°å·åˆ—è¡¨é¡µé¢
- æ–°å¢åˆ†ç»„åˆ—æ˜¾ç¤ºå°å·æ‰€å±åˆ†ç»„
- æ‰¹é‡æ“ä½œï¼šé€‰ä¸­å¤šä¸ªå°å·åå¯æ‰¹é‡è®¾ç½®åˆ†ç»„
- åˆ†ç»„ç­›é€‰ï¼šæ”¯æŒæŒ‰åˆ†ç»„ç­›é€‰å°å·åˆ—è¡¨

### 3. åˆ†ç»„é€‰æ‹©ç»„ä»¶
- ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼ŒåŒ…å«æ‰€æœ‰åˆ†ç»„å’Œ"æœªåˆ†ç»„"é€‰é¡¹
- ç”¨äºæ‰¹é‡è®¾ç½®åˆ†ç»„å’Œç­›é€‰åŠŸèƒ½

## ä½¿ç”¨æµç¨‹

1. **åˆ›å»ºåˆ†ç»„**: ç®¡ç†å‘˜åˆ›å»ºåˆ†ç»„ï¼Œè®¾ç½®åç§°å’Œæè¿°
2. **åˆ†é…å°å·**: é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªå°å·ï¼Œæ‰¹é‡è®¾ç½®åˆ°æŒ‡å®šåˆ†ç»„
3. **ç®¡ç†åˆ†ç»„**: å¯ä»¥ç¼–è¾‘åˆ†ç»„ä¿¡æ¯æˆ–åˆ é™¤ä¸éœ€è¦çš„åˆ†ç»„
4. **æŸ¥çœ‹ç»Ÿè®¡**: åœ¨åˆ†ç»„åˆ—è¡¨ä¸­æŸ¥çœ‹æ¯ä¸ªåˆ†ç»„åŒ…å«çš„å°å·æ•°é‡

## æŠ€æœ¯ç‰¹ç‚¹

- âœ… éµå¾ªlikeadminé¡¹ç›®ç¼–ç è§„èŒƒ
- âœ… å®Œæ•´çš„æƒé™æ§åˆ¶å’Œæ•°æ®éš”ç¦»
- âœ… æ”¯æŒæ‰¹é‡æ“ä½œå’Œäº‹åŠ¡å¤„ç†
- âœ… æ ‡å‡†çš„JSONå“åº”æ ¼å¼
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… ç‰©ç†åˆ é™¤ï¼ˆæ ¹æ®é¡¹ç›®é…ç½®ï¼‰
