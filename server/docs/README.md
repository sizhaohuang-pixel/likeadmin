# 管理员层级权限系统文档

**注意：此目录下的所有文档已合并到 [documentation.md](documentation.md) 文件中，请查阅该文件以获取最完整和最新的信息。**

本目录包含了管理员层级权限系统的完整文档。

## 文档结构

### 功能说明文档
- [代理商管理功能说明](代理商管理功能说明.md) - 代理商管理功能的详细说明
- [租户管理功能说明](租户管理功能说明.md) - 租户管理功能的详细说明
- [层级权限控制说明](层级权限控制说明.md) - 整体层级权限控制机制说明
- [套餐分配系统集成完成报告](套餐分配系统集成完成报告.md) - 套餐分配系统功能完整报告

### API接口文档
- [代理商管理API文档](代理商管理API文档.md) - 代理商管理相关API接口
- [租户管理API文档](租户管理API文档.md) - 租户管理相关API接口
- [套餐分配系统API接口文档](套餐分配系统API接口文档.md) - 套餐分配和续费相关API接口

### 技术文档
- [数据库设计文档](数据库设计文档.md) - 数据库表结构和字段说明
- [权限控制架构文档](权限控制架构文档.md) - 权限控制的技术架构
- [端口统计统一机制说明](端口统计统一机制说明.md) - v1.9.4统一机制详细说明
- [套餐优先级使用策略](套餐优先级使用策略.md) - 套餐优先级分配算法说明

## 系统概述

本系统实现了完整的管理员层级权限控制，包括：

### 角色层级
```
Root用户
    ↓
平台管理员 (角色ID: 5)
    ↓
代理商 (角色ID: 1)
    ↓
租户 (角色ID: 2)
```

### 权限规则
1. **创建权限**：
   - 平台管理员可以创建代理商
   - 代理商可以创建租户
   - Root用户可以创建任何角色

2. **管理权限**：
   - 管理员只能查看和操作自己的下级
   - 支持多级层级管理
   - 真实删除，数据不可恢复

3. **数据隔离**：
   - 严格的数据权限控制
   - 防止越权访问
   - 自动上级关系设置

## 快速开始

1. 查看对应的功能说明文档了解业务逻辑
2. 参考API文档进行接口调用
3. 查看技术文档了解实现细节

## 🔄 核心功能

### 套餐分配系统 (v1.9.4)
- **套餐分配管理**: 代理商为租户分配端口套餐
- **套餐续费功能**: 单个续费、批量续费
- **端口资源管控**: 基于套餐的端口配额控制
- **小号分配集成**: 与小号管理系统完美集成
- **智能过期处理**: 自动处理过期套餐和端口释放

### 权限管理系统
- **层级权限控制**: 严格的上下级权限管理
- **角色权限验证**: 基于角色的功能权限控制
- **数据权限隔离**: 确保数据安全和隔离

### 小号管理集成
- **端口配额控制**: 基于套餐的小号分配限制
- **级联删除优化**: 删除小号时自动释放端口
- **实时状态同步**: 套餐状态与小号分配实时同步

## 更新日志

### v1.9.4 (2025-08-27)
- ✅ 新增套餐续费功能（单个续费、批量续费）
- ✅ 优化小号删除逻辑（级联删除分配关系）
- ✅ 修复端口可用性检查（只计算未过期套餐）
- ✅ 优化历史查询功能（支持全租户查询和状态筛选）
- ✅ 修复时间字段类型错误和返回数据格式
- ✅ **统一端口统计机制**（基于package_id的精确统计）
- ✅ **套餐优先级分配策略**（最早套餐优先使用）
- ✅ **数据一致性保障**（统一的PortStatisticsService服务类）
- ✅ **完整的数据验证体系**（确保统计准确性）
- ✅ 更新完整的API文档和功能说明

### v1.9.3 (2024/08/24)
- 2024/08/24: 初始版本，实现代理商管理和层级权限控制
- 2024/08/24: 添加租户管理功能
- 2024/08/24: 完善文档结构和组织
- 2024/08/24: 集成套餐分配系统